# C# ç¨‹åºé›†ã€åå°„ä¸å…ƒæ•°æ®æŠ€æœ¯é¢˜æ±‡æ€?

## ä¸€ã€ç¨‹åºé›†åŸºç¡€çŸ¥è¯†

### æŠ€æœ¯é¢˜1ï¼šç¨‹åºé›†çš„å®šä¹‰ä¸ç»„æˆ

**é—®é¢˜ï¼?* ä»€ä¹ˆæ˜¯.NETç¨‹åºé›†ï¼Ÿè¯·è¯¦ç»†æè¿°ç¨‹åºé›†çš„ç»“æ„å’Œç»„æˆéƒ¨åˆ†ï¼Œå¹¶è§£é‡Šæ¸…å•(manifest)åœ¨ç¨‹åºé›†ä¸­çš„ä½œç”¨ã€?

**ç­”æ¡ˆï¼?*

ç¨‹åºé›†æ˜¯.NETåº”ç”¨ç¨‹åºçš„åŸºæœ¬æ„å»ºå•å…ƒï¼Œæ˜¯é€»è¾‘ç›¸å…³çš„ç±»å‹å’Œèµ„æºçš„é›†åˆï¼Œå½¢æˆä¸€ä¸ªåŠŸèƒ½å•å…ƒã€‚ç‰©ç†ä¸Šï¼Œç¨‹åºé›†é€šå¸¸è¡¨ç°ä¸?exeæˆ?dllæ–‡ä»¶ã€?

**ç¨‹åºé›†çš„ç»„æˆéƒ¨åˆ†ï¼?*

1. **ç¨‹åºé›†æ¸…å?Assembly Manifest)**ï¼šåŒ…å«ç¨‹åºé›†å…ƒæ•°æ®ï¼Œæ˜¯ç¨‹åºé›†çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œæä¾›ä»¥ä¸‹ä¿¡æ¯ï¼?
   - ç¨‹åºé›†æ ‡è¯†ä¿¡æ¯ï¼ˆåç§°ã€ç‰ˆæœ¬ã€æ–‡åŒ–ã€å…¬é’¥ä»¤ç‰Œï¼‰
   - æ–‡ä»¶åˆ—è¡¨ï¼ˆæ„æˆç¨‹åºé›†çš„æ‰€æœ‰æ–‡ä»¶ï¼‰
   - ç±»å‹å¼•ç”¨æ˜ å°„ï¼ˆå°†ç±»å‹æ˜ å°„åˆ°å®ç°å®ƒä»¬çš„æ–‡ä»¶ï¼?
   - ä¾èµ–ç¨‹åºé›†å¼•ç”¨ï¼ˆç¨‹åºé›†ä¾èµ–çš„å…¶ä»–ç¨‹åºé›†åˆ—è¡¨ï¼‰
   - å®‰å…¨æƒé™è¯·æ±‚ï¼ˆç¨‹åºé›†è¯·æ±‚çš„å®‰å…¨æƒé™ï¼‰

2. **ç±»å‹å…ƒæ•°æ?*ï¼šæè¿°ç¨‹åºé›†ä¸­å®šä¹‰çš„æ‰€æœ‰ç±»å‹ï¼ˆç±»ã€æ¥å£ã€ç»“æ„ç­‰ï¼‰çš„è¯¦ç»†ä¿¡æ¯ã€?

3. **MSILä»£ç (Microsoft Intermediate Language)**ï¼šç¼–è¯‘å™¨ç”Ÿæˆçš„ä¸­é—´è¯­è¨€ä»£ç ï¼Œåœ¨è¿è¡Œæ—¶ç”±JITç¼–è¯‘å™¨è½¬æ¢ä¸ºæœ¬æœºä»£ç ã€?

4. **èµ„æº**ï¼šç¨‹åºé›†å¯ä»¥åŒ…å«åµŒå…¥å¼èµ„æºï¼Œå¦‚å­—ç¬¦ä¸²ã€å›¾åƒã€å›¾æ ‡ç­‰ã€?

**ç¨‹åºé›†æ¸…å•çš„ä½œç”¨ï¼?*

ç¨‹åºé›†æ¸…å•ä½œä¸ºç¨‹åºé›†çš?èº«ä»½è¯?ï¼Œæä¾›CLRï¼ˆå…¬å…±è¯­è¨€è¿è¡Œæ—¶ï¼‰åŠ è½½å’Œç®¡ç†ç¨‹åºé›†æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼š

1. **å”¯ä¸€æ ‡è¯†**ï¼šé€šè¿‡åç§°ã€ç‰ˆæœ¬ã€æ–‡åŒ–å’Œå…¬é’¥ä»¤ç‰Œå”¯ä¸€æ ‡è¯†ç¨‹åºé›?
2. **ç‰ˆæœ¬æ§åˆ¶**ï¼šæ”¯æŒå¹¶è¡Œæ‰§è¡Œä¸åŒç‰ˆæœ¬çš„ç¨‹åºé›?
3. **ä¾èµ–ç®¡ç†**ï¼šå£°æ˜å¯¹å…¶ä»–ç¨‹åºé›†çš„ä¾èµ–å…³ç³»
4. **ç±»å‹è§£æ**ï¼šå°†ç±»å‹åç§°æ˜ å°„åˆ°å®ç°æ–‡ä»?
5. **å®‰å…¨è¾¹ç•Œ**ï¼šå®šä¹‰ç¨‹åºé›†çš„å®‰å…¨éœ€æ±‚å’Œä¿¡ä»»çº§åˆ«

**ä»£ç ç¤ºä¾‹ - æŸ¥çœ‹ç¨‹åºé›†ä¿¡æ¯ï¼š**

```csharp
using System;
using System.Reflection;

class Program
{
    static void Main()
    {
        // è·å–å½“å‰æ‰§è¡Œçš„ç¨‹åºé›†
        Assembly currentAssembly = Assembly.GetExecutingAssembly();
        
        // æ˜¾ç¤ºç¨‹åºé›†çš„åŸºæœ¬ä¿¡æ¯
        Console.WriteLine("ç¨‹åºé›†åç§? " + currentAssembly.FullName);
        
        // æ˜¾ç¤ºç¨‹åºé›†çš„ç‰ˆæœ¬ä¿¡æ¯
        AssemblyName assemblyName = currentAssembly.GetName();
        Console.WriteLine("ç¨‹åºé›†ç‰ˆæœ? " + assemblyName.Version);
        
        // æ˜¾ç¤ºç¨‹åºé›†ä¸­åŒ…å«çš„ç±»å?
        Console.WriteLine("\nç¨‹åºé›†ä¸­çš„ç±»å?");
        foreach (Type type in currentAssembly.GetTypes())
        {
            Console.WriteLine("- " + type.FullName);
        }
        
        // æ˜¾ç¤ºç¨‹åºé›†å¼•ç”¨çš„å…¶ä»–ç¨‹åºé›?
        Console.WriteLine("\nå¼•ç”¨çš„ç¨‹åºé›†:");
        foreach (AssemblyName refAssembly in currentAssembly.GetReferencedAssemblies())
        {
            Console.WriteLine("- " + refAssembly.Name + " (v" + refAssembly.Version + ")");
        }
    }
}
```

**ä¼˜ç‚¹åˆ†æï¼?*
- ç¨‹åºé›†æä¾›äº†å°è£…ã€ç‰ˆæœ¬æ§åˆ¶å’Œéƒ¨ç½²çš„å•ä½?
- æ¸…å•æä¾›è‡ªæè¿°èƒ½åŠ›ï¼Œä½¿ç¨‹åºé›†æˆä¸ºè‡ªåŒ…å«çš„éƒ¨ç½²å•å…ƒ
- æ”¯æŒå¹¶è¡Œç‰ˆæœ¬æ‰§è¡Œï¼Œé¿å…?DLLåœ°ç‹±"é—®é¢˜
- æä¾›å®‰å…¨è¾¹ç•Œå’Œç±»å‹å®‰å…?

**ç¼ºç‚¹åˆ†æï¼?*
- æ¸…å•å¢åŠ äº†æ–‡ä»¶å¤§å°?
- ç‰ˆæœ¬æ§åˆ¶å¯èƒ½å˜å¾—å¤æ‚ï¼Œå°¤å…¶åœ¨å¤§å‹åº”ç”¨ç¨‹åºä¸?
- æŸäº›æƒ…å†µä¸‹ï¼Œç¨‹åºé›†åŠ è½½å’Œç®¡ç†ä¼šå¸¦æ¥æ€§èƒ½å¼€é”€

### æŠ€æœ¯é¢˜2ï¼šç¨‹åºé›†çš„å¼ºå‘½åä¸GAC

**é—®é¢˜ï¼?* ä»€ä¹ˆæ˜¯ç¨‹åºé›†çš„å¼ºå‘½åï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å¼ºå‘½åï¼Ÿè¯·è§£é‡ŠGAC(å…¨å±€ç¨‹åºé›†ç¼“å­?çš„ä½œç”¨å’Œå¦‚ä½•å°†å¼ºå‘½åç¨‹åºé›†å®‰è£…åˆ°GACä¸­ã€?

**ç­”æ¡ˆï¼?*

**å¼ºå‘½åç¨‹åºé›†ï¼?*

å¼ºå‘½åç¨‹åºé›†æ˜¯ä½¿ç”¨ç§é’¥æ•°å­—ç­¾åçš„ç¨‹åºé›†ï¼Œå®ƒç¡®ä¿ç¨‹åºé›†çš„å®Œæ•´æ€§å’Œå”¯ä¸€æ€§ã€‚å¼ºå‘½åçš„ç¨‹åºé›†åŒ…å«å››ä¸ªå…³é”®è¦ç´ ï¼?
1. ç¨‹åºé›†çš„ç®€å•æ–‡æœ¬åç§?
2. ç‰ˆæœ¬å·ï¼ˆä¸»ç‰ˆæœ?æ¬¡ç‰ˆæœ?å†…éƒ¨ç‰ˆæœ¬.ä¿®è®¢å·ï¼‰
3. æ–‡åŒ–ä¿¡æ¯ï¼ˆé€‚ç”¨äºç‰¹å®šè¯­è¨€å’ŒåŒºåŸŸçš„ç¨‹åºé›†ï¼‰
4. å…¬é’¥ä»¤ç‰Œï¼ˆç”±ç§é’¥å¯¹åº”çš„å…¬é’¥ç”Ÿæˆçš„å“ˆå¸Œå€¼ï¼‰

**ä¸ºä»€ä¹ˆéœ€è¦å¼ºå‘½åï¼?*

1. **å”¯ä¸€æ ‡è¯†**ï¼šç¡®ä¿åœ¨å…¨å±€èŒƒå›´å†…ç¨‹åºé›†åç§°å”¯ä¸€ï¼Œå³ä½¿ä¸åŒå¼€å‘è€…åˆ›å»ºåŒåç¨‹åºé›†
2. **ç‰ˆæœ¬æ§åˆ¶**ï¼šæ”¯æŒå¹¶è¡Œç‰ˆæœ¬æ‰§è¡Œï¼Œå…è®¸ä¸åŒç‰ˆæœ¬çš„åŒä¸€ç¨‹åºé›†å…±å­?
3. **å®Œæ•´æ€§éªŒè¯?*ï¼šé˜²æ­¢ç¨‹åºé›†è¢«ç¯¡æ”¹ï¼ŒCLRå¯ä»¥éªŒè¯ç¨‹åºé›†çš„å®Œæ•´æ€?
4. **GACéƒ¨ç½²**ï¼šåªæœ‰å¼ºå‘½åçš„ç¨‹åºé›†æ‰èƒ½å®‰è£…åˆ°å…¨å±€ç¨‹åºé›†ç¼“å­?GAC)
5. **ä¿¡ä»»çº§åˆ«**ï¼šå¼ºå‘½åè¡¨æ˜ç¨‹åºé›†çš„å‘å¸ƒè€…ï¼Œå¯ä½œä¸ºä¿¡ä»»å†³ç­–çš„ä¾æ®

**GAC (å…¨å±€ç¨‹åºé›†ç¼“å­?ï¼?*

GACæ˜¯ä¸€ä¸ªæœºå™¨èŒƒå›´çš„ç¨‹åºé›†ç¼“å­˜ï¼Œä¸ºå¸¸ç”¨ç¨‹åºé›†æä¾›é›†ä¸­å­˜å‚¨ä½ç½®ã€?

**GACçš„ä½œç”¨ï¼š**

1. **å…±äº«ç¨‹åºé›?*ï¼šå¤šä¸ªåº”ç”¨ç¨‹åºå¯ä»¥å…±äº«åŒä¸€ç¨‹åºé›†ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´å’Œå†…å­?
2. **ç‰ˆæœ¬å¹¶è¡Œ**ï¼šæ”¯æŒåŒä¸€ç¨‹åºé›†çš„å¤šä¸ªç‰ˆæœ¬å¹¶è¡Œè¿è¡Œ
3. **é¢„ç¼–è¯‘ä¼˜åŒ?*ï¼šå­˜å‚¨åœ¨GACä¸­çš„ç¨‹åºé›†å¯ä»¥è¢«NGENé¢„ç¼–è¯‘ï¼Œæé«˜åŠ è½½æ€§èƒ½
4. **å®‰å…¨æ€?*ï¼šåªæœ‰å¼ºå‘½åçš„ç¨‹åºé›†æ‰èƒ½å®‰è£…åˆ°GACï¼Œç¡®ä¿å®Œæ•´æ€?

**å°†ç¨‹åºé›†å®‰è£…åˆ°GACï¼?*

**æ–¹æ³•1ï¼šä½¿ç”¨gacutil.exeå·¥å…·ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ï¼?*

```
gacutil /i MyAssembly.dll
```

ç§»é™¤ç¨‹åºé›†ï¼š

```
gacutil /u MyAssembly
```

**æ–¹æ³•2ï¼šä½¿ç”¨Windows Installerï¼?*

```xml
<ItemGroup>
  <Reference Include="MyAssembly">
    <HintPath>path\to\MyAssembly.dll</HintPath>
    <Private>False</Private>
  </Reference>
</ItemGroup>
```

**æ–¹æ³•3ï¼šç¼–ç¨‹æ–¹å¼ï¼ˆä¸æ¨èï¼Œä»…ç¤ºä¾‹ï¼‰ï¼?*

```csharp
// è¿™ç§æ–¹æ³•ä¸æ¨èç”¨äºç”Ÿäº§ç¯å¢?
using System.EnterpriseServices.Internal;
using System.Reflection;

// å®‰è£…åˆ°GAC
public static void InstallAssembly(string assemblyPath)
{
    Publish publish = new Publish();
    publish.GacInstall(assemblyPath);
}

// ä»GACå¸è½½
public static void UninstallAssembly(string assemblyPath)
{
    Assembly assembly = Assembly.LoadFile(assemblyPath);
    string assemblyName = assembly.GetName().Name;
    
    Publish publish = new Publish();
    publish.GacRemove(assemblyPath);
}
```

**åˆ›å»ºå¼ºå‘½åç¨‹åºé›†çš„æ­¥éª¤ï¼š**

1. é¦–å…ˆï¼Œç”Ÿæˆå¯†é’¥å¯¹ï¼?snkæ–‡ä»¶ï¼‰ï¼š

```
sn -k MyKeyPair.snk
```

2. ä½¿ç”¨Visual Studioè®¾ç½®å¼ºå‘½åï¼š
   - é¡¹ç›®å±æ€?â†?ç­¾å â†?å‹¾é€?ä¸ºç¨‹åºé›†ç­¾å"
   - é€‰æ‹©å¯†é’¥æ–‡ä»¶æˆ–åˆ›å»ºæ–°çš„å¯†é’¥æ–‡ä»?

3. æˆ–è€…ä½¿ç”¨AssemblyInfo.csä¸­çš„ç‰¹æ€§ï¼š

```csharp
[assembly: AssemblyKeyFile("MyKeyPair.snk")]
```

4. æˆ–è€…åœ¨.NET Core/.NET 5+é¡¹ç›®ä¸­ä½¿ç”?csprojè®¾ç½®ï¼?

```xml
<PropertyGroup>
  <SignAssembly>true</SignAssembly>
  <AssemblyOriginatorKeyFile>MyKeyPair.snk</AssemblyOriginatorKeyFile>
</PropertyGroup>
```

**æŸ¥çœ‹ç¨‹åºé›†æ˜¯å¦å¼ºå‘½åï¼?*

```
sn -T MyAssembly.dll
```

**ä¼˜ç‚¹åˆ†æï¼?*
- æä¾›ç¨‹åºé›†çš„å”¯ä¸€æ€§å’Œå®Œæ•´æ€§ä¿è¯?
- æ”¯æŒç¨‹åºé›†çš„ç‰ˆæœ¬æ§åˆ¶å’Œå¹¶è¡Œæ‰§è¡?
- é€šè¿‡GACæ”¯æŒç¨‹åºé›†å…±äº«ï¼Œå‡å°‘ç£ç›˜å’Œå†…å­˜å ç”?
- æä¾›å®‰å…¨éªŒè¯æœºåˆ¶ï¼Œé˜²æ­¢ç¨‹åºé›†è¢«ç¯¡æ”?

**ç¼ºç‚¹åˆ†æï¼?*
- å¢åŠ äº†å¼€å‘å’Œéƒ¨ç½²çš„å¤æ‚æ€?
- å¯†é’¥ç®¡ç†çš„è´£ä»»ï¼ˆç§é’¥å¿…é¡»å®‰å…¨ä¿å­˜ï¼?
- GACéƒ¨ç½²éœ€è¦ç®¡ç†å‘˜æƒé™
- åœ¨åŒä¸€å°æœºå™¨ä¸Šæ›´æ–°å…±äº«ç¨‹åºé›†å¯èƒ½å½±å“å¤šä¸ªåº”ç”¨ç¨‹åº?

### æŠ€æœ¯é¢˜3ï¼šç¨‹åºé›†çš„åŠ è½½ä¸AppDomain

**é—®é¢˜ï¼?* è§£é‡Š.NETä¸­ç¨‹åºé›†åŠ è½½çš„è¿‡ç¨‹å’ŒAppDomainçš„ä½œç”¨ã€‚å¦‚ä½•åŠ¨æ€åŠ è½½ç¨‹åºé›†ï¼Œå¹¶è®¨è®ºä¸åŒåŠ è½½æ–¹æ³•çš„åŒºåˆ«å’Œåº”ç”¨åœºæ™¯ã€?

**ç­”æ¡ˆï¼?*

**ç¨‹åºé›†åŠ è½½è¿‡ç¨‹ï¼š**

å½“CLRéœ€è¦è®¿é—®ç¨‹åºé›†ä¸­çš„ç±»å‹æ—¶ï¼Œä¼šæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤åŠ è½½ç¨‹åºé›†ï¼?

1. **æ¢æµ‹**ï¼šCLRç¡®å®šç¨‹åºé›†çš„å®Œæ•´èº«ä»½ï¼ˆåç§°ã€ç‰ˆæœ¬ã€æ–‡åŒ–ã€å…¬é’¥ä»¤ç‰Œï¼‰
2. **æŸ¥æ‰¾**ï¼šæŒ‰ç…§ç‰¹å®šçš„æœç´¢é¡ºåºæŸ¥æ‰¾ç¨‹åºé›†æ–‡ä»?
   - å·²åŠ è½½çš„ç¨‹åºé›†ç¼“å­?
   - GACï¼ˆå¦‚æœæ˜¯å¼ºå‘½åç¨‹åºé›†ï¼?
   - åº”ç”¨ç¨‹åºåŸºç›®å½?
   - ç§æœ‰è·¯å¾„ç›®å½•ï¼ˆå¦‚binç›®å½•ï¼?
   - é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„ç›®å½•ï¼ˆåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ä¸­çš„probingè·¯å¾„ï¼?
3. **åŠ è½½**ï¼šå°†ç¨‹åºé›†æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸?
4. **éªŒè¯**ï¼šå¯¹äºå¼ºå‘½åç¨‹åºé›†ï¼ŒéªŒè¯å…¶æ•°å­—ç­¾å?
5. **å®‰å…¨æ£€æŸ?*ï¼šæ ¹æ®å½“å‰å®‰å…¨ç­–ç•¥è¿›è¡Œæƒé™æ£€æŸ?
6. **ç±»å‹åˆå§‹åŒ?*ï¼šåˆå§‹åŒ–ç±»å‹ç³»ç»Ÿæ‰€éœ€çš„ç±»å?

**AppDomainçš„ä½œç”¨ï¼š**

AppDomainï¼ˆåº”ç”¨ç¨‹åºåŸŸï¼‰æ˜¯CLRä¸­ç”¨äºéš”ç¦»åº”ç”¨ç¨‹åºçš„è½»é‡çº§è¿›ç¨‹ã€?

ä¸»è¦ä½œç”¨ï¼?
1. **éš”ç¦»æ€?*ï¼šä¸åŒAppDomainä¹‹é—´çš„çŠ¶æ€å’Œç±»å‹å½¼æ­¤éš”ç¦»
2. **å®‰å…¨è¾¹ç•Œ**ï¼šå¯ä»¥ä¸ºæ¯ä¸ªAppDomainåˆ†é…ä¸åŒçš„å®‰å…¨æƒé™?
3. **ç¨‹åºé›†åŠ è½½æ§åˆ?*ï¼šæ¯ä¸ªAppDomainæœ‰è‡ªå·±çš„ç¨‹åºé›†åŠ è½½ä¸Šä¸‹æ–‡
4. **åº”ç”¨ç¨‹åºå¸è½½**ï¼šå¯ä»¥å¸è½½å•ä¸ªAppDomainè€Œä¸å½±å“è¿›ç¨‹ä¸­çš„å…¶ä»–AppDomain
5. **æ•…éšœéš”ç¦»**ï¼šä¸€ä¸ªAppDomainä¸­çš„æ•…éšœä¸ä¼šå½±å“å…¶ä»–AppDomain

> æ³¨æ„ï¼šåœ¨.NET Coreå’?NET 5+ä¸­ï¼ŒAppDomainçš„éƒ¨åˆ†åŠŸèƒ½è¢«é™åˆ¶ï¼Œè®¸å¤šéš”ç¦»åœºæ™¯å»ºè®®ä½¿ç”¨AssemblyLoadContextæˆ–å•ç‹¬çš„è¿›ç¨‹ã€?

**åŠ¨æ€åŠ è½½ç¨‹åºé›†çš„æ–¹æ³•ï¼š**

1. **Assembly.Loadæ–¹æ³•ç³»åˆ—ï¼?*

```csharp
// ä»å¼ºåç§°åŠ è½½
Assembly assembly1 = Assembly.Load("MyAssembly, Version=1.0.0.0, Culture=neutral, PublicKeyToken=abcdef1234567890");

// ä»AssemblyNameåŠ è½½
AssemblyName asmName = new AssemblyName("MyAssembly");
asmName.Version = new Version(1, 0, 0, 0);
Assembly assembly2 = Assembly.Load(asmName);

// ä»å­—èŠ‚æ•°ç»„åŠ è½?
byte[] assemblyBytes = File.ReadAllBytes("path/to/MyAssembly.dll");
Assembly assembly3 = Assembly.Load(assemblyBytes);
```

2. **Assembly.LoadFromï¼?*

```csharp
// ä»æ–‡ä»¶è·¯å¾„åŠ è½?
Assembly assembly = Assembly.LoadFrom(@"C:\MyAssemblies\MyAssembly.dll");
```

3. **Assembly.LoadFileï¼?*

```csharp
// ä»å®Œæ•´æ–‡ä»¶è·¯å¾„åŠ è½½ï¼Œä¸ä½¿ç”¨æ ‡å‡†åŠ è½½ä¸Šä¸‹æ–‡
Assembly assembly = Assembly.LoadFile(@"C:\MyAssemblies\MyAssembly.dll");
```

4. **AssemblyLoadContextï¼?NET Core/.NET 5+ï¼‰ï¼š**

```csharp
using System.Runtime.Loader;

// è‡ªå®šä¹‰ç¨‹åºé›†åŠ è½½ä¸Šä¸‹æ–?
class MyLoadContext : AssemblyLoadContext
{
    private string _folderPath;
    
    public MyLoadContext(string folderPath) : base(isCollectible: true)
    {
        _folderPath = folderPath;
    }
    
    protected override Assembly Load(AssemblyName assemblyName)
    {
        string assemblyPath = Path.Combine(_folderPath, $"{assemblyName.Name}.dll");
        if (File.Exists(assemblyPath))
        {
            return LoadFromAssemblyPath(assemblyPath);
        }
        
        return null;
    }
}

// ä½¿ç”¨è‡ªå®šä¹‰åŠ è½½ä¸Šä¸‹æ–‡
var loadContext = new MyLoadContext(@"C:\MyAssemblies");
Assembly assembly = loadContext.LoadFromAssemblyName(new AssemblyName("MyAssembly"));

// ä½¿ç”¨å®Œåå¯ä»¥å¸è½½
loadContext.Unload();
```

**ä¸åŒåŠ è½½æ–¹æ³•çš„åŒºåˆ«ï¼š**

| æ–¹æ³•                        | åŠ è½½ä¸Šä¸‹æ–?               | ä¾èµ–é¡¹è§£æ?              | ä¸»è¦ç”¨é€?                  | æ³¨æ„äº‹é¡¹                              |
| --------------------------- | ------------------------- | ------------------------ | -------------------------- | ------------------------------------- |
| Assembly.Load(AssemblyName) | è°ƒç”¨ç¨‹åºé›†çš„åŠ è½½ä¸Šä¸‹æ–?   | ä½¿ç”¨æ ‡å‡†æ¢æµ‹è§„åˆ™         | é¦–é€‰æ–¹æ³•ï¼ŒæŒ‰å¼ºåç§°åŠ è½½     | éœ€è¦çŸ¥é“å®Œæ•´çš„ç¨‹åºé›†æ ‡è¯?             |
| Assembly.Load(byte[])       | å½“å‰AppDomainçš„åŠ è½½ä¸Šä¸‹æ–‡ | ä½¿ç”¨æ ‡å‡†æ¢æµ‹è§„åˆ™         | åŠ è½½å†…å­˜ä¸­çš„ç¨‹åºé›?        | è¢«åŠ è½½ç¨‹åºé›†çš„ä¾èµ–é¡¹å¿…é¡»å¯ç”¨          |
| Assembly.LoadFrom(string)   | LoadFromä¸Šä¸‹æ–?           | å¯ä»¥ä»åŸå§‹ä½ç½®åŠ è½½ä¾èµ–é¡¹ | ä»ç‰¹å®šè·¯å¾„åŠ è½½ç¨‹åºé›†       | å¯èƒ½å¯¼è‡´åŒä¸€ç¨‹åºé›†çš„å¤šä¸ªå‰¯æœ¬è¢«åŠ è½?   |
| Assembly.LoadFile(string)   | ç‹¬ç«‹åŠ è½½ä¸Šä¸‹æ–?           | ä¸è‡ªåŠ¨è§£æä¾èµ–é¡¹         | åŠ è½½ç‰¹å®šæ–‡ä»¶ï¼Œå¿½ç•¥æ ‡å‡†æ¢æµ?| å¿…é¡»æ‰‹åŠ¨åŠ è½½æ‰€æœ‰ä¾èµ–é¡¹                |
| AssemblyLoadContext         | è‡ªå®šä¹‰åŠ è½½ä¸Šä¸‹æ–‡          | å¯å®Œå…¨å®šåˆ?              | éš”ç¦»åŠ è½½ï¼Œæ”¯æŒå¸è½?        | .NET Core/.NET 5+ç‰¹æœ‰ï¼Œæä¾›æ›´å¥½çš„æ§åˆ¶ |

**åº”ç”¨åœºæ™¯ï¼?*

1. **Assembly.Load(AssemblyName)**ï¼?
   - åŠ è½½å¼ºå‘½åç¨‹åºé›†
   - å½“ç¨‹åºé›†ä½äºæ ‡å‡†æ¢æµ‹è·¯å¾„ä¸?

2. **Assembly.Load(byte[])**ï¼?
   - ä»æ•°æ®åº“æˆ–ç½‘ç»œåŠ è½½ç¨‹åºé›†
   - éœ€è¦é¿å…é”å®šç¨‹åºé›†æ–‡ä»¶

3. **Assembly.LoadFrom**ï¼?
   - åŠ è½½ä½äºéæ ‡å‡†ä½ç½®çš„ç¨‹åºé›?
   - éœ€è¦åŠ è½½ç¨‹åºé›†åŠå…¶ä¾èµ–é¡?

4. **Assembly.LoadFile**ï¼?
   - éœ€è¦åŠ è½½ç‰¹å®šæ–‡ä»¶ï¼Œè€Œä¸è€ƒè™‘æ ‡å‡†åŠ è½½è§„åˆ™
   - éœ€è¦å¯¹ä¾èµ–é¡¹åŠ è½½æœ‰å®Œå…¨æ§åˆ¶

5. **AssemblyLoadContext**ï¼?
   - æ’ä»¶ç³»ç»Ÿï¼Œéœ€è¦éš”ç¦»åŠ è½½å’Œå¸è½½æ’ä»¶
   - éœ€è¦æ”¯æŒå¹¶è¡ŒåŠ è½½åŒä¸€ç¨‹åºé›†çš„ä¸åŒç‰ˆæœ¬
   - éœ€è¦åœ¨.NET Core/.NET 5+ä¸­å®ç°AppDomainç±»ä¼¼çš„éš”ç¦?

**ä¼˜ç‚¹åˆ†æï¼?*
- åŠ¨æ€åŠ è½½æä¾›äº†è¿è¡Œæ—¶çµæ´»æ€§ï¼Œæ”¯æŒæ’ä»¶æ¶æ„
- æŒ‰éœ€åŠ è½½å¯ä»¥å‡å°‘å¯åŠ¨æ—¶é—´å’Œå†…å­˜ä½¿ç”?
- AppDomainæä¾›éš”ç¦»ï¼Œå¢å¼ºå®‰å…¨æ€§å’Œç¨³å®šæ€?
- AssemblyLoadContextåœ?NET Coreä¸­æä¾›æ›´ç»†ç²’åº¦çš„æ§åˆ¶

**ç¼ºç‚¹åˆ†æï¼?*
- åŠ¨æ€åŠ è½½å¢åŠ äº†å¤æ‚æ€§å’Œæ½œåœ¨çš„è¿è¡Œæ—¶é”™è¯¯
- ç‰ˆæœ¬å†²çªå’Œä¾èµ–é¡¹è§£æå¯èƒ½å˜å¾—å¤æ‚
- åå°„å’ŒåŠ¨æ€åŠ è½½é€šå¸¸æ¯”é™æ€å¼•ç”¨æ…¢
- AppDomainåœ?NET Coreä¸­åŠŸèƒ½å—é™?
- éœ€è¦è°¨æ…å¤„ç†å†…å­˜ç®¡ç†ï¼Œé¿å…å†…å­˜æ³„æ¼

## äºŒã€åå°„åŸºç¡€ä¸åº”ç”?

### æŠ€æœ¯é¢˜4ï¼šåå°„çš„åŸºç¡€ä¸Typeç±?

**é—®é¢˜ï¼?* ä»€ä¹ˆæ˜¯åå°„ï¼Ÿè¯·è¯¦ç»†è§£é‡ŠTypeç±»çš„ä½œç”¨å’Œå¦‚ä½•ä½¿ç”¨å®ƒè·å–ç±»å‹ä¿¡æ¯ã€‚æä¾›è·å–ç±»å‹æˆå‘˜ï¼ˆå­—æ®µã€å±æ€§ã€æ–¹æ³•ç­‰ï¼‰çš„ä»£ç ç¤ºä¾‹å¹¶åˆ†æåå°„çš„ä¼˜ç¼ºç‚¹ã€?

**ç­”æ¡ˆï¼?*

**åå°„çš„å®šä¹‰ï¼š**

åå°„æ˜?NETæ¡†æ¶æä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œå…è®¸åœ¨è¿è¡Œæ—¶æ£€æŸ¥ã€å‘ç°å’Œæ“ä½œç±»å‹ã€ç¨‹åºé›†ã€æ¨¡å—ç­‰å…ƒæ•°æ®ã€‚é€šè¿‡åå°„ï¼Œç¨‹åºå¯ä»¥åœ¨è¿è¡Œæ—¶ï¼š
- è·å–ç±»å‹ä¿¡æ¯ï¼ˆå¦‚æˆå‘˜ã€å±æ€§ã€æ–¹æ³•ç­‰ï¼?
- åŠ¨æ€åˆ›å»ºç±»å‹çš„å®ä¾‹
- åŠ¨æ€è°ƒç”¨ç±»å‹çš„æ–¹æ³•
- åŠ¨æ€è®¿é—®å’Œä¿®æ”¹å­—æ®µå’Œå±æ€?
- æ£€æŸ¥è‡ªå®šä¹‰ç‰¹æ€?

**Typeç±»çš„ä½œç”¨ï¼?*

Typeç±»æ˜¯åå°„çš„æ ¸å¿ƒï¼Œå®ƒè¡¨ç¤ºç±»å‹çš„å£°æ˜ï¼Œå¦‚ç±»ã€æ¥å£ã€æ•°ç»„ã€å€¼ç±»å‹æˆ–å§”æ‰˜ã€‚Typeç±»æä¾›äº†ï¼?
- è·å–ç±»å‹ä¿¡æ¯çš„æ–¹æ³?
- æ£€æŸ¥ç±»å‹æˆå‘˜ï¼ˆæ–¹æ³•ã€å±æ€§ã€å­—æ®µç­‰ï¼?
- åˆ›å»ºç±»å‹å®ä¾‹
- æ£€æŸ¥ç±»å‹ç»§æ‰¿å…³ç³»å’Œå®ç°æ¥å£
- è·å–ç±»å‹çš„è‡ªå®šä¹‰ç‰¹æ€?

**è·å–Typeå¯¹è±¡çš„æ–¹æ³•ï¼š**

```csharp
// æ–¹æ³•1ï¼šä½¿ç”¨typeofè¿ç®—ç¬¦ï¼ˆç¼–è¯‘æ—¶ç±»å‹ï¼‰
Type type1 = typeof(string);

// æ–¹æ³•2ï¼šé€šè¿‡å¯¹è±¡çš„GetTypeæ–¹æ³•ï¼ˆè¿è¡Œæ—¶ç±»å‹ï¼?
string s = "Hello";
Type type2 = s.GetType();

// æ–¹æ³•3ï¼šé€šè¿‡Type.GetTypeæ–¹æ³•ï¼ˆä½¿ç”¨ç±»å‹çš„å®Œå…¨é™å®šåï¼‰
Type type3 = Type.GetType("System.String");

// æ–¹æ³•4ï¼šé€šè¿‡Assemblyè·å–
Assembly assembly = Assembly.GetExecutingAssembly();
Type[] types = assembly.GetTypes(); // è·å–ç¨‹åºé›†ä¸­æ‰€æœ‰ç±»å?
```

**è·å–å’Œä½¿ç”¨ç±»å‹æˆå‘˜çš„ç¤ºä¾‹ï¼?*

```csharp
using System;
using System.Reflection;

// ç¤ºä¾‹ç±?
public class Person
{
    // å­—æ®µ
    private int _age;
    public string Name;
    
    // å±æ€?
    public int Age
    {
        get { return _age; }
        set { _age = value > 0 ? value : 0; }
    }
    
    // æ„é€ å‡½æ•?
    public Person() { }
    public Person(string name, int age)
    {
        Name = name;
        Age = age;
    }
    
    // æ–¹æ³•
    public void Introduce()
    {
        Console.WriteLine($"Hi, I'm {Name}, {Age} years old.");
    }
    
    private string GetDetails()
    {
        return $"Name: {Name}, Age: {Age}";
    }
}

class Program
{
    static void Main()
    {
        // è·å–Personç±»å‹
        Type personType = typeof(Person);
        
        Console.WriteLine($"ç±»å‹åç§°: {personType.Name}");
        Console.WriteLine($"å®Œå…¨é™å®šå? {personType.FullName}");
        Console.WriteLine($"å‘½åç©ºé—´: {personType.Namespace}");
        Console.WriteLine($"æ˜¯ç±»å? {personType.IsClass}");
        Console.WriteLine($"æ˜¯å€¼ç±»å‹å—: {personType.IsValueType}");
        Console.WriteLine();
        
        // è·å–æ„é€ å‡½æ•?
        Console.WriteLine("æ„é€ å‡½æ•?");
        ConstructorInfo[] constructors = personType.GetConstructors();
        foreach (var constructor in constructors)
        {
            Console.Write($"- {constructor.Name}(");
            ParameterInfo[] parameters = constructor.GetParameters();
            for (int i = 0; i < parameters.Length; i++)
            {
                Console.Write($"{parameters[i].ParameterType.Name} {parameters[i].Name}");
                if (i < parameters.Length - 1) Console.Write(", ");
            }
            Console.WriteLine(")");
        }
        Console.WriteLine();
        
        // è·å–å­—æ®µï¼ˆåŒ…æ‹¬ç§æœ‰å­—æ®µï¼‰
        Console.WriteLine("å­—æ®µ:");
        FieldInfo[] fields = personType.GetFields(BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance);
        foreach (var field in fields)
        {
            Console.WriteLine($"- {field.FieldType.Name} {field.Name} (æ˜¯ç§æœ‰çš„: {field.IsPrivate})");
        }
        Console.WriteLine();
        
        // è·å–å±æ€?
        Console.WriteLine("å±æ€?");
        PropertyInfo[] properties = personType.GetProperties();
        foreach (var property in properties)
        {
            Console.WriteLine($"- {property.PropertyType.Name} {property.Name} (å¯è¯»: {property.CanRead}, å¯å†™: {property.CanWrite})");
        }
        Console.WriteLine();
        
        // è·å–æ–¹æ³•ï¼ˆåŒ…æ‹¬ç§æœ‰æ–¹æ³•ï¼‰
        Console.WriteLine("æ–¹æ³•:");
        MethodInfo[] methods = personType.GetMethods(BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.DeclaredOnly);
        foreach (var method in methods)
        {
            Console.Write($"- {method.ReturnType.Name} {method.Name}(");
            ParameterInfo[] parameters = method.GetParameters();
            for (int i = 0; i < parameters.Length; i++)
            {
                Console.Write($"{parameters[i].ParameterType.Name} {parameters[i].Name}");
                if (i < parameters.Length - 1) Console.Write(", ");
            }
            Console.WriteLine($") (æ˜¯ç§æœ‰çš„: {method.IsPrivate})");
        }
        Console.WriteLine();
        
        // åŠ¨æ€åˆ›å»ºå®ä¾‹å¹¶è°ƒç”¨æ–¹æ³•
        Console.WriteLine("åŠ¨æ€åˆ›å»ºå®ä¾‹å¹¶è°ƒç”¨æ–¹æ³•:");
        
        // ä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°åˆ›å»ºå®ä¾?
        object person1 = Activator.CreateInstance(personType);
        
        // è·å–å¹¶è®¾ç½®å±æ€?
        PropertyInfo nameProperty = personType.GetField("Name");
        nameProperty.SetValue(person1, "John");
        
        PropertyInfo ageProperty = personType.GetProperty("Age");
        ageProperty.SetValue(person1, 30);
        
        // è°ƒç”¨å…¬å…±æ–¹æ³•
        MethodInfo introduceMethod = personType.GetMethod("Introduce");
        introduceMethod.Invoke(person1, null);
        
        // è°ƒç”¨ç§æœ‰æ–¹æ³•
        MethodInfo detailsMethod = personType.GetMethod("GetDetails", BindingFlags.NonPublic | BindingFlags.Instance);
        string details = (string)detailsMethod.Invoke(person1, null);
        Console.WriteLine($"ä»ç§æœ‰æ–¹æ³•è·å–çš„è¯¦æƒ…: {details}");
        
        // ä½¿ç”¨å¸¦å‚æ•°çš„æ„é€ å‡½æ•°åˆ›å»ºå®ä¾?
        object person2 = Activator.CreateInstance(personType, new object[] { "Jane", 25 });
        introduceMethod.Invoke(person2, null);
    }
}
```

**åå°„çš„ä¼˜ç‚¹ï¼š**

1. **åŠ¨æ€è¡Œä¸?*ï¼šå…è®¸ç¨‹åºåœ¨ç¼–è¯‘æ—¶ä¸çŸ¥é“çš„ç±»å‹ä¸Šæ“ä½œ
2. **çµæ´»æ€?*ï¼šæ”¯æŒæ’ä»¶æ¶æ„ã€é…ç½®é©±åŠ¨çš„åº”ç”¨ç¨‹åºå’ŒåŠ¨æ€åŠ è½?
3. **è‡ªçœèƒ½åŠ›**ï¼šç¨‹åºå¯ä»¥æ£€æŸ¥è‡ªå·±çš„ç»“æ„ï¼Œç”¨äºè°ƒè¯•ã€åºåˆ—åŒ–ç­?
4. **å…ƒç¼–ç¨?*ï¼šèƒ½å¤Ÿç”Ÿæˆä»£ç æˆ–ä¿®æ”¹ç°æœ‰ç±»å‹çš„è¡Œä¸?
5. **é™ä½è€¦åˆåº?*ï¼šç‰¹å®šåœºæ™¯ä¸‹å¯ä»¥å‡å°‘ç›´æ¥ä¾èµ–

**åå°„çš„ç¼ºç‚¹ï¼š**

1. **æ€§èƒ½å¼€é”€**ï¼šåå°„æ“ä½œæ¯”ç›´æ¥è°ƒç”¨æ…¢è®¸å¤šå€?
2. **å®‰å…¨é£é™©**ï¼šå¯ä»¥è®¿é—®ç§æœ‰æˆå‘˜ï¼Œå¯èƒ½ç ´åå°è£…
3. **ç¼ºå°‘ç¼–è¯‘æ—¶æ£€æŸ?*ï¼šç±»å‹é”™è¯¯åœ¨è¿è¡Œæ—¶æ‰ä¼šè¢«å‘ç°
4. **ä»£ç å¯è¯»æ€§é™ä½?*ï¼šåå°„ä»£ç å¾€å¾€éš¾ä»¥ç†è§£å’Œç»´æŠ?
5. **å¯èƒ½ç»•è¿‡å®‰å…¨æœºåˆ¶**ï¼šå¦‚æœæ²¡æœ‰é€‚å½“çš„æƒé™æ£€æŸ¥ï¼Œå¯èƒ½å¯¼è‡´å®‰å…¨é—®é¢˜

**æ€§èƒ½å½±å“ç¤ºä¾‹ï¼?*

```csharp
using System;
using System.Diagnostics;
using System.Reflection;

class PerformanceTest
{
    public static void DirectCall()
    {
        Person person = new Person();
        person.Name = "Test";
        person.Age = 30;
        
        // ç›´æ¥è°ƒç”¨10,000,000æ¬?
        Stopwatch sw = Stopwatch.StartNew();
        for (int i = 0; i < 10_000_000; i++)
        {
            string name = person.Name;
            int age = person.Age;
        }
        sw.Stop();
        Console.WriteLine($"ç›´æ¥è®¿é—®å±æ€§è€—æ—¶: {sw.ElapsedMilliseconds}ms");
    }
    
    public static void ReflectionCall()
    {
        Person person = new Person();
        Type type = typeof(Person);
        PropertyInfo nameProperty = type.GetProperty("Name");
        PropertyInfo ageProperty = type.GetProperty("Age");
        
        // é€šè¿‡åå°„è°ƒç”¨10,000,000æ¬?
        Stopwatch sw = Stopwatch.StartNew();
        for (int i = 0; i < 10_000_000; i++)
        {
            string name = (string)nameProperty.GetValue(person);
            int age = (int)ageProperty.GetValue(person);
        }
        sw.Stop();
        Console.WriteLine($"åå°„è®¿é—®å±æ€§è€—æ—¶: {sw.ElapsedMilliseconds}ms");
    }
    
    public static void CachedReflectionCall()
    {
        Person person = new Person();
        Type type = typeof(Person);
        
        // é¢„ç¼–è¯‘è·å–å§”æ‰˜ï¼ˆæé«˜æ€§èƒ½ï¼?
        var nameGetter = (Func<Person, string>)Delegate.CreateDelegate(
            typeof(Func<Person, string>), 
            type.GetProperty("Name").GetGetMethod());
            
        var ageGetter = (Func<Person, int>)Delegate.CreateDelegate(
            typeof(Func<Person, int>), 
            type.GetProperty("Age").GetGetMethod());
        
        // é€šè¿‡å§”æ‰˜è°ƒç”¨10,000,000æ¬?
        Stopwatch sw = Stopwatch.StartNew();
        for (int i = 0; i < 10_000_000; i++)
        {
            string name = nameGetter(person);
            int age = ageGetter(person);
        }
        sw.Stop();
        Console.WriteLine($"ç¼“å­˜å§”æ‰˜è®¿é—®å±æ€§è€—æ—¶: {sw.ElapsedMilliseconds}ms");
    }
    
    // è°ƒç”¨æµ‹è¯•æ–¹æ³•
    public static void RunTests()
    {
        DirectCall();
        ReflectionCall();
        CachedReflectionCall();
    }
}
```

**ä½¿ç”¨åå°„çš„æœ€ä½³å®è·µï¼š**

1. **ç¼“å­˜åå°„ç»“æœ**ï¼šé‡ç”¨Typeå¯¹è±¡å’ŒMemberInfoå¯¹è±¡ï¼Œé¿å…é‡å¤æŸ¥æ‰?
2. **ä½¿ç”¨é¢„ç¼–è¯‘è¡¨è¾¾å¼**ï¼šå¯¹äºé¢‘ç¹è°ƒç”¨çš„åå°„æ“ä½œï¼Œä½¿ç”¨Expression Treesæˆ–åŠ¨æ€æ–¹æ³•ç”Ÿæˆå§”æ‰?
3. **é™åˆ¶ä½¿ç”¨èŒƒå›´**ï¼šåªåœ¨çœŸæ­£éœ€è¦åŠ¨æ€è¡Œä¸ºçš„åœ°æ–¹ä½¿ç”¨åå°„
4. **è€ƒè™‘æ›¿ä»£æ–¹æ¡ˆ**ï¼šå¦‚æ¥å£ã€å§”æ‰˜ã€è™šæ–¹æ³•æˆ–ç­–ç•¥æ¨¡å¼?
5. **æ­£ç¡®å¤„ç†å¼‚å¸¸**ï¼šåå°„æ“ä½œå¯èƒ½æŠ›å‡ºå¤šç§å¼‚å¸¸ï¼Œç¡®ä¿é€‚å½“æ•è·å’Œå¤„ç?

### æŠ€æœ¯é¢˜5ï¼šåŠ¨æ€åˆ›å»ºå’Œè°ƒç”¨

**é—®é¢˜ï¼?* å¦‚ä½•ä½¿ç”¨åå°„åŠ¨æ€åˆ›å»ºå¯¹è±¡å¹¶è°ƒç”¨å…¶æ–¹æ³•ï¼Ÿæ¯”è¾ƒActivator.CreateInstanceã€æ„é€ å‡½æ•°åå°„å’Œè¡¨è¾¾å¼æ ‘æ–¹æ³•çš„æ€§èƒ½å·®å¼‚ã€‚å®ç°ä¸€ä¸ªç®€å•çš„æ’ä»¶ç³»ç»Ÿï¼Œé€šè¿‡åå°„åŠ¨æ€åŠ è½½å’Œä½¿ç”¨æ’ä»¶ã€?

**ç­”æ¡ˆï¼?*

**åŠ¨æ€åˆ›å»ºå¯¹è±¡çš„æ–¹æ³•ï¼?*

.NETä¸­æœ‰å¤šç§æ–¹å¼å¯ä»¥åŠ¨æ€åˆ›å»ºå¯¹è±¡ï¼š

1. **Activator.CreateInstance**ï¼šæœ€ç®€å•ä½†æ€§èƒ½è¾ƒä½çš„æ–¹æ³?
2. **æ„é€ å‡½æ•°åå°?*ï¼šä½¿ç”¨ConstructorInfo.Invokeæ–¹æ³•
3. **è¡¨è¾¾å¼æ ‘**ï¼šæ€§èƒ½æœ€å¥½ï¼Œä½†ä»£ç è¾ƒå¤æ‚
4. **åŠ¨æ€æ–¹æ³?*ï¼šä½¿ç”¨DynamicMethodå’ŒILç”Ÿæˆ
5. **Delegate.CreateDelegate**ï¼šä¸ºæ–¹æ³•è°ƒç”¨åˆ›å»ºå§”æ‰˜

**åŸºæœ¬ç¤ºä¾‹ - åˆ›å»ºå¯¹è±¡å¹¶è°ƒç”¨æ–¹æ³•ï¼š**

```csharp
using System;
using System.Reflection;
using System.Linq.Expressions;

// ç¤ºä¾‹ç±?
public class Calculator
{
    public int Add(int a, int b) => a + b;
    public int Multiply(int a, int b) => a * b;
}

class Program
{
    static void Main()
    {
        // æ–¹æ³•1ï¼šä½¿ç”¨Activator.CreateInstance
        Calculator calc1 = (Calculator)Activator.CreateInstance(typeof(Calculator));
        Console.WriteLine($"2 + 3 = {calc1.Add(2, 3)}");
        
        // æ–¹æ³•2ï¼šä½¿ç”¨æ„é€ å‡½æ•°åå°?
        ConstructorInfo ctor = typeof(Calculator).GetConstructor(Type.EmptyTypes);
        Calculator calc2 = (Calculator)ctor.Invoke(null);
        Console.WriteLine($"4 * 5 = {calc2.Multiply(4, 5)}");
        
        // æ–¹æ³•3ï¼šä½¿ç”¨è¡¨è¾¾å¼æ ?
        var createExpr = Expression.New(typeof(Calculator));
        var lambdaExpr = Expression.Lambda<Func<Calculator>>(createExpr);
        Func<Calculator> factory = lambdaExpr.Compile();
        Calculator calc3 = factory();
        Console.WriteLine($"3 + 7 = {calc3.Add(3, 7)}");
        
        // åŠ¨æ€è°ƒç”¨æ–¹æ³•ï¼ˆä¸‰ç§ä¸åŒæ–¹å¼ï¼?
        DynamicMethodCall();
    }
    
    static void DynamicMethodCall()
    {
        Type calcType = typeof(Calculator);
        object calc = Activator.CreateInstance(calcType);
        
        // æ–¹æ³•1ï¼šä½¿ç”¨MethodInfo.Invokeï¼ˆæœ€ç®€å•ä½†æœ€æ…¢ï¼‰
        MethodInfo addMethod = calcType.GetMethod("Add");
        int result1 = (int)addMethod.Invoke(calc, new object[] { 10, 20 });
        Console.WriteLine($"10 + 20 = {result1} (é€šè¿‡MethodInfo.Invoke)");
        
        // æ–¹æ³•2ï¼šåˆ›å»ºå§”æ‰˜ï¼ˆæ›´å¿«ï¼?
        var addDelegate = (Func<Calculator, int, int, int>)Delegate.CreateDelegate(
            typeof(Func<Calculator, int, int, int>),
            null,
            addMethod);
            
        int result2 = addDelegate((Calculator)calc, 10, 20);
        Console.WriteLine($"10 + 20 = {result2} (é€šè¿‡å§”æ‰˜)");
        
        // æ–¹æ³•3ï¼šä½¿ç”¨è¡¨è¾¾å¼æ ‘ï¼ˆæœ€å¿«ï¼Œæ¥è¿‘ç›´æ¥è°ƒç”¨ï¼?
        ParameterExpression calcParam = Expression.Parameter(typeof(Calculator), "calc");
        ParameterExpression aParam = Expression.Parameter(typeof(int), "a");
        ParameterExpression bParam = Expression.Parameter(typeof(int), "b");
        
        MethodCallExpression callExpr = Expression.Call(
            calcParam,
            addMethod,
            aParam,
            bParam);
            
        var lambdaExpr = Expression.Lambda<Func<Calculator, int, int, int>>(
            callExpr,
            calcParam,
            aParam,
            bParam);
            
        Func<Calculator, int, int, int> compiledAdd = lambdaExpr.Compile();
        int result3 = compiledAdd((Calculator)calc, 10, 20);
        Console.WriteLine($"10 + 20 = {result3} (é€šè¿‡è¡¨è¾¾å¼æ ‘)");
    }
}
```

**æ€§èƒ½æ¯”è¾ƒï¼?*

ä»¥ä¸‹ä»£ç æ¯”è¾ƒäº†ä¸åŒæ–¹æ³•åˆ›å»ºå¯¹è±¡çš„æ€§èƒ½ï¼?

```csharp
using System;
using System.Diagnostics;
using System.Reflection;
using System.Linq.Expressions;

class PerformanceComparison
{
    // æµ‹è¯•ç›´æ¥å®ä¾‹åŒ?
    public static void TestDirect(int iterations)
    {
        Stopwatch sw = Stopwatch.StartNew();
        for (int i = 0; i < iterations; i++)
        {
            Calculator calc = new Calculator();
            int result = calc.Add(i, i);
        }
        sw.Stop();
        Console.WriteLine($"ç›´æ¥åˆ›å»ºå’Œè°ƒç”? {sw.ElapsedMilliseconds}ms");
    }
    
    // æµ‹è¯•Activator.CreateInstance
    public static void TestActivator(int iterations)
    {
        Type type = typeof(Calculator);
        MethodInfo method = type.GetMethod("Add");
        
        Stopwatch sw = Stopwatch.StartNew();
        for (int i = 0; i < iterations; i++)
        {
            object calc = Activator.CreateInstance(type);
            int result = (int)method.Invoke(calc, new object[] { i, i });
        }
        sw.Stop();
        Console.WriteLine($"Activator.CreateInstance: {sw.ElapsedMilliseconds}ms");
    }
    
    // æµ‹è¯•æ„é€ å‡½æ•°åå°?
    public static void TestConstructor(int iterations)
    {
        Type type = typeof(Calculator);
        ConstructorInfo ctor = type.GetConstructor(Type.EmptyTypes);
        MethodInfo method = type.GetMethod("Add");
        
        Stopwatch sw = Stopwatch.StartNew();
        for (int i = 0; i < iterations; i++)
        {
            object calc = ctor.Invoke(null);
            int result = (int)method.Invoke(calc, new object[] { i, i });
        }
        sw.Stop();
        Console.WriteLine($"æ„é€ å‡½æ•°åå°? {sw.ElapsedMilliseconds}ms");
    }
    
    // æµ‹è¯•è¡¨è¾¾å¼æ ‘
    public static void TestExpressionTree(int iterations)
    {
        // ç¼–è¯‘åˆ›å»ºå¯¹è±¡çš„è¡¨è¾¾å¼
        var createExpr = Expression.New(typeof(Calculator));
        var lambdaExpr = Expression.Lambda<Func<Calculator>>(createExpr);
        Func<Calculator> factory = lambdaExpr.Compile();
        
        // ç¼–è¯‘è°ƒç”¨æ–¹æ³•çš„è¡¨è¾¾å¼
        MethodInfo addMethod = typeof(Calculator).GetMethod("Add");
        ParameterExpression calcParam = Expression.Parameter(typeof(Calculator), "calc");
        ParameterExpression aParam = Expression.Parameter(typeof(int), "a");
        ParameterExpression bParam = Expression.Parameter(typeof(int), "b");
        
        MethodCallExpression callExpr = Expression.Call(
            calcParam,
            addMethod,
            aParam,
            bParam);
            
        var callLambda = Expression.Lambda<Func<Calculator, int, int, int>>(
            callExpr,
            calcParam,
            aParam,
            bParam);
            
        Func<Calculator, int, int, int> compiledAdd = callLambda.Compile();
        
        Stopwatch sw = Stopwatch.StartNew();
        for (int i = 0; i < iterations; i++)
        {
            Calculator calc = factory();
            int result = compiledAdd(calc, i, i);
        }
        sw.Stop();
        Console.WriteLine($"è¡¨è¾¾å¼æ ‘: {sw.ElapsedMilliseconds}ms");
    }
    
    // è¿è¡Œæµ‹è¯•
    public static void RunTests()
    {
        int iterations = 1_000_000;
        Console.WriteLine($"æ‰§è¡Œæ¯ç§æ–¹æ³• {iterations:N0} æ¬?");
        Console.WriteLine("------------------------------");
        
        TestDirect(iterations);
        TestActivator(iterations);
        TestConstructor(iterations);
        TestExpressionTree(iterations);
    }
}
```

**å®ç°ç®€å•çš„æ’ä»¶ç³»ç»Ÿï¼?*

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ’ä»¶ç³»ç»Ÿå®ç°ï¼Œå¯ä»¥åŠ¨æ€åŠ è½½å’Œä½¿ç”¨æ’ä»¶ï¼?

```csharp
using System;
using System.Collections.Generic;
using System.IO;
using System.Reflection;

// æ’ä»¶æ¥å£
public interface IPlugin
{
    string Name { get; }
    string Version { get; }
    void Execute();
}

// æ’ä»¶ç®¡ç†å™?
public class PluginManager
{
    private List<IPlugin> _plugins = new List<IPlugin>();
    
    // ä»ç›®å½•åŠ è½½æ’ä»?
    public void LoadPlugins(string directory)
    {
        // ç¡®ä¿ç›®å½•å­˜åœ¨
        if (!Directory.Exists(directory))
        {
            Console.WriteLine($"æ’ä»¶ç›®å½•ä¸å­˜åœ? {directory}");
            return;
        }
        
        // è·å–æ‰€æœ‰DLLæ–‡ä»¶
        string[] dllFiles = Directory.GetFiles(directory, "*.dll");
        
        foreach (string dllFile in dllFiles)
        {
            try
            {
                // åŠ è½½ç¨‹åºé›?
                Assembly assembly = Assembly.LoadFrom(dllFile);
                
                // æŸ¥æ‰¾å®ç°IPluginæ¥å£çš„ç±»å?
                foreach (Type type in assembly.GetTypes())
                {
                    if (typeof(IPlugin).IsAssignableFrom(type) && !type.IsInterface && !type.IsAbstract)
                    {
                        // åˆ›å»ºæ’ä»¶å®ä¾‹
                        IPlugin plugin = (IPlugin)Activator.CreateInstance(type);
                        _plugins.Add(plugin);
                        
                        Console.WriteLine($"å·²åŠ è½½æ’ä»? {plugin.Name} v{plugin.Version}");
                    }
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"åŠ è½½æ’ä»¶ {dllFile} æ—¶å‡ºé”? {ex.Message}");
            }
        }
    }
    
    // è·å–æ‰€æœ‰å·²åŠ è½½çš„æ’ä»?
    public IEnumerable<IPlugin> GetPlugins()
    {
        return _plugins;
    }
    
    // æ‰§è¡Œç‰¹å®šåç§°çš„æ’ä»?
    public bool ExecutePlugin(string name)
    {
        foreach (var plugin in _plugins)
        {
            if (plugin.Name.Equals(name, StringComparison.OrdinalIgnoreCase))
            {
                Console.WriteLine($"æ‰§è¡Œæ’ä»¶: {plugin.Name}");
                plugin.Execute();
                return true;
            }
        }
        
        Console.WriteLine($"æœªæ‰¾åˆ°æ’ä»? {name}");
        return false;
    }
    
    // æ‰§è¡Œæ‰€æœ‰æ’ä»?
    public void ExecuteAll()
    {
        Console.WriteLine("æ‰§è¡Œæ‰€æœ‰æ’ä»?");
        foreach (var plugin in _plugins)
        {
            Console.WriteLine($"- æ­£åœ¨æ‰§è¡Œ {plugin.Name}...");
            plugin.Execute();
        }
    }
}

// ä¸»ç¨‹åº?
class Program
{
    static void Main()
    {
        PluginManager manager = new PluginManager();
        
        // åŠ è½½æ’ä»¶
        string pluginDir = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, "Plugins");
        manager.LoadPlugins(pluginDir);
        
        // å±•ç¤ºèœå•
        bool exit = false;
        while (!exit)
        {
            Console.WriteLine("\næ’ä»¶ç³»ç»Ÿèœå•:");
            Console.WriteLine("1. åˆ—å‡ºæ‰€æœ‰æ’ä»?);
            Console.WriteLine("2. æ‰§è¡Œç‰¹å®šæ’ä»¶");
            Console.WriteLine("3. æ‰§è¡Œæ‰€æœ‰æ’ä»?);
            Console.WriteLine("4. é€€å‡?);
            
            Console.Write("è¯·é€‰æ‹©æ“ä½œ: ");
            string choice = Console.ReadLine();
            
            switch (choice)
            {
                case "1":
                    ListPlugins(manager);
                    break;
                case "2":
                    ExecuteSpecificPlugin(manager);
                    break;
                case "3":
                    manager.ExecuteAll();
                    break;
                case "4":
                    exit = true;
                    break;
                default:
                    Console.WriteLine("æ— æ•ˆçš„é€‰æ‹©");
                    break;
            }
        }
    }
    
    static void ListPlugins(PluginManager manager)
    {
        Console.WriteLine("\nå·²åŠ è½½çš„æ’ä»¶:");
        int count = 0;
        foreach (var plugin in manager.GetPlugins())
        {
            Console.WriteLine($"{++count}. {plugin.Name} v{plugin.Version}");
        }
        
        if (count == 0)
        {
            Console.WriteLine("æ²¡æœ‰åŠ è½½ä»»ä½•æ’ä»¶");
        }
    }
    
    static void ExecuteSpecificPlugin(PluginManager manager)
    {
        Console.Write("\nè¯·è¾“å…¥è¦æ‰§è¡Œçš„æ’ä»¶åç§? ");
        string name = Console.ReadLine();
        manager.ExecutePlugin(name);
    }
}

// ç¤ºä¾‹æ’ä»¶å®ç°ï¼ˆæ”¾åœ¨å•ç‹¬çš„DLLä¸­ï¼‰
/*
using System;

namespace ExamplePlugin
{
    public class HelloPlugin : IPlugin
    {
        public string Name => "HelloPlugin";
        public string Version => "1.0";
        
        public void Execute()
        {
            Console.WriteLine("Hello from example plugin!");
        }
    }
    
    public class DateTimePlugin : IPlugin
    {
        public string Name => "DateTimePlugin";
        public string Version => "1.2";
        
        public void Execute()
        {
            Console.WriteLine($"Current date and time: {DateTime.Now}");
        }
    }
}
*/
```

**åŠ¨æ€åˆ›å»ºå¯¹è±¡å’Œè°ƒç”¨æ–¹æ³•çš„ä¼˜ç¼ºç‚¹åˆ†æï¼?*

**1. Activator.CreateInstance**
- **ä¼˜ç‚¹**ï¼šä½¿ç”¨ç®€å•ï¼Œä»£ç ç®€æ´?
- **ç¼ºç‚¹**ï¼šæ€§èƒ½æœ€å·®ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦è¿›è¡Œç±»å‹æŸ¥æ‰¾å’Œå®‰å…¨æ£€æŸ?

**2. æ„é€ å‡½æ•°åå°„ï¼ˆConstructorInfo.Invokeï¼?*
- **ä¼˜ç‚¹**ï¼šç›´æ¥ä½¿ç”¨ç‰¹å®šæ„é€ å‡½æ•°ï¼Œç•¥å¿«äºActivator
- **ç¼ºç‚¹**ï¼šä»ç„¶æ¯”ç›´æ¥å®ä¾‹åŒ–æ…¢å¾—å¤š

**3. è¡¨è¾¾å¼æ ‘ï¼ˆExpression Treesï¼?*
- **ä¼˜ç‚¹**ï¼šæ¥è¿‘åŸç”Ÿæ€§èƒ½ï¼Œç¼–è¯‘åçš„å§”æ‰˜å‡ ä¹ä¸ç›´æ¥è°ƒç”¨ä¸€æ ·å¿«
- **ç¼ºç‚¹**ï¼šç¼–å†™å¤æ‚ï¼Œéœ€è¦æ›´å¤šä»£ç ï¼Œé¦–æ¬¡ç¼–è¯‘æœ‰ä¸€å®šå¼€é”€

**4. åŠ¨æ€æ–¹æ³•ï¼ˆILç”Ÿæˆï¼?*
- **ä¼˜ç‚¹**ï¼šé«˜æ€§èƒ½ï¼Œå¯ç›´æ¥è®¿é—®ç§æœ‰æˆå‘˜
- **ç¼ºç‚¹**ï¼šéœ€è¦äº†è§£ILæŒ‡ä»¤ï¼Œéš¾ä»¥ç¼–å†™å’Œç»´æŠ¤

**æ€§èƒ½æ¯”è¾ƒç»“æœï¼ˆç¤ºä¾‹ï¼‰ï¼?*

å¯¹äº100ä¸‡æ¬¡æ“ä½œï¼Œä¸åŒæ–¹æ³•çš„å…¸å‹æ€§èƒ½ç»“æœï¼?
- ç›´æ¥åˆ›å»ºå’Œè°ƒç”¨ï¼šçº?0-30ms
- Activator.CreateInstanceï¼šçº¦800-1000ms
- æ„é€ å‡½æ•°åå°„ï¼šçº?00-900ms
- è¡¨è¾¾å¼æ ‘ï¼šçº¦50-70msï¼ˆé¦–æ¬¡ç¼–è¯‘åï¼?

**ä½¿ç”¨åå°„åˆ›å»ºå¯¹è±¡çš„æœ€ä½³å®è·µï¼š**

1. **é€‰æ‹©æ­£ç¡®çš„æ–¹æ³?*ï¼?
   - ä¸€æ¬¡æ€§æˆ–ä½é¢‘æ“ä½œï¼šä½¿ç”¨Activator.CreateInstance
   - é«˜é¢‘æ“ä½œï¼šä½¿ç”¨è¡¨è¾¾å¼æ ‘æˆ–åŠ¨æ€æ–¹æ³?

2. **ç¼“å­˜åå°„ç»“æœ**ï¼?
   - ç¼“å­˜Typeã€ConstructorInfoå’ŒMethodInfoå¯¹è±¡
   - ç¼“å­˜ç¼–è¯‘åçš„è¡¨è¾¾å¼æ ‘å§”æ‰˜

3. **è€ƒè™‘æ›¿ä»£æ–¹æ¡ˆ**ï¼?
   - å·¥å‚æ–¹æ³•æ¨¡å¼
   - ä¾èµ–æ³¨å…¥å®¹å™¨
   - å¯¹è±¡æ±?

4. **å¤„ç†å¼‚å¸¸**ï¼?
   - æ•è·åˆ›å»ºè¿‡ç¨‹ä¸­å¯èƒ½çš„å¼‚å¸¸
   - è®°å½•è¯¦ç»†é”™è¯¯ä¿¡æ¯
   - æä¾›æœ‰æ„ä¹‰çš„åé¦ˆ

### æŠ€æœ¯é¢˜6ï¼šåå°„ä¸­çš„æ€§èƒ½ä¼˜åŒ–

**é—®é¢˜ï¼?* åå°„æ“ä½œé€šå¸¸æ€§èƒ½è¾ƒä½ï¼Œè¯·è¯¦ç»†è¯´æ˜ä¼˜åŒ–åå°„æ€§èƒ½çš„æ–¹æ³•ï¼Œå¹¶æä¾›ä»£ç ç¤ºä¾‹ã€‚æ¯”è¾ƒç›´æ¥åå°„ã€ç¼“å­˜åå°„ã€è¡¨è¾¾å¼æ ‘å’ŒåŠ¨æ€æ–¹æ³•ç­‰ä¸åŒæ–¹å¼çš„æ€§èƒ½å·®å¼‚ã€‚å¦‚ä½•åœ¨éœ€è¦åå°„åŠŸèƒ½çš„åŒæ—¶æœ€å¤§é™åº¦åœ°å‡å°‘æ€§èƒ½æŸå¤±ï¼?

**ç­”æ¡ˆï¼?*

**åå°„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼?*

åå°„è™½ç„¶åŠŸèƒ½å¼ºå¤§ï¼Œä½†å…¶æ€§èƒ½å¼€é”€æ˜¯ä¸€ä¸ªä¸»è¦ç¼ºç‚¹ã€‚ä»¥ä¸‹æ˜¯å‡ ç§æé«˜åå°„æ€§èƒ½çš„æ–¹æ³•ï¼š

1. **ç¼“å­˜åå°„å¯¹è±¡**ï¼šé‡ç”¨Typeã€MethodInfoã€PropertyInfoç­‰å¯¹è±?
2. **ä½¿ç”¨å§”æ‰˜**ï¼šå°†åå°„è°ƒç”¨è½¬æ¢ä¸ºå§”æ‰˜è°ƒç”?
3. **ä½¿ç”¨è¡¨è¾¾å¼æ ‘**ï¼šç¼–è¯‘ä¸ºå¼ºç±»å‹å§”æ‰?
4. **ä½¿ç”¨åŠ¨æ€æ–¹æ³•å’ŒILç”Ÿæˆ**ï¼šç›´æ¥ç”ŸæˆILä»£ç 
5. **ä½¿ç”¨Dynamicè¯­è¨€è¿è¡Œæ—?DLR)**ï¼šåœ¨.NET 4.0+ä¸­ä½¿ç”¨dynamicå…³é”®å­?
6. **é™åˆ¶åå°„ä½¿ç”¨èŒƒå›´**ï¼šåªåœ¨å¿…è¦æ—¶ä½¿ç”¨åå°„

**åå°„æ€§èƒ½ä¼˜åŒ–ä»£ç ç¤ºä¾‹ï¼?*

```csharp
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq.Expressions;
using System.Reflection;
using System.Reflection.Emit;

public class Person
{
    public string FirstName { get; set; }
    public string LastName { get; set; }
    
    public string GetFullName()
    {
        return $"{FirstName} {LastName}";
    }
}

class ReflectionPerformance
{
    private static readonly int Iterations = 10_000_000;
    
    static void Main()
    {
        // åˆ›å»ºæµ‹è¯•å¯¹è±¡
        var person = new Person { FirstName = "John", LastName = "Doe" };
        
        // è¿è¡Œä¸åŒæ–¹æ³•çš„æ€§èƒ½æµ‹è¯•
        Console.WriteLine($"æ‰§è¡Œæ¯ç§æ–¹æ³• {Iterations:N0} æ¬?\n");
        
        // ç›´æ¥è®¿é—®
        DirectAccess(person);
        
        // ç›´æ¥åå°„ï¼ˆä¸ç¼“å­˜ï¼?
        DirectReflection(person);
        
        // ç¼“å­˜åå°„å¯¹è±¡
        CachedReflection(person);
        
        // ä½¿ç”¨å§”æ‰˜
        DelegateMethod(person);
        
        // ä½¿ç”¨è¡¨è¾¾å¼æ ‘
        ExpressionTreeMethod(person);
        
        // ä½¿ç”¨åŠ¨æ€æ–¹æ³?
        DynamicMethodIL(person);
        
        // ä½¿ç”¨dynamicå…³é”®å­?
        DynamicKeyword(person);
        
        Console.WriteLine("\nå±æ€§è®¾ç½®æµ‹è¯?\n");
        
        // æµ‹è¯•è®¾ç½®å±æ€§å€?
        DirectPropertySet(person);
        ReflectionPropertySet(person);
        DelegatePropertySet(person);
        ExpressionPropertySet(person);
        
        Console.WriteLine("\næ–¹æ³•è°ƒç”¨æµ‹è¯•:\n");
        
        // æµ‹è¯•æ–¹æ³•è°ƒç”¨
        DirectMethodCall(person);
        ReflectionMethodCall(person);
        DelegateMethodCall(person);
        ExpressionMethodCall(person);
    }
    
    // 1. ç›´æ¥è®¿é—®ï¼ˆåŸºå‡†æµ‹è¯•ï¼‰
    static void DirectAccess(Person person)
    {
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < Iterations; i++)
        {
            string firstName = person.FirstName;
        }
        
        sw.Stop();
        Console.WriteLine($"ç›´æ¥è®¿é—®: {sw.ElapsedMilliseconds}ms");
    }
    
    // 2. ç›´æ¥åå°„ï¼ˆæ¯æ¬¡æŸ¥æ‰¾ï¼‰
    static void DirectReflection(Person person)
    {
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < Iterations; i++)
        {
            PropertyInfo prop = typeof(Person).GetProperty("FirstName");
            string firstName = (string)prop.GetValue(person);
        }
        
        sw.Stop();
        Console.WriteLine($"ç›´æ¥åå°„: {sw.ElapsedMilliseconds}ms");
    }
    
    // 3. ç¼“å­˜åå°„å¯¹è±¡
    static void CachedReflection(Person person)
    {
        PropertyInfo prop = typeof(Person).GetProperty("FirstName");
        
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < Iterations; i++)
        {
            string firstName = (string)prop.GetValue(person);
        }
        
        sw.Stop();
        Console.WriteLine($"ç¼“å­˜åå°„: {sw.ElapsedMilliseconds}ms");
    }
    
    // 4. ä½¿ç”¨å§”æ‰˜
    static void DelegateMethod(Person person)
    {
        PropertyInfo prop = typeof(Person).GetProperty("FirstName");
        Func<Person, string> getter = (Func<Person, string>)Delegate.CreateDelegate(
            typeof(Func<Person, string>),
            null,
            prop.GetGetMethod());
        
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < Iterations; i++)
        {
            string firstName = getter(person);
        }
        
        sw.Stop();
        Console.WriteLine($"å§”æ‰˜æ–¹æ³•: {sw.ElapsedMilliseconds}ms");
    }
    
    // 5. ä½¿ç”¨è¡¨è¾¾å¼æ ‘
    static void ExpressionTreeMethod(Person person)
    {
        // ç¼–è¯‘è·å–å±æ€§çš„è¡¨è¾¾å¼æ ‘
        ParameterExpression param = Expression.Parameter(typeof(Person), "p");
        MemberExpression property = Expression.Property(param, "FirstName");
        LambdaExpression lambda = Expression.Lambda(property, param);
        Func<Person, string> getter = (Func<Person, string>)lambda.Compile();
        
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < Iterations; i++)
        {
            string firstName = getter(person);
        }
        
        sw.Stop();
        Console.WriteLine($"è¡¨è¾¾å¼æ ‘: {sw.ElapsedMilliseconds}ms");
    }
    
    // 6. ä½¿ç”¨åŠ¨æ€æ–¹æ³•å’ŒILç”Ÿæˆ
    static void DynamicMethodIL(Person person)
    {
        // åˆ›å»ºåŠ¨æ€æ–¹æ³?
        var method = new DynamicMethod(
            "GetFirstName",
            typeof(string),
            new[] { typeof(Person) },
            typeof(Person).Module);
            
        // è·å–ILç”Ÿæˆå™?
        ILGenerator il = method.GetILGenerator();
        
        // ç”ŸæˆILä»£ç 
        il.Emit(OpCodes.Ldarg_0); // åŠ è½½ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆPersonå¯¹è±¡ï¼?
        il.Emit(OpCodes.Callvirt, typeof(Person).GetProperty("FirstName").GetGetMethod()); // è°ƒç”¨getteræ–¹æ³•
        il.Emit(OpCodes.Ret); // è¿”å›ç»“æœ
        
        // åˆ›å»ºå§”æ‰˜
        var getter = (Func<Person, string>)method.CreateDelegate(typeof(Func<Person, string>));
        
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < Iterations; i++)
        {
            string firstName = getter(person);
        }
        
        sw.Stop();
        Console.WriteLine($"åŠ¨æ€æ–¹æ³•IL: {sw.ElapsedMilliseconds}ms");
    }
    
    // 7. ä½¿ç”¨dynamicå…³é”®å­?
    static void DynamicKeyword(Person person)
    {
        dynamic dynamicPerson = person;
        
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < Iterations; i++)
        {
            string firstName = dynamicPerson.FirstName;
        }
        
        sw.Stop();
        Console.WriteLine($"Dynamicå…³é”®å­? {sw.ElapsedMilliseconds}ms");
    }
    
    // å±æ€§è®¾ç½®æµ‹è¯?
    
    // ç›´æ¥è®¾ç½®å±æ€?
    static void DirectPropertySet(Person person)
    {
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < Iterations; i++)
        {
            person.FirstName = "Jane";
        }
        
        sw.Stop();
        Console.WriteLine($"ç›´æ¥è®¾ç½®å±æ€? {sw.ElapsedMilliseconds}ms");
    }
    
    // åå°„è®¾ç½®å±æ€?
    static void ReflectionPropertySet(Person person)
    {
        PropertyInfo prop = typeof(Person).GetProperty("FirstName");
        
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < Iterations; i++)
        {
            prop.SetValue(person, "Jane");
        }
        
        sw.Stop();
        Console.WriteLine($"åå°„è®¾ç½®å±æ€? {sw.ElapsedMilliseconds}ms");
    }
    
    // å§”æ‰˜è®¾ç½®å±æ€?
    static void DelegatePropertySet(Person person)
    {
        PropertyInfo prop = typeof(Person).GetProperty("FirstName");
        Action<Person, string> setter = (Action<Person, string>)Delegate.CreateDelegate(
            typeof(Action<Person, string>),
            null,
            prop.GetSetMethod());
        
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < Iterations; i++)
        {
            setter(person, "Jane");
        }
        
        sw.Stop();
        Console.WriteLine($"å§”æ‰˜è®¾ç½®å±æ€? {sw.ElapsedMilliseconds}ms");
    }
    
    // è¡¨è¾¾å¼æ ‘è®¾ç½®å±æ€?
    static void ExpressionPropertySet(Person person)
    {
        // ç¼–è¯‘è®¾ç½®å±æ€§çš„è¡¨è¾¾å¼æ ‘
        ParameterExpression instanceParam = Expression.Parameter(typeof(Person), "instance");
        ParameterExpression valueParam = Expression.Parameter(typeof(string), "value");
        MemberExpression propertyRef = Expression.Property(instanceParam, "FirstName");
        BinaryExpression assignExpr = Expression.Assign(propertyRef, valueParam);
        
        var lambda = Expression.Lambda<Action<Person, string>>(
            assignExpr,
            instanceParam,
            valueParam);
            
        Action<Person, string> setter = lambda.Compile();
        
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < Iterations; i++)
        {
            setter(person, "Jane");
        }
        
        sw.Stop();
        Console.WriteLine($"è¡¨è¾¾å¼æ ‘è®¾ç½®å±æ€? {sw.ElapsedMilliseconds}ms");
    }
    
    // æ–¹æ³•è°ƒç”¨æµ‹è¯•
    
    // ç›´æ¥è°ƒç”¨æ–¹æ³•
    static void DirectMethodCall(Person person)
    {
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < Iterations; i++)
        {
            string fullName = person.GetFullName();
        }
        
        sw.Stop();
        Console.WriteLine($"ç›´æ¥è°ƒç”¨æ–¹æ³•: {sw.ElapsedMilliseconds}ms");
    }
    
    // åå°„è°ƒç”¨æ–¹æ³•
    static void ReflectionMethodCall(Person person)
    {
        MethodInfo method = typeof(Person).GetMethod("GetFullName");
        
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < Iterations; i++)
        {
            string fullName = (string)method.Invoke(person, null);
        }
        
        sw.Stop();
        Console.WriteLine($"åå°„è°ƒç”¨æ–¹æ³•: {sw.ElapsedMilliseconds}ms");
    }
    
    // å§”æ‰˜è°ƒç”¨æ–¹æ³•
    static void DelegateMethodCall(Person person)
    {
        MethodInfo method = typeof(Person).GetMethod("GetFullName");
        Func<Person, string> func = (Func<Person, string>)Delegate.CreateDelegate(
            typeof(Func<Person, string>),
            null,
            method);
        
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < Iterations; i++)
        {
            string fullName = func(person);
        }
        
        sw.Stop();
        Console.WriteLine($"å§”æ‰˜è°ƒç”¨æ–¹æ³•: {sw.ElapsedMilliseconds}ms");
    }
    
    // è¡¨è¾¾å¼æ ‘è°ƒç”¨æ–¹æ³•
    static void ExpressionMethodCall(Person person)
    {
        MethodInfo method = typeof(Person).GetMethod("GetFullName");
        
        ParameterExpression param = Expression.Parameter(typeof(Person), "p");
        MethodCallExpression methodCall = Expression.Call(param, method);
        LambdaExpression lambda = Expression.Lambda(methodCall, param);
        Func<Person, string> func = (Func<Person, string>)lambda.Compile();
        
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < Iterations; i++)
        {
            string fullName = func(person);
        }
        
        sw.Stop();
        Console.WriteLine($"è¡¨è¾¾å¼æ ‘è°ƒç”¨æ–¹æ³•: {sw.ElapsedMilliseconds}ms");
    }
}
```

**æ€§èƒ½æ¯”è¾ƒç»“æœï¼ˆç¤ºä¾‹ï¼‰ï¼?*

ä»¥ä¸‹æ˜¯åœ¨å…¸å‹ç³»ç»Ÿä¸Šè¿è¡Œä¸Šè¿°ä»£ç çš„è¿‘ä¼¼ç»“æœï¼?0,000,000æ¬¡æ“ä½œï¼‰ï¼?

**å±æ€§è®¿é—®ï¼š**
- ç›´æ¥è®¿é—®ï¼šçº¦10-20ms
- ç›´æ¥åå°„ï¼šçº¦8000-10000ms
- ç¼“å­˜åå°„ï¼šçº¦2000-3000ms
- å§”æ‰˜æ–¹æ³•ï¼šçº¦50-80ms
- è¡¨è¾¾å¼æ ‘ï¼šçº¦30-60ms
- åŠ¨æ€æ–¹æ³•ILï¼šçº¦20-40ms
- Dynamicå…³é”®å­—ï¼šçº?00-700ms

**å±æ€§è®¾ç½®ï¼š**
- ç›´æ¥è®¾ç½®å±æ€§ï¼šçº?0-20ms
- åå°„è®¾ç½®å±æ€§ï¼šçº?500-3500ms
- å§”æ‰˜è®¾ç½®å±æ€§ï¼šçº?0-80ms
- è¡¨è¾¾å¼æ ‘è®¾ç½®å±æ€§ï¼šçº?0-60ms

**æ–¹æ³•è°ƒç”¨ï¼?*
- ç›´æ¥è°ƒç”¨æ–¹æ³•ï¼šçº¦20-30ms
- åå°„è°ƒç”¨æ–¹æ³•ï¼šçº¦2000-3000ms
- å§”æ‰˜è°ƒç”¨æ–¹æ³•ï¼šçº¦30-50ms
- è¡¨è¾¾å¼æ ‘è°ƒç”¨æ–¹æ³•ï¼šçº¦30-60ms

**åå°„ç¼“å­˜å·¥å…·ç±»ç¤ºä¾‹ï¼š**

ä»¥ä¸‹æ˜¯ä¸€ä¸ªåå°„ç¼“å­˜å·¥å…·ç±»ï¼Œå¯ç”¨äºé«˜æ•ˆåœ°è·å–å’Œè®¾ç½®å±æ€§å€¼ä»¥åŠè°ƒç”¨æ–¹æ³•ï¼š

```csharp
using System;
using System.Collections.Concurrent;
using System.Linq.Expressions;
using System.Reflection;

/// <summary>
/// æä¾›é«˜æ•ˆåå°„æ“ä½œçš„ç¼“å­˜å·¥å…·ç±»
/// </summary>
public static class ReflectionCache
{
    // å±æ€§getterç¼“å­˜
    private static readonly ConcurrentDictionary<PropertyKey, Delegate> PropertyGetters 
        = new ConcurrentDictionary<PropertyKey, Delegate>();
        
    // å±æ€§setterç¼“å­˜
    private static readonly ConcurrentDictionary<PropertyKey, Delegate> PropertySetters 
        = new ConcurrentDictionary<PropertyKey, Delegate>();
        
    // æ–¹æ³•è°ƒç”¨ç¼“å­˜
    private static readonly ConcurrentDictionary<MethodKey, Delegate> MethodCalls 
        = new ConcurrentDictionary<MethodKey, Delegate>();
    
    /// <summary>
    /// è·å–æŒ‡å®šå¯¹è±¡çš„å±æ€§å€?
    /// </summary>
    public static object GetPropertyValue(object obj, string propertyName)
    {
        if (obj == null) throw new ArgumentNullException(nameof(obj));
        if (string.IsNullOrEmpty(propertyName)) throw new ArgumentNullException(nameof(propertyName));
        
        Type type = obj.GetType();
        var key = new PropertyKey(type, propertyName);
        
        // å°è¯•ä»ç¼“å­˜è·å–å§”æ‰?
        if (!PropertyGetters.TryGetValue(key, out Delegate getter))
        {
            // åˆ›å»ºå§”æ‰˜å¹¶æ·»åŠ åˆ°ç¼“å­˜
            PropertyInfo property = type.GetProperty(propertyName);
            if (property == null) 
                throw new ArgumentException($"Property {propertyName} not found on type {type.Name}");
                
            getter = CreatePropertyGetter(property);
            PropertyGetters[key] = getter;
        }
        
        // è°ƒç”¨å§”æ‰˜
        return getter.DynamicInvoke(obj);
    }
    
    /// <summary>
    /// è·å–å¼ºç±»å‹çš„å±æ€§å€?
    /// </summary>
    public static T GetPropertyValue<T>(object obj, string propertyName)
    {
        return (T)GetPropertyValue(obj, propertyName);
    }
    
    /// <summary>
    /// è®¾ç½®æŒ‡å®šå¯¹è±¡çš„å±æ€§å€?
    /// </summary>
    public static void SetPropertyValue(object obj, string propertyName, object value)
    {
        if (obj == null) throw new ArgumentNullException(nameof(obj));
        if (string.IsNullOrEmpty(propertyName)) throw new ArgumentNullException(nameof(propertyName));
        
        Type type = obj.GetType();
        var key = new PropertyKey(type, propertyName);
        
        // å°è¯•ä»ç¼“å­˜è·å–å§”æ‰?
        if (!PropertySetters.TryGetValue(key, out Delegate setter))
        {
            // åˆ›å»ºå§”æ‰˜å¹¶æ·»åŠ åˆ°ç¼“å­˜
            PropertyInfo property = type.GetProperty(propertyName);
            if (property == null) 
                throw new ArgumentException($"Property {propertyName} not found on type {type.Name}");
                
            setter = CreatePropertySetter(property);
            PropertySetters[key] = setter;
        }
        
        // è°ƒç”¨å§”æ‰˜
        setter.DynamicInvoke(obj, value);
    }
    
    /// <summary>
    /// è°ƒç”¨æŒ‡å®šå¯¹è±¡çš„æ–¹æ³?
    /// </summary>
    public static object InvokeMethod(object obj, string methodName, params object[] parameters)
    {
        if (obj == null) throw new ArgumentNullException(nameof(obj));
        if (string.IsNullOrEmpty(methodName)) throw new ArgumentNullException(nameof(methodName));
        
        Type type = obj.GetType();
        Type[] parameterTypes = parameters?.Select(p => p?.GetType() ?? typeof(object)).ToArray() ?? Type.EmptyTypes;
        var key = new MethodKey(type, methodName, parameterTypes);
        
        // å°è¯•ä»ç¼“å­˜è·å–å§”æ‰?
        if (!MethodCalls.TryGetValue(key, out Delegate methodCall))
        {
            // åˆ›å»ºå§”æ‰˜å¹¶æ·»åŠ åˆ°ç¼“å­˜
            MethodInfo method = type.GetMethod(methodName, parameterTypes);
            if (method == null) 
                throw new ArgumentException($"Method {methodName} with specified parameters not found on type {type.Name}");
                
            methodCall = CreateMethodCall(method);
            MethodCalls[key] = methodCall;
        }
        
        // å‡†å¤‡å‚æ•°ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯¹è±¡å®ä¾‹ï¼?
        object[] args = new object[parameters?.Length + 1 ?? 1];
        args[0] = obj;
        if (parameters != null)
        {
            Array.Copy(parameters, 0, args, 1, parameters.Length);
        }
        
        // è°ƒç”¨å§”æ‰˜
        return methodCall.DynamicInvoke(args);
    }
    
    /// <summary>
    /// è°ƒç”¨æŒ‡å®šå¯¹è±¡çš„æ–¹æ³•å¹¶è¿”å›å¼ºç±»å‹ç»“æ?
    /// </summary>
    public static T InvokeMethod<T>(object obj, string methodName, params object[] parameters)
    {
        return (T)InvokeMethod(obj, methodName, parameters);
    }
    
    // åˆ›å»ºå±æ€§getterçš„å§”æ‰?
    private static Delegate CreatePropertyGetter(PropertyInfo property)
    {
        // åˆ›å»ºå‚æ•°è¡¨è¾¾å¼?
        ParameterExpression instance = Expression.Parameter(property.DeclaringType, "instance");
        
        // åˆ›å»ºå±æ€§è®¿é—®è¡¨è¾¾å¼
        MemberExpression propertyAccess = Expression.Property(instance, property);
        
        // åˆ›å»ºlambdaè¡¨è¾¾å¼?
        Type delegateType = typeof(Func<,>).MakeGenericType(property.DeclaringType, property.PropertyType);
        LambdaExpression lambda = Expression.Lambda(delegateType, propertyAccess, instance);
        
        // ç¼–è¯‘å¹¶è¿”å›å§”æ‰?
        return lambda.Compile();
    }
    
    // åˆ›å»ºå±æ€§setterçš„å§”æ‰?
    private static Delegate CreatePropertySetter(PropertyInfo property)
    {
        // åˆ›å»ºå‚æ•°è¡¨è¾¾å¼?
        ParameterExpression instance = Expression.Parameter(property.DeclaringType, "instance");
        ParameterExpression value = Expression.Parameter(property.PropertyType, "value");
        
        // åˆ›å»ºå±æ€§è®¿é—®è¡¨è¾¾å¼
        MemberExpression propertyAccess = Expression.Property(instance, property);
        
        // åˆ›å»ºèµ‹å€¼è¡¨è¾¾å¼
        BinaryExpression assignExpression = Expression.Assign(propertyAccess, value);
        
        // åˆ›å»ºlambdaè¡¨è¾¾å¼?
        Type delegateType = typeof(Action<,>).MakeGenericType(property.DeclaringType, property.PropertyType);
        LambdaExpression lambda = Expression.Lambda(delegateType, assignExpression, instance, value);
        
        // ç¼–è¯‘å¹¶è¿”å›å§”æ‰?
        return lambda.Compile();
    }
    
    // åˆ›å»ºæ–¹æ³•è°ƒç”¨çš„å§”æ‰?
    private static Delegate CreateMethodCall(MethodInfo method)
    {
        // è·å–å‚æ•°ç±»å‹
        Type[] parameterTypes = method.GetParameters().Select(p => p.ParameterType).ToArray();
        
        // åˆ›å»ºå‚æ•°è¡¨è¾¾å¼åˆ—è¡?
        ParameterExpression instance = Expression.Parameter(method.DeclaringType, "instance");
        ParameterExpression[] parameters = parameterTypes
            .Select((type, index) => Expression.Parameter(type, $"param{index}"))
            .ToArray();
        
        // åˆ›å»ºæ–¹æ³•è°ƒç”¨è¡¨è¾¾å¼?
        MethodCallExpression call = Expression.Call(instance, method, parameters);
        
        // åˆ›å»ºå‚æ•°åˆ—è¡¨ï¼ˆå®ä¾?+ æ–¹æ³•å‚æ•°ï¼?
        ParameterExpression[] lambdaParameters = new ParameterExpression[parameters.Length + 1];
        lambdaParameters[0] = instance;
        Array.Copy(parameters, 0, lambdaParameters, 1, parameters.Length);
        
        // åˆ›å»ºå§”æ‰˜ç±»å‹
        Type[] delegateParamTypes = new Type[lambdaParameters.Length];
        for (int i = 0; i < lambdaParameters.Length; i++)
        {
            delegateParamTypes[i] = lambdaParameters[i].Type;
        }
        
        Type delegateType;
        if (method.ReturnType == typeof(void))
        {
            delegateType = Expression.GetActionType(delegateParamTypes);
            
            // åˆ›å»ºlambdaè¡¨è¾¾å¼?
            LambdaExpression lambda = Expression.Lambda(delegateType, call, lambdaParameters);
            return lambda.Compile();
        }
        else
        {
            Type[] funcParamTypes = new Type[delegateParamTypes.Length + 1];
            Array.Copy(delegateParamTypes, funcParamTypes, delegateParamTypes.Length);
            funcParamTypes[funcParamTypes.Length - 1] = method.ReturnType;
            
            delegateType = Expression.GetFuncType(funcParamTypes);
            
            // åˆ›å»ºlambdaè¡¨è¾¾å¼?
            LambdaExpression lambda = Expression.Lambda(delegateType, call, lambdaParameters);
            return lambda.Compile();
        }
    }
    
    // å±æ€§ç¼“å­˜é”®
    private struct PropertyKey : IEquatable<PropertyKey>
    {
        public Type Type { get; }
        public string PropertyName { get; }
        
        public PropertyKey(Type type, string propertyName)
        {
            Type = type;
            PropertyName = propertyName;
        }
        
        public bool Equals(PropertyKey other)
        {
            return Type == other.Type && PropertyName == other.PropertyName;
        }
        
        public override bool Equals(object obj)
        {
            if (obj is PropertyKey key)
                return Equals(key);
            return false;
        }
        
        public override int GetHashCode()
        {
            return (Type?.GetHashCode() ?? 0) ^ (PropertyName?.GetHashCode() ?? 0);
        }
    }
    
    // æ–¹æ³•ç¼“å­˜é”?
    private struct MethodKey : IEquatable<MethodKey>
    {
        public Type Type { get; }
        public string MethodName { get; }
        public Type[] ParameterTypes { get; }
        
        public MethodKey(Type type, string methodName, Type[] parameterTypes)
        {
            Type = type;
            MethodName = methodName;
            ParameterTypes = parameterTypes;
        }
        
        public bool Equals(MethodKey other)
        {
            if (Type != other.Type || MethodName != other.MethodName)
                return false;
                
            if (ParameterTypes.Length != other.ParameterTypes.Length)
                return false;
                
            for (int i = 0; i < ParameterTypes.Length; i++)
            {
                if (ParameterTypes[i] != other.ParameterTypes[i])
                    return false;
            }
            
            return true;
        }
        
        public override bool Equals(object obj)
        {
            if (obj is MethodKey key)
                return Equals(key);
            return false;
        }
        
        public override int GetHashCode()
        {
            int hash = (Type?.GetHashCode() ?? 0) ^ (MethodName?.GetHashCode() ?? 0);
            
            if (ParameterTypes != null)
            {
                for (int i = 0; i < ParameterTypes.Length; i++)
                {
                    hash ^= ParameterTypes[i]?.GetHashCode() ?? 0;
                }
            }
            
            return hash;
        }
    }
}
```

**ä½¿ç”¨åå°„ç¼“å­˜å·¥å…·ç±»çš„ä¾‹å­ï¼?*

```csharp
// ä½¿ç”¨ReflectionCacheå·¥å…·ç±?
public void ReflectionCacheExample()
{
    var person = new Person { FirstName = "John", LastName = "Doe" };
    
    // è·å–å±æ€§å€?
    string firstName = ReflectionCache.GetPropertyValue<string>(person, "FirstName");
    Console.WriteLine($"FirstName: {firstName}");
    
    // è®¾ç½®å±æ€§å€?
    ReflectionCache.SetPropertyValue(person, "FirstName", "Jane");
    Console.WriteLine($"Updated FirstName: {person.FirstName}");
    
    // è°ƒç”¨æ–¹æ³•
    string fullName = ReflectionCache.InvokeMethod<string>(person, "GetFullName");
    Console.WriteLine($"Full Name: {fullName}");
}
```

**åå°„æ€§èƒ½ä¼˜åŒ–çš„æœ€ä½³å®è·µï¼š**

1. **æœ€å°åŒ–åå°„ä½¿ç”¨**ï¼?
   - åªåœ¨å¿…è¦æ—¶ä½¿ç”¨åå°?
   - è€ƒè™‘ä½¿ç”¨æ›¿ä»£è®¾è®¡æ¨¡å¼ï¼ˆå¦‚å·¥å‚ã€ç­–ç•¥æˆ–å§”æ‰˜ï¼?

2. **ç¼“å­˜åå°„ç»“æœ**ï¼?
   - ç¼“å­˜ç±»å‹ã€æˆå‘˜å’Œæ–¹æ³•ä¿¡æ¯
   - ä½¿ç”¨ConcurrentDictionaryå®ç°çº¿ç¨‹å®‰å…¨çš„ç¼“å­?

3. **ä½¿ç”¨å§”æ‰˜ä»£æ›¿ç›´æ¥åå°„**ï¼?
   - å°†åå°„è°ƒç”¨è½¬æ¢ä¸ºå§”æ‰˜
   - é¢„ç¼–è¯‘è¡¨è¾¾å¼æ ?
   - åˆ›å»ºä¸“ç”¨ç¼“å­˜å·¥å…·ç±?

4. **ä½¿ç”¨å·¥å…·åº?*ï¼?
   - FastMember
   - Fasterflect
   - Reflection.Emitå¢å¼ºåº?

5. **æ…ç”¨Dynamic**ï¼?
   - dynamicå…³é”®å­—è™½ç„¶ç®€åŒ–ä»£ç ï¼Œä½†æ€§èƒ½ä¸å¦‚ä¼˜åŒ–çš„åå°?

6. **é€‚å½“çš„ç²’åº?*ï¼?
   - å¯¹é¢‘ç¹è°ƒç”¨çš„æ“ä½œè¿›è¡Œä¼˜åŒ–
   - å¹³è¡¡ä»£ç å¤æ‚æ€§å’Œæ€§èƒ½

7. **é™åˆ¶åŠ¨æ€è¡Œä¸ºèŒƒå›?*ï¼?
   - å°†åå°„éš”ç¦»åœ¨ç‰¹å®šç»„ä»¶ä¸?
   - ä¸ºåŠ¨æ€æ“ä½œåˆ›å»ºé™æ€åŒ…è£?

8. **è€ƒè™‘ILç”Ÿæˆ**ï¼?
   - å¯¹äºæç«¯æ€§èƒ½è¦æ±‚çš„åœºæ™¯ï¼Œä½¿ç”¨ILç”Ÿæˆ
   - ä½¿ç”¨DynamicMethodè¿›è¡Œé«˜æ•ˆè°ƒç”¨

9. **æ€§èƒ½ç›‘æ§**ï¼?
   - å¯¹åå°„æ“ä½œè¿›è¡ŒåŸºå‡†æµ‹è¯?
   - è¯†åˆ«å’Œä¼˜åŒ–çƒ­ç‚¹è·¯å¾?

**ä¼˜ç‚¹åˆ†æï¼?*
- é€šè¿‡ç¼“å­˜å’Œç¼–è¯‘å§”æ‰˜ï¼Œå¯ä»¥å°†åå°„æ€§èƒ½æé«˜åˆ°æ¥è¿‘ç›´æ¥è°ƒç”¨çš„æ°´å¹³
- ä¿ç•™äº†åå°„çš„åŠ¨æ€ç‰¹æ€§å’Œçµæ´»æ€?
- è¡¨è¾¾å¼æ ‘æä¾›äº†ç±»å‹å®‰å…¨å’Œè‰¯å¥½çš„æ€§èƒ½
- å°è£…çš„åå°„ç¼“å­˜APIç®€åŒ–äº†ä½¿ç”¨

**ç¼ºç‚¹åˆ†æï¼?*
- å¢åŠ äº†ä»£ç å¤æ‚æ€?
- é¦–æ¬¡ç¼–è¯‘è¡¨è¾¾å¼æ ‘æœ‰ä¸€å®šå¼€é”€
- ç¼“å­˜å¢åŠ äº†å†…å­˜ä½¿ç”?
- ILç”Ÿæˆéœ€è¦æ›´ä¸“ä¸šçš„çŸ¥è¯?
- ä»æœ‰ä¸€å®šçš„æ€§èƒ½å¼€é”€ï¼Œä¸å¦‚ç›´æ¥è°ƒç”?

## ä¸‰ã€å…ƒæ•°æ®ä¸è‡ªå®šä¹‰ç‰¹æ€?

### æŠ€æœ¯é¢˜7ï¼šå…ƒæ•°æ®åŸºç¡€ä¸åº”ç”?

**é—®é¢˜ï¼?* ä»€ä¹ˆæ˜¯.NETä¸­çš„å…ƒæ•°æ®ï¼Ÿè¯·è¯¦ç»†è§£é‡Šå®ƒçš„ä½œç”¨å’Œåº”ç”¨åœºæ™¯ã€‚æè¿°å¦‚ä½•ä½¿ç”¨åå°„è¯»å–å’Œå¤„ç†å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¹¶æä¾›ä¸€ä¸ªå®é™…æ¡ˆä¾‹ã€?

**ç­”æ¡ˆï¼?*

**å…ƒæ•°æ®çš„å®šä¹‰ï¼?*

å…ƒæ•°æ®æ˜¯æè¿°æ•°æ®çš„æ•°æ®ï¼Œåœ?NETä¸­ï¼Œå…ƒæ•°æ®æ˜¯å¯¹ç¨‹åºé›†ã€ç±»å‹ã€æˆå‘˜å’Œå…¶ä»–ç¨‹åºå®ä½“çš„ç»“æ„åŒ–æè¿°ã€‚å®ƒå­˜å‚¨åœ¨ç¨‹åºé›†å†…éƒ¨ï¼Œä½œä¸ºä¸€ç§è‡ªæè¿°æœºåˆ¶ï¼Œä½¿CLRèƒ½å¤Ÿäº†è§£ç¨‹åºçš„ç»“æ„å’Œè¡Œä¸ºã€?

**å…ƒæ•°æ®çš„ç»„æˆï¼?*

1. **ç±»å‹å®šä¹‰**ï¼šç±»ã€æ¥å£ã€ç»“æ„ã€æšä¸¾ç­‰çš„å®Œæ•´æè¿?
2. **æˆå‘˜å®šä¹‰**ï¼šå­—æ®µã€å±æ€§ã€æ–¹æ³•ã€äº‹ä»¶ç­‰çš„ç­¾åå’Œè®¿é—®ä¿®é¥°ç¬?
3. **ç‰¹æ€§ä¿¡æ?*ï¼šåº”ç”¨äºå„ç§å…ƒç´ çš„è‡ªå®šä¹‰ç‰¹æ€?Attributes)
4. **ç¨‹åºé›†ä¿¡æ?*ï¼šç‰ˆæœ¬ã€æ–‡åŒ–ã€å…¬é’¥ç­‰
5. **èµ„æºä¿¡æ¯**ï¼šåµŒå…¥çš„èµ„æºæ–‡ä»¶
6. **å®‰å…¨ä¿¡æ¯**ï¼šæƒé™è®¾ç½®å’Œè¯·æ±‚
7. **å¼•ç”¨ä¿¡æ¯**ï¼šå¯¹å…¶ä»–ç¨‹åºé›†çš„å¼•ç”¨

**å…ƒæ•°æ®çš„ä½œç”¨ï¼?*

1. **ç±»å‹å®‰å…¨**ï¼šCLRä½¿ç”¨å…ƒæ•°æ®éªŒè¯ç±»å‹å®‰å…¨æ€?
2. **å†…å­˜å¸ƒå±€**ï¼šæŒ‡å¯¼CLRå¦‚ä½•åœ¨å†…å­˜ä¸­å¸ƒå±€å¯¹è±¡
3. **åºåˆ—åŒ?*ï¼šæä¾›åºåˆ—åŒ–/ååºåˆ—åŒ–æ‰€éœ€çš„ä¿¡æ?
4. **åå°„**ï¼šæ”¯æŒåœ¨è¿è¡Œæ—¶æ£€æŸ¥å’Œæ“ä½œç±»å‹
5. **äº’æ“ä½?*ï¼šå¯ç”¨ä¸éæ‰˜ç®¡ä»£ç çš„äº¤äº’
6. **ä»£ç ç”Ÿæˆ**ï¼šæ”¯æŒåŠ¨æ€ä»£ç ç”Ÿæˆå’Œå³æ—¶(JIT)ç¼–è¯‘
7. **å·¥å…·æ”¯æŒ**ï¼šä¸ºå¼€å‘å·¥å…·ã€è°ƒè¯•å™¨æä¾›ä¿¡æ¯

**å…ƒæ•°æ®çš„åº”ç”¨åœºæ™¯ï¼?*

1. **åå°„å’ŒåŠ¨æ€ç¼–ç¨?*ï¼šè¿è¡Œæ—¶å‘ç°å’Œè°ƒç”¨ç±»å‹å’Œæˆå‘˜
2. **åºåˆ—åŒ–å’Œæ•°æ®ç»‘å®š**ï¼šè‡ªåŠ¨å°†å¯¹è±¡è½¬æ¢ä¸ºå…¶ä»–æ ¼å¼æˆ–ç»‘å®šåˆ°UI
3. **ä¾èµ–æ³¨å…¥**ï¼šè¯†åˆ«éœ€è¦æ³¨å…¥çš„ä¾èµ–é¡?
4. **ORM(å¯¹è±¡å…³ç³»æ˜ å°„)**ï¼šå°†ç±»æ˜ å°„åˆ°æ•°æ®åº“è¡¨
5. **ä»£ç ç”Ÿæˆå·¥å…·**ï¼šæ ¹æ®å…ƒæ•°æ®ç”Ÿæˆä»£ç 
6. **æ–‡æ¡£ç”Ÿæˆ**ï¼šä»ä»£ç å’Œæ³¨é‡Šç”Ÿæˆæ–‡æ¡?
7. **éªŒè¯å’ŒAOP(é¢å‘æ–¹é¢ç¼–ç¨‹)**ï¼šåœ¨è¿è¡Œæ—¶æ£€æŸ¥å’Œå¢å¼ºè¡Œä¸º

**ä½¿ç”¨åå°„è¯»å–å…ƒæ•°æ®çš„ç¤ºä¾‹ï¼?*

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Reflection;
using System.Text;

class MetadataExplorer
{
    public static void ExploreAssembly(Assembly assembly)
    {
        Console.WriteLine($"ç¨‹åºé›? {assembly.FullName}");
        Console.WriteLine("-------------------------------");
        
        // ç¨‹åºé›†çº§åˆ«çš„å…ƒæ•°æ?
        Console.WriteLine("ç¨‹åºé›†å…ƒæ•°æ®:");
        Console.WriteLine($"- åç§°: {assembly.GetName().Name}");
        Console.WriteLine($"- ç‰ˆæœ¬: {assembly.GetName().Version}");
        Console.WriteLine($"- æ–‡åŒ–: {assembly.GetName().CultureInfo.Name}");
        
        // è‡ªå®šä¹‰ç‰¹æ€?
        Console.WriteLine("\nç¨‹åºé›†ç‰¹æ€?");
        foreach (var attribute in assembly.GetCustomAttributes())
        {
            Console.WriteLine($"- {attribute.GetType().Name}");
        }
        
        // å¼•ç”¨çš„ç¨‹åºé›†
        Console.WriteLine("\nå¼•ç”¨çš„ç¨‹åºé›†:");
        foreach (var reference in assembly.GetReferencedAssemblies())
        {
            Console.WriteLine($"- {reference.Name} (v{reference.Version})");
        }
        
        // å¯¼å‡ºçš„ç±»å?
        Console.WriteLine("\nå¯¼å‡ºçš„ç±»å?");
        foreach (var type in assembly.GetExportedTypes())
        {
            Console.WriteLine($"\nç±»å‹: {type.FullName}");
            Console.WriteLine($"- æ˜¯ç±»: {type.IsClass}");
            Console.WriteLine($"- æ˜¯æ¥å? {type.IsInterface}");
            Console.WriteLine($"- æ˜¯æŠ½è±¡çš„: {type.IsAbstract}");
            Console.WriteLine($"- æ˜¯å¯†å°çš„: {type.IsSealed}");
            Console.WriteLine($"- æ˜¯æ³›å? {type.IsGenericType}");
            
            // åŸºç±»å’Œå®ç°çš„æ¥å£
            if (type.BaseType != null && type.BaseType != typeof(object))
            {
                Console.WriteLine($"- åŸºç±»: {type.BaseType.Name}");
            }
            
            if (type.GetInterfaces().Length > 0)
            {
                Console.WriteLine("- å®ç°çš„æ¥å? " + 
                    string.Join(", ", type.GetInterfaces().Select(i => i.Name)));
            }
            
            // ç±»å‹çš„ç‰¹æ€?
            var typeAttributes = type.GetCustomAttributes();
            if (typeAttributes.Any())
            {
                Console.WriteLine("- ç‰¹æ€? " + 
                    string.Join(", ", typeAttributes.Select(a => a.GetType().Name)));
            }
            
            // æˆå‘˜
            Console.WriteLine("- æˆå‘˜:");
            
            // å­—æ®µ
            foreach (var field in type.GetFields(BindingFlags.Public | BindingFlags.NonPublic | 
                                                BindingFlags.Static | BindingFlags.Instance))
            {
                Console.WriteLine($"  å­—æ®µ: {field.Name} ({GetAccessModifier(field)} {field.FieldType.Name})");
                
                foreach (var attr in field.GetCustomAttributes())
                {
                    Console.WriteLine($"    ç‰¹æ€? {attr.GetType().Name}");
                }
            }
            
            // å±æ€?
            foreach (var property in type.GetProperties(BindingFlags.Public | BindingFlags.NonPublic | 
                                                       BindingFlags.Static | BindingFlags.Instance))
            {
                string accessors = "";
                if (property.CanRead) accessors += "get ";
                if (property.CanWrite) accessors += "set";
                
                Console.WriteLine($"  å±æ€? {property.Name} ({property.PropertyType.Name}) [{accessors}]");
                
                foreach (var attr in property.GetCustomAttributes())
                {
                    Console.WriteLine($"    ç‰¹æ€? {attr.GetType().Name}");
                }
            }
            
            // æ–¹æ³•
            foreach (var method in type.GetMethods(BindingFlags.Public | BindingFlags.NonPublic | 
                                                  BindingFlags.Static | BindingFlags.Instance | 
                                                  BindingFlags.DeclaredOnly))
            {
                StringBuilder methodInfo = new StringBuilder();
                methodInfo.Append($"  æ–¹æ³•: {GetAccessModifier(method)} ");
                
                if (method.IsStatic) methodInfo.Append("static ");
                if (method.IsVirtual) methodInfo.Append("virtual ");
                if (method.IsAbstract) methodInfo.Append("abstract ");
                if (method.IsGenericMethod) methodInfo.Append("generic ");
                
                methodInfo.Append($"{method.ReturnType.Name} {method.Name}(");
                
                var parameters = method.GetParameters();
                for (int i = 0; i < parameters.Length; i++)
                {
                    var param = parameters[i];
                    methodInfo.Append($"{param.ParameterType.Name} {param.Name}");
                    
                    if (param.IsOptional)
                        methodInfo.Append(" = default");
                        
                    if (i < parameters.Length - 1)
                        methodInfo.Append(", ");
                }
                methodInfo.Append(")");
                
                Console.WriteLine(methodInfo.ToString());
                
                foreach (var attr in method.GetCustomAttributes())
                {
                    Console.WriteLine($"    ç‰¹æ€? {attr.GetType().Name}");
                }
            }
        }
    }
    
    private static string GetAccessModifier(FieldInfo field)
    {
        if (field.IsPublic) return "public";
        if (field.IsPrivate) return "private";
        if (field.IsFamily) return "protected";
        if (field.IsAssembly) return "internal";
        if (field.IsFamilyOrAssembly) return "protected internal";
        return "unknown";
    }
    
    private static string GetAccessModifier(MethodInfo method)
    {
        if (method.IsPublic) return "public";
        if (method.IsPrivate) return "private";
        if (method.IsFamily) return "protected";
        if (method.IsAssembly) return "internal";
        if (method.IsFamilyOrAssembly) return "protected internal";
        return "unknown";
    }
}

// ä½¿ç”¨å…ƒæ•°æ®æµè§ˆå™¨
class Program
{
    static void Main()
    {
        // æµè§ˆå½“å‰ç¨‹åºé›?
        MetadataExplorer.ExploreAssembly(Assembly.GetExecutingAssembly());
        
        // æµè§ˆç³»ç»Ÿç¨‹åºé›?
        MetadataExplorer.ExploreAssembly(typeof(string).Assembly);
    }
}
```

**å®é™…æ¡ˆä¾‹ - ä½¿ç”¨å…ƒæ•°æ®çš„ç®€å•ORMæ¡†æ¶ï¼?*

```csharp
using System;
using System.Collections.Generic;
using System.Data;
using System.Data.SqlClient;
using System.Linq;
using System.Reflection;
using System.Text;

// ç‰¹æ€§å®šä¹?
[AttributeUsage(AttributeTargets.Class)]
public class TableAttribute : Attribute
{
    public string TableName { get; }
    
    public TableAttribute(string tableName)
    {
        TableName = tableName;
    }
}

[AttributeUsage(AttributeTargets.Property)]
public class ColumnAttribute : Attribute
{
    public string ColumnName { get; }
    
    public ColumnAttribute(string columnName)
    {
        ColumnName = columnName;
    }
}

[AttributeUsage(AttributeTargets.Property)]
public class PrimaryKeyAttribute : Attribute
{
}

[AttributeUsage(AttributeTargets.Property)]
public class AutoIncrementAttribute : Attribute
{
}

[AttributeUsage(AttributeTargets.Property)]
public class NotMappedAttribute : Attribute
{
}

// ç®€å•ORMæ¡†æ¶
public class SimpleORM
{
    private readonly string _connectionString;
    
    public SimpleORM(string connectionString)
    {
        _connectionString = connectionString;
    }
    
    // æ ¹æ®IDæŸ¥è¯¢å¯¹è±¡
    public T GetById<T>(object id) where T : new()
    {
        Type type = typeof(T);
        string tableName = GetTableName(type);
        string primaryKeyColumn = GetPrimaryKeyColumnName(type);
        
        if (string.IsNullOrEmpty(primaryKeyColumn))
            throw new InvalidOperationException($"No primary key defined for type {type.Name}");
        
        string query = $"SELECT * FROM {tableName} WHERE {primaryKeyColumn} = @Id";
        
        using (SqlConnection connection = new SqlConnection(_connectionString))
        using (SqlCommand command = new SqlCommand(query, connection))
        {
            command.Parameters.AddWithValue("@Id", id);
            connection.Open();
            
            using (SqlDataReader reader = command.ExecuteReader())
            {
                if (reader.Read())
                {
                    return MapToObject<T>(reader);
                }
            }
        }
        
        return default;
    }
    
    // ä¿å­˜å¯¹è±¡ï¼ˆæ’å…¥æˆ–æ›´æ–°ï¼?
    public void Save<T>(T entity) where T : new()
    {
        Type type = typeof(T);
        string tableName = GetTableName(type);
        string primaryKeyColumn = GetPrimaryKeyColumnName(type);
        PropertyInfo primaryKeyProperty = GetPrimaryKeyProperty(type);
        
        if (primaryKeyProperty == null)
            throw new InvalidOperationException($"No primary key defined for type {type.Name}");
        
        object primaryKeyValue = primaryKeyProperty.GetValue(entity);
        bool isAutoIncrement = primaryKeyProperty.GetCustomAttribute<AutoIncrementAttribute>() != null;
        
        // å†³å®šæ˜¯æ’å…¥è¿˜æ˜¯æ›´æ–?
        if (primaryKeyValue == null || 
            (primaryKeyValue is int intValue && intValue == 0) ||
            string.IsNullOrEmpty(primaryKeyValue.ToString()))
        {
            // æ‰§è¡Œæ’å…¥
            InsertEntity(entity, type, tableName, primaryKeyProperty, isAutoIncrement);
        }
        else
        {
            // æ‰§è¡Œæ›´æ–°
            UpdateEntity(entity, type, tableName, primaryKeyColumn, primaryKeyValue);
        }
    }
    
    // åˆ é™¤å¯¹è±¡
    public void Delete<T>(T entity) where T : new()
    {
        Type type = typeof(T);
        string tableName = GetTableName(type);
        string primaryKeyColumn = GetPrimaryKeyColumnName(type);
        PropertyInfo primaryKeyProperty = GetPrimaryKeyProperty(type);
        
        if (primaryKeyProperty == null)
            throw new InvalidOperationException($"No primary key defined for type {type.Name}");
        
        object primaryKeyValue = primaryKeyProperty.GetValue(entity);
        
        if (primaryKeyValue == null)
            throw new InvalidOperationException("Cannot delete entity with null primary key");
        
        string query = $"DELETE FROM {tableName} WHERE {primaryKeyColumn} = @Id";
        
        using (SqlConnection connection = new SqlConnection(_connectionString))
        using (SqlCommand command = new SqlCommand(query, connection))
        {
            command.Parameters.AddWithValue("@Id", primaryKeyValue);
            connection.Open();
            command.ExecuteNonQuery();
        }
    }
    
    // æŸ¥è¯¢æ‰€æœ‰å¯¹è±?
    public List<T> GetAll<T>() where T : new()
    {
        Type type = typeof(T);
        string tableName = GetTableName(type);
        
        string query = $"SELECT * FROM {tableName}";
        List<T> results = new List<T>();
        
        using (SqlConnection connection = new SqlConnection(_connectionString))
        using (SqlCommand command = new SqlCommand(query, connection))
        {
            connection.Open();
            
            using (SqlDataReader reader = command.ExecuteReader())
            {
                while (reader.Read())
                {
                    T entity = MapToObject<T>(reader);
                    results.Add(entity);
                }
            }
        }
        
        return results;
    }
    
    // æ ¹æ®æŸ¥è¯¢è·å–å¯¹è±¡
    public List<T> Query<T>(string whereClause, Dictionary<string, object> parameters) where T : new()
    {
        Type type = typeof(T);
        string tableName = GetTableName(type);
        
        string query = $"SELECT * FROM {tableName}";
        if (!string.IsNullOrEmpty(whereClause))
        {
            query += $" WHERE {whereClause}";
        }
        
        List<T> results = new List<T>();
        
        using (SqlConnection connection = new SqlConnection(_connectionString))
        using (SqlCommand command = new SqlCommand(query, connection))
        {
            if (parameters != null)
            {
                foreach (var param in parameters)
                {
                    command.Parameters.AddWithValue($"@{param.Key}", param.Value ?? DBNull.Value);
                }
            }
            
            connection.Open();
            
            using (SqlDataReader reader = command.ExecuteReader())
            {
                while (reader.Read())
                {
                    T entity = MapToObject<T>(reader);
                    results.Add(entity);
                }
            }
        }
        
        return results;
    }
    
    // å°†æ•°æ®è¡Œæ˜ å°„åˆ°å¯¹è±?
    private T MapToObject<T>(SqlDataReader reader) where T : new()
    {
        T entity = new T();
        Type type = typeof(T);
        
        foreach (PropertyInfo property in type.GetProperties())
        {
            // è·³è¿‡ä¸æ˜ å°„çš„å±æ€?
            if (property.GetCustomAttribute<NotMappedAttribute>() != null)
                continue;
                
            // è·å–åˆ—å
            string columnName = GetColumnName(property);
            
            // æ£€æŸ¥æ•°æ®è¡¨ä¸­æ˜¯å¦å­˜åœ¨æ­¤åˆ?
            try
            {
                int ordinal = reader.GetOrdinal(columnName);
                
                // ä¸å¤„ç†DBNullå€?
                if (!reader.IsDBNull(ordinal))
                {
                    object value = reader.GetValue(ordinal);
                    
                    // è½¬æ¢ç±»å‹
                    if (value is decimal && property.PropertyType == typeof(double))
                    {
                        value = Convert.ToDouble(value);
                    }
                    else if (property.PropertyType.IsEnum)
                    {
                        value = Enum.ToObject(property.PropertyType, value);
                    }
                    
                    property.SetValue(entity, value);
                }
            }
            catch (IndexOutOfRangeException)
            {
                // åˆ—ä¸å­˜åœ¨ï¼Œè·³è¿?
                continue;
            }
        }
        
        return entity;
    }
    
    // æ’å…¥å®ä½“
    private void InsertEntity<T>(T entity, Type type, string tableName, PropertyInfo primaryKeyProperty, bool isAutoIncrement)
    {
        StringBuilder columnNames = new StringBuilder();
        StringBuilder parameterNames = new StringBuilder();
        List<PropertyInfo> mappedProperties = new List<PropertyInfo>();
        
        foreach (PropertyInfo property in type.GetProperties())
        {
            // è·³è¿‡ä¸æ˜ å°„çš„å±æ€?
            if (property.GetCustomAttribute<NotMappedAttribute>() != null)
                continue;
                
            // è·³è¿‡è‡ªå¢ä¸»é”®
            if (property == primaryKeyProperty && isAutoIncrement)
                continue;
                
            mappedProperties.Add(property);
            
            if (columnNames.Length > 0)
            {
                columnNames.Append(", ");
                parameterNames.Append(", ");
            }
            
            string columnName = GetColumnName(property);
            columnNames.Append(columnName);
            parameterNames.Append($"@{property.Name}");
        }
        
        string query = $"INSERT INTO {tableName} ({columnNames}) VALUES ({parameterNames})";
        
        // å¦‚æœæ˜¯è‡ªå¢ä¸»é”®ï¼Œè·å–æ–°ID
        if (isAutoIncrement)
        {
            query += "; SELECT SCOPE_IDENTITY();";
        }
        
        using (SqlConnection connection = new SqlConnection(_connectionString))
        using (SqlCommand command = new SqlCommand(query, connection))
        {
            // æ·»åŠ å‚æ•°
            foreach (PropertyInfo property in mappedProperties)
            {
                object value = property.GetValue(entity) ?? DBNull.Value;
                command.Parameters.AddWithValue($"@{property.Name}", value);
            }
            
            connection.Open();
            
            if (isAutoIncrement)
            {
                // è·å–æ–°IDå¹¶è®¾ç½®åˆ°å®ä½“
                object newId = command.ExecuteScalar();
                if (newId != null && newId != DBNull.Value)
                {
                    // è½¬æ¢IDç±»å‹
                    if (primaryKeyProperty.PropertyType == typeof(int))
                        primaryKeyProperty.SetValue(entity, Convert.ToInt32(newId));
                    else if (primaryKeyProperty.PropertyType == typeof(long))
                        primaryKeyProperty.SetValue(entity, Convert.ToInt64(newId));
                    else
                        primaryKeyProperty.SetValue(entity, newId);
                }
            }
            else
            {
                command.ExecuteNonQuery();
            }
        }
    }
    
    // æ›´æ–°å®ä½“
    private void UpdateEntity<T>(T entity, Type type, string tableName, string primaryKeyColumn, object primaryKeyValue)
    {
        StringBuilder setClause = new StringBuilder();
        List<PropertyInfo> mappedProperties = new List<PropertyInfo>();
        
        foreach (PropertyInfo property in type.GetProperties())
        {
            // è·³è¿‡ä¸æ˜ å°„å’Œä¸»é”®å±æ€?
            if (property.GetCustomAttribute<NotMappedAttribute>() != null ||
                property.GetCustomAttribute<PrimaryKeyAttribute>() != null)
                continue;
                
            if (setClause.Length > 0)
                setClause.Append(", ");
                
            string columnName = GetColumnName(property);
            setClause.Append($"{columnName} = @{property.Name}");
            
            mappedProperties.Add(property);
        }
        
        string query = $"UPDATE {tableName} SET {setClause} WHERE {primaryKeyColumn} = @Id";
        
        using (SqlConnection connection = new SqlConnection(_connectionString))
        using (SqlCommand command = new SqlCommand(query, connection))
        {
            // æ·»åŠ å‚æ•°
            foreach (PropertyInfo property in mappedProperties)
            {
                object value = property.GetValue(entity) ?? DBNull.Value;
                command.Parameters.AddWithValue($"@{property.Name}", value);
            }
            
            command.Parameters.AddWithValue("@Id", primaryKeyValue);
            
            connection.Open();
            command.ExecuteNonQuery();
        }
    }
    
    // è·å–è¡¨å
    private string GetTableName(Type type)
    {
        // æŸ¥æ‰¾è¡¨ç‰¹æ€?
        TableAttribute tableAttr = type.GetCustomAttribute<TableAttribute>();
        
        // å¦‚æœæœ‰ç‰¹æ€§ï¼Œä½¿ç”¨ç‰¹æ€§å®šä¹‰çš„è¡¨å
        if (tableAttr != null)
            return tableAttr.TableName;
            
        // å¦åˆ™ä½¿ç”¨ç±»å
        return type.Name;
    }
    
    // è·å–åˆ—å
    private string GetColumnName(PropertyInfo property)
    {
        // æŸ¥æ‰¾åˆ—ç‰¹æ€?
        ColumnAttribute columnAttr = property.GetCustomAttribute<ColumnAttribute>();
        
        // å¦‚æœæœ‰ç‰¹æ€§ï¼Œä½¿ç”¨ç‰¹æ€§å®šä¹‰çš„åˆ—å
        if (columnAttr != null)
            return columnAttr.ColumnName;
            
        // å¦åˆ™ä½¿ç”¨å±æ€§å
        return property.Name;
    }
    
    // è·å–ä¸»é”®åˆ—å
    private string GetPrimaryKeyColumnName(Type type)
    {
        // æŸ¥æ‰¾å¸¦æœ‰ä¸»é”®ç‰¹æ€§çš„å±æ€?
        PropertyInfo primaryKeyProperty = GetPrimaryKeyProperty(type);
        
        if (primaryKeyProperty != null)
            return GetColumnName(primaryKeyProperty);
            
        return null;
    }
    
    // è·å–ä¸»é”®å±æ€?
    private PropertyInfo GetPrimaryKeyProperty(Type type)
    {
        // æŸ¥æ‰¾å¸¦æœ‰ä¸»é”®ç‰¹æ€§çš„å±æ€?
        foreach (PropertyInfo property in type.GetProperties())
        {
            if (property.GetCustomAttribute<PrimaryKeyAttribute>() != null)
                return property;
        }
        
        // é»˜è®¤æŸ¥æ‰¾åä¸º"Id"çš„å±æ€?
        PropertyInfo idProperty = type.GetProperty("Id");
        if (idProperty != null)
            return idProperty;
            
        return null;
    }
}

// ä½¿ç”¨ç¤ºä¾‹ - å®šä¹‰å®ä½“ç±?
[Table("Customers")]
public class Customer
{
    [PrimaryKey]
    [AutoIncrement]
    [Column("CustomerId")]
    public int Id { get; set; }
    
    [Column("FirstName")]
    public string FirstName { get; set; }
    
    [Column("LastName")]
    public string LastName { get; set; }
    
    public string Email { get; set; }
    
    public DateTime DateOfBirth { get; set; }
    
    [NotMapped]
    public int Age
    {
        get
        {
            return DateTime.Today.Year - DateOfBirth.Year - 
                (DateTime.Today < DateOfBirth.AddYears(DateTime.Today.Year - DateOfBirth.Year) ? 1 : 0);
        }
    }
    
    [NotMapped]
    public string FullName => $"{FirstName} {LastName}";
}

// ä½¿ç”¨ORMæ¡†æ¶
class Program
{
    static void Main()
    {
        // åˆ›å»ºORMå®ä¾‹
        string connectionString = "Server=localhost;Database=TestDB;Trusted_Connection=True;";
        var orm = new SimpleORM(connectionString);
        
        // åˆ›å»ºæ–°å®¢æˆ?
        var customer = new Customer
        {
            FirstName = "John",
            LastName = "Doe",
            Email = "john.doe@example.com",
            DateOfBirth = new DateTime(1980, 1, 1)
        };
        
        // ä¿å­˜åˆ°æ•°æ®åº“
        orm.Save(customer);
        Console.WriteLine($"Customer saved with ID: {customer.Id}");
        
        // æŸ¥è¯¢å®¢æˆ·
        var retrievedCustomer = orm.GetById<Customer>(customer.Id);
        Console.WriteLine($"Retrieved: {retrievedCustomer.FullName}, Email: {retrievedCustomer.Email}");
        
        // æ›´æ–°å®¢æˆ·
        retrievedCustomer.Email = "john.updated@example.com";
        orm.Save(retrievedCustomer);
        
        // æŸ¥è¯¢æ‰€æœ‰å®¢æˆ?
        var allCustomers = orm.GetAll<Customer>();
        Console.WriteLine($"Total customers: {allCustomers.Count}");
        
        // æ¡ä»¶æŸ¥è¯¢
        var parameters = new Dictionary<string, object>
        {
            { "FirstName", "John" }
        };
        var johnCustomers = orm.Query<Customer>("FirstName = @FirstName", parameters);
        Console.WriteLine($"Customers named John: {johnCustomers.Count}");
        
        // åˆ é™¤å®¢æˆ·
        orm.Delete(customer);
        Console.WriteLine("Customer deleted");
    }
}
```

**å…ƒæ•°æ®å’Œåå°„åœ¨å®é™…åº”ç”¨ä¸­çš„ä¼˜ç¼ºç‚¹ï¼?*

**ä¼˜ç‚¹ï¼?*

1. **çµæ´»æ€?*ï¼šå…è®¸åœ¨è¿è¡Œæ—¶è‡ªçœå’Œæ“ä½œç±»å‹ï¼Œå®ç°åŠ¨æ€è¡Œä¸?
2. **å‡å°‘ä»£ç é‡å¤**ï¼šé€šè¿‡å…ƒæ•°æ®é©±åŠ¨çš„æ¡†æ¶å‡å°‘æ ·æ¿ä»£ç 
3. **è‡ªåŠ¨åŒ?*ï¼šç®€åŒ–æ˜ å°„ã€åºåˆ—åŒ–ã€éªŒè¯ç­‰å¸¸è§ä»»åŠ¡
4. **é…ç½®é©±åŠ¨**ï¼šæ”¯æŒå£°æ˜å¼ç¼–ç¨‹å’Œé…ç½®é©±åŠ¨çš„æ¶æ„
5. **å…ƒç¼–ç¨‹èƒ½åŠ?*ï¼šæ‰©å±•è¯­è¨€èƒ½åŠ›ï¼Œå®ç°é¢†åŸŸç‰¹å®šè¯­è¨€(DSL)

**ç¼ºç‚¹ï¼?*

1. **æ€§èƒ½å¼€é”€**ï¼šé¢‘ç¹çš„å…ƒæ•°æ®è®¿é—®å’Œåå°„æ“ä½œä¼šå½±å“æ€§èƒ½
2. **ç±»å‹å®‰å…¨æ€§é™ä½?*ï¼šç¼–è¯‘æ—¶æ£€æŸ¥è¢«ç»•è¿‡ï¼Œå¯èƒ½å¯¼è‡´è¿è¡Œæ—¶é”™è¯¯
3. **å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€?*ï¼šè¿‡åº¦ä½¿ç”¨å…ƒæ•°æ®å’Œåå°„å¯èƒ½ä½¿ä»£ç éš¾ä»¥ç†è§£
4. **è°ƒè¯•éš¾åº¦å¢åŠ **ï¼šåŠ¨æ€è¡Œä¸ºé€šå¸¸æ›´éš¾è¿½è¸ªå’Œè°ƒè¯?
5. **åºåˆ—åŒ–é™·é˜?*ï¼šç‰¹æ€§å’Œå…ƒæ•°æ®å¯èƒ½ä¸å®é™…è¡Œä¸ºä¸ä¸€è‡?

**æœ€ä½³å®è·µï¼š**

1. **é€‚åº¦ä½¿ç”¨**ï¼šåªåœ¨çœŸæ­£éœ€è¦åŠ¨æ€è¡Œä¸ºæ—¶ä½¿ç”¨å…ƒæ•°æ®å’Œåå°„
2. **ç¼“å­˜ç»“æœ**ï¼šé¿å…é‡å¤æŸ¥è¯¢ç›¸åŒçš„å…ƒæ•°æ?
3. **æä¾›é™æ€åŒ…è£?*ï¼šä¸ºåŠ¨æ€è¡Œä¸ºæä¾›é™æ€åŒ…è£…ï¼Œå¢å¼ºå®‰å…¨æ€?
4. **å…¨é¢æµ‹è¯•**ï¼šå½»åº•æµ‹è¯•åŸºäºå…ƒæ•°æ®å’Œåå°„çš„ä»£ç 
5. **è€ƒè™‘æ€§èƒ½å½±å“**ï¼šåœ¨æ€§èƒ½å…³é”®è·¯å¾„ä¸Šè°¨æ…ä½¿ç”?

### æŠ€æœ¯é¢˜8ï¼šè‡ªå®šä¹‰ç‰¹æ€?Attributes)

**é—®é¢˜ï¼?* è¯¦ç»†è§£é‡ŠC#ä¸­è‡ªå®šä¹‰ç‰¹æ€?Attributes)çš„ä½œç”¨å’Œä½¿ç”¨æ–¹æ³•ã€‚è®¾è®¡ä¸€ä¸ªåŸºäºç‰¹æ€§çš„éªŒè¯æ¡†æ¶ï¼ŒåŒ…æ‹¬å¿…å¡«ã€é•¿åº¦é™åˆ¶ã€æ­£åˆ™è¡¨è¾¾å¼ã€æ•°å€¼èŒƒå›´ç­‰éªŒè¯åŠŸèƒ½ï¼Œå¹¶æä¾›ä¸€ä¸ªä½¿ç”¨ç¤ºä¾‹ã€?

**ç­”æ¡ˆï¼?*

**è‡ªå®šä¹‰ç‰¹æ€§çš„å®šä¹‰ï¼?*

è‡ªå®šä¹‰ç‰¹æ€?Custom Attributes)æ˜¯ä¸€ç§å£°æ˜å¼ç¼–ç¨‹æœºåˆ¶ï¼Œå…è®¸å¼€å‘è€…å°†å…ƒæ•°æ®æ·»åŠ åˆ°ä»£ç å…ƒç´ ï¼ˆå¦‚ç±»ã€æ–¹æ³•ã€å±æ€§ç­‰ï¼‰ä¸Šã€‚ç‰¹æ€§æœ¬èº«ä¸å½±å“ä»£ç è¡Œä¸ºï¼Œä½†å¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡åå°„æ£€ç´¢å’Œä½¿ç”¨ï¼Œé€šå¸¸ç”¨äºé…ç½®ã€éªŒè¯ã€æ–‡æ¡£åŒ–ç­‰ç›®çš„ã€?

**è‡ªå®šä¹‰ç‰¹æ€§çš„åŸºæœ¬ç”¨æ³•ï¼?*

1. **å®šä¹‰ç‰¹æ€§ç±»**ï¼šåˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª`System.Attribute`çš„ç±»
2. **æ§åˆ¶ç‰¹æ€§åº”ç”¨ä½ç½?*ï¼šä½¿ç”¨`AttributeUsageAttribute`æŒ‡å®šå¯åº”ç”¨çš„ä»£ç å…ƒç´ 
3. **å®šä¹‰ç‰¹æ€§å‚æ•?*ï¼šé€šè¿‡æ„é€ å‡½æ•°å’Œå±æ€§å£°æ˜ç‰¹æ€§å‚æ•?
4. **åº”ç”¨ç‰¹æ€?*ï¼šä½¿ç”¨`[AttributeName]`è¯­æ³•å°†ç‰¹æ€§åº”ç”¨åˆ°ä»£ç å…ƒç´ ä¸?
5. **æ£€ç´¢ç‰¹æ€?*ï¼šä½¿ç”¨åå°„è·å–åº”ç”¨çš„ç‰¹æ€?

**ç‰¹æ€§ä¸åå°„çš„ç»“åˆä½¿ç”¨ï¼š**

```csharp
// å®šä¹‰ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰ç‰¹æ€?
[AttributeUsage(AttributeTargets.Class | AttributeTargets.Method, AllowMultiple = false)]
public class DescriptionAttribute : Attribute
{
    public string Description { get; }
    
    public DescriptionAttribute(string description)
    {
        Description = description;
    }
}

// åº”ç”¨ç‰¹æ€?
[Description("è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹ç±»")]
public class ExampleClass
{
    [Description("è¿™ä¸ªæ–¹æ³•åšä¸€äº›é‡è¦çš„äº‹æƒ…")]
    public void DoSomething()
    {
        Console.WriteLine("Doing something...");
    }
}

// ä½¿ç”¨åå°„è¯»å–ç‰¹æ€?
public static void DisplayDescriptions()
{
    Type type = typeof(ExampleClass);
    
    // è·å–ç±»ä¸Šçš„ç‰¹æ€?
    DescriptionAttribute classAttr = (DescriptionAttribute)Attribute.GetCustomAttribute(
        type, typeof(DescriptionAttribute));
        
    if (classAttr != null)
    {
        Console.WriteLine($"ç±»æè¿? {classAttr.Description}");
    }
    
    // è·å–æ–¹æ³•ä¸Šçš„ç‰¹æ€?
    MethodInfo method = type.GetMethod("DoSomething");
    DescriptionAttribute methodAttr = (DescriptionAttribute)Attribute.GetCustomAttribute(
        method, typeof(DescriptionAttribute));
        
    if (methodAttr != null)
    {
        Console.WriteLine($"æ–¹æ³•æè¿°: {methodAttr.Description}");
    }
}
```

**è‡ªå®šä¹‰ç‰¹æ€§çš„ä½œç”¨ï¼?*

1. **é…ç½®å’Œå…ƒæ•°æ®**ï¼šæä¾›é…ç½®ä¿¡æ¯å’Œé¢å¤–å…ƒæ•°æ?
2. **ä»£ç ç”Ÿæˆ**ï¼šæŒ‡å¯¼ä»£ç ç”Ÿæˆå·¥å…?
3. **è¿è¡Œæ—¶è¡Œä¸ºæ§åˆ?*ï¼šå½±å“ç¨‹åºçš„è¿è¡Œæ—¶è¡Œä¸?
4. **æ–‡æ¡£åŒ?*ï¼šå¢å¼ºä»£ç æ–‡æ¡?
5. **æ¡†æ¶æ”¯æŒ**ï¼šæä¾›ä¸æ¡†æ¶çš„é›†æˆç‚¹

**åŸºäºç‰¹æ€§çš„éªŒè¯æ¡†æ¶è®¾è®¡ï¼?*

ä¸‹é¢å®ç°ä¸€ä¸ªå®Œæ•´çš„éªŒè¯æ¡†æ¶ï¼Œæ”¯æŒå¤šç§å¸¸è§éªŒè¯è§„åˆ™ï¼š

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Reflection;
using System.Text.RegularExpressions;

// åŸºæœ¬éªŒè¯ç‰¹æ€?
[AttributeUsage(AttributeTargets.Property, AllowMultiple = false)]
public abstract class ValidationAttribute : Attribute
{
    public string ErrorMessage { get; set; }
    
    // éªŒè¯æ–¹æ³•
    public abstract bool IsValid(object value);
    
    // è·å–é”™è¯¯æ¶ˆæ¯
    public virtual string GetErrorMessage(string propertyName)
    {
        if (!string.IsNullOrEmpty(ErrorMessage))
            return ErrorMessage;
            
        return $"Property {propertyName} validation failed.";
    }
}

// å¿…å¡«å­—æ®µç‰¹æ€?
[AttributeUsage(AttributeTargets.Property, AllowMultiple = false)]
public class RequiredAttribute : ValidationAttribute
{
    public RequiredAttribute()
    {
        ErrorMessage = "{0} is required.";
    }
    
    public override bool IsValid(object value)
    {
        // æ£€æŸ¥å€¼æ˜¯å¦ä¸ºnullæˆ–ç©ºå­—ç¬¦ä¸?
        if (value == null)
            return false;
            
        if (value is string stringValue)
            return !string.IsNullOrWhiteSpace(stringValue);
            
        return true;
    }
    
    public override string GetErrorMessage(string propertyName)
    {
        return string.Format(ErrorMessage, propertyName);
    }
}

// å­—ç¬¦ä¸²é•¿åº¦ç‰¹æ€?
[AttributeUsage(AttributeTargets.Property, AllowMultiple = false)]
public class StringLengthAttribute : ValidationAttribute
{
    public int MinLength { get; set; } = 0;
    public int MaxLength { get; set; }
    
    public StringLengthAttribute(int maxLength)
    {
        MaxLength = maxLength;
        ErrorMessage = "{0} must be between {1} and {2} characters.";
    }
    
    public override bool IsValid(object value)
    {
        if (value == null)
            return MinLength == 0; // å¦‚æœå€¼ä¸ºnullï¼Œåªæœ‰å½“æœ€å°é•¿åº¦ä¸º0æ—¶æ‰æœ‰æ•ˆ
            
        if (value is string stringValue)
        {
            int length = stringValue.Length;
            return length >= MinLength && length <= MaxLength;
        }
        
        return false;
    }
    
    public override string GetErrorMessage(string propertyName)
    {
        return string.Format(ErrorMessage, propertyName, MinLength, MaxLength);
    }
}

// æ­£åˆ™è¡¨è¾¾å¼ç‰¹æ€?
[AttributeUsage(AttributeTargets.Property, AllowMultiple = false)]
public class RegularExpressionAttribute : ValidationAttribute
{
    private readonly Regex _regex;
    
    public string Pattern { get; }
    
    public RegularExpressionAttribute(string pattern)
    {
        Pattern = pattern;
        _regex = new Regex(pattern, RegexOptions.Compiled);
        ErrorMessage = "{0} does not match the required pattern.";
    }
    
    public override bool IsValid(object value)
    {
        if (value == null)
            return true;
            
        if (value is string stringValue)
            return _regex.IsMatch(stringValue);
            
        return false;
    }
    
    public override string GetErrorMessage(string propertyName)
    {
        return string.Format(ErrorMessage, propertyName);
    }
}

// èŒƒå›´ç‰¹æ€?
[AttributeUsage(AttributeTargets.Property, AllowMultiple = false)]
public class RangeAttribute : ValidationAttribute
{
    public object Minimum { get; }
    public object Maximum { get; }
    public Type OperandType { get; }
    
    public RangeAttribute(int minimum, int maximum)
        : this(minimum, maximum, typeof(int))
    {
    }
    
    public RangeAttribute(double minimum, double maximum)
        : this(minimum, maximum, typeof(double))
    {
    }
    
    public RangeAttribute(object minimum, object maximum, Type operandType)
    {
        Minimum = minimum;
        Maximum = maximum;
        OperandType = operandType;
        ErrorMessage = "{0} must be between {1} and {2}.";
    }
    
    public override bool IsValid(object value)
    {
        if (value == null)
            return true;
            
        if (OperandType == typeof(int))
        {
            if (int.TryParse(value.ToString(), out int intValue))
            {
                return intValue >= (int)Minimum && intValue <= (int)Maximum;
            }
        }
        else if (OperandType == typeof(double))
        {
            if (double.TryParse(value.ToString(), out double doubleValue))
            {
                return doubleValue >= (double)Minimum && doubleValue <= (double)Maximum;
            }
        }
        else if (OperandType == typeof(DateTime))
        {
            if (value is DateTime dateValue)
            {
                return dateValue >= (DateTime)Minimum && dateValue <= (DateTime)Maximum;
            }
        }
        
        return false;
    }
    
    public override string GetErrorMessage(string propertyName)
    {
        return string.Format(ErrorMessage, propertyName, Minimum, Maximum);
    }
}

// ç”µå­é‚®ä»¶ç‰¹æ€?
[AttributeUsage(AttributeTargets.Property, AllowMultiple = false)]
public class EmailAttribute : RegularExpressionAttribute
{
    private const string EmailPattern = @"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$";
    
    public EmailAttribute()
        : base(EmailPattern)
    {
        ErrorMessage = "{0} is not a valid email address.";
    }
}

// æ¯”è¾ƒç‰¹æ€?
[AttributeUsage(AttributeTargets.Property, AllowMultiple = true)]
public class CompareAttribute : ValidationAttribute
{
    public string OtherProperty { get; }
    
    public CompareAttribute(string otherProperty)
    {
        OtherProperty = otherProperty;
        ErrorMessage = "{0} must match {1}.";
    }
    
    public override bool IsValid(object value)
    {
        return true; // å®é™…éªŒè¯åœ¨ValidateObjectæ–¹æ³•ä¸­å®Œæˆ?
    }
    
    public override string GetErrorMessage(string propertyName)
    {
        return string.Format(ErrorMessage, propertyName, OtherProperty);
    }
}

// è‡ªå®šä¹‰éªŒè¯ç‰¹æ€?
[AttributeUsage(AttributeTargets.Property, AllowMultiple = false)]
public class CustomValidationAttribute : ValidationAttribute
{
    public Type ValidatorType { get; }
    public string MethodName { get; }
    
    public CustomValidationAttribute(Type validatorType, string methodName)
    {
        ValidatorType = validatorType;
        MethodName = methodName;
    }
    
    public override bool IsValid(object value)
    {
        // è·å–éªŒè¯æ–¹æ³•
        MethodInfo method = ValidatorType.GetMethod(MethodName, 
            BindingFlags.Public | BindingFlags.Static);
            
        if (method == null)
            throw new InvalidOperationException($"Validation method {MethodName} not found in {ValidatorType.Name}");
            
        // è°ƒç”¨éªŒè¯æ–¹æ³•
        return (bool)method.Invoke(null, new[] { value });
    }
}

// åˆ›å»ºåŒ…å«éªŒè¯é€»è¾‘çš„æ ‡è®°æ¥å?
public interface IValidatableObject
{
    IEnumerable<ValidationError> Validate();
}

// éªŒè¯é”™è¯¯ç±?
public class ValidationError
{
    public string PropertyName { get; set; }
    public string ErrorMessage { get; set; }
    
    public ValidationError(string propertyName, string errorMessage)
    {
        PropertyName = propertyName;
        ErrorMessage = errorMessage;
    }
    
    public override string ToString()
    {
        return $"{PropertyName}: {ErrorMessage}";
    }
}

// éªŒè¯ç»“æœç±?
public class ValidationResult
{
    public bool IsValid => Errors.Count == 0;
    public List<ValidationError> Errors { get; } = new List<ValidationError>();
    
    public void AddError(string propertyName, string errorMessage)
    {
        Errors.Add(new ValidationError(propertyName, errorMessage));
    }
    
    public override string ToString()
    {
        if (IsValid)
            return "Validation succeeded.";
            
        return "Validation failed with the following errors:\n" + 
               string.Join("\n", Errors.Select(e => e.ToString()));
    }
}

// ä¸»éªŒè¯å™¨ç±?
public static class Validator
{
    // éªŒè¯å•ä¸ªå¯¹è±¡
    public static ValidationResult Validate(object obj)
    {
        if (obj == null)
            throw new ArgumentNullException(nameof(obj));
            
        var result = new ValidationResult();
        
        // è·å–å¯¹è±¡çš„ç±»å?
        Type type = obj.GetType();
        
        // å¤„ç†æ‰€æœ‰å¸¦æœ‰éªŒè¯ç‰¹æ€§çš„å±æ€?
        foreach (PropertyInfo property in type.GetProperties())
        {
            string propertyName = property.Name;
            object value = property.GetValue(obj);
            
            // è·å–åº”ç”¨äºå±æ€§çš„æ‰€æœ‰éªŒè¯ç‰¹æ€?
            var validationAttributes = property.GetCustomAttributes<ValidationAttribute>();
            
            foreach (var attribute in validationAttributes)
            {
                // å¯¹äºæ¯”è¾ƒç‰¹æ€§ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç?
                if (attribute is CompareAttribute compareAttr)
                {
                    // è·å–è¦æ¯”è¾ƒçš„å¦ä¸€ä¸ªå±æ€?
                    PropertyInfo otherProperty = type.GetProperty(compareAttr.OtherProperty);
                    if (otherProperty == null)
                    {
                        result.AddError(propertyName, 
                            $"Comparison property {compareAttr.OtherProperty} not found.");
                        continue;
                    }
                    
                    object otherValue = otherProperty.GetValue(obj);
                    
                    // æ¯”è¾ƒä¸¤ä¸ªå€?
                    bool isEqual = value == null ? otherValue == null : value.Equals(otherValue);
                    
                    if (!isEqual)
                    {
                        result.AddError(propertyName, 
                            compareAttr.GetErrorMessage(propertyName).Replace("{1}", compareAttr.OtherProperty));
                    }
                }
                else if (!attribute.IsValid(value))
                {
                    // æ·»åŠ éªŒè¯é”™è¯¯
                    result.AddError(propertyName, attribute.GetErrorMessage(propertyName));
                }
            }
        }
        
        // å¤„ç†IValidatableObjectæ¥å£
        if (obj is IValidatableObject validatable)
        {
            foreach (var error in validatable.Validate())
            {
                result.AddError(error.PropertyName, error.ErrorMessage);
            }
        }
        
        return result;
    }
    
    // éªŒè¯å¯¹è±¡å¹¶æŠ›å‡ºå¼‚å¸?
    public static void ValidateAndThrow(object obj)
    {
        ValidationResult result = Validate(obj);
        
        if (!result.IsValid)
        {
            throw new ValidationException(result.ToString());
        }
    }
    
    // æ³›å‹éªŒè¯æ–¹æ³•
    public static ValidationResult Validate<T>(T obj)
    {
        return Validate((object)obj);
    }
}

// éªŒè¯å¼‚å¸¸
public class ValidationException : Exception
{
    public ValidationException(string message) : base(message)
    {
    }
}

// è‡ªå®šä¹‰éªŒè¯å™¨
public static class CustomValidators
{
    // éªŒè¯å¯†ç å¼ºåº¦
    public static bool IsStrongPassword(string password)
    {
        if (string.IsNullOrEmpty(password))
            return false;
            
        // å¯†ç è§„åˆ™ï¼šè‡³å°?ä¸ªå­—ç¬¦ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦
        return password.Length >= 8 &&
               password.Any(char.IsUpper) &&
               password.Any(char.IsLower) &&
               password.Any(char.IsDigit) &&
               password.Any(c => !char.IsLetterOrDigit(c));
    }
}

// ç¤ºä¾‹ç”¨æˆ·ç±?
public class User : IValidatableObject
{
    [Required(ErrorMessage = "Username is required.")]
    [StringLength(50, MinLength = 3, ErrorMessage = "Username must be between {1} and {2} characters.")]
    [RegularExpression(@"^[a-zA-Z0-9_]+$", ErrorMessage = "Username can only contain letters, numbers and underscore.")]
    public string Username { get; set; }
    
    [Required]
    [Email]
    public string Email { get; set; }
    
    [Required]
    [StringLength(100, MinLength = 8)]
    [CustomValidation(typeof(CustomValidators), "IsStrongPassword")]
    public string Password { get; set; }
    
    [Required]
    [Compare("Password", ErrorMessage = "Passwords do not match.")]
    public string ConfirmPassword { get; set; }
    
    [Required]
    [StringLength(100)]
    public string FullName { get; set; }
    
    [Range(18, 120, ErrorMessage = "Age must be between {1} and {2}.")]
    public int Age { get; set; }
    
    // è‡ªå®šä¹‰éªŒè¯é€»è¾‘
    public IEnumerable<ValidationError> Validate()
    {
        // æ·»åŠ æ— æ³•é€šè¿‡ç‰¹æ€§è¡¨è¾¾çš„éªŒè¯è§„åˆ™
        if (!string.IsNullOrEmpty(Username) && !string.IsNullOrEmpty(Password) && 
            Password.Contains(Username))
        {
            yield return new ValidationError("Password", "Password should not contain username.");
        }
        
        if (!string.IsNullOrEmpty(Email) && Email.StartsWith("admin"))
        {
            yield return new ValidationError("Email", "Email should not start with 'admin'.");
        }
    }
}

// éªŒè¯æ¡†æ¶ä½¿ç”¨ç¤ºä¾‹
class Program
{
    static void Main()
    {
        // åˆ›å»ºåŒ…å«é”™è¯¯çš„ç”¨æˆ·å¯¹è±?
        var user = new User
        {
            Username = "j", // å¤ªçŸ­
            Email = "not-an-email", // æ— æ•ˆçš„é‚®ç®?
            Password = "123", // å¯†ç å¤ªå¼±
            ConfirmPassword = "1234", // å¯†ç ä¸åŒ¹é…?
            FullName = "John Doe",
            Age = 15 // å¤ªå¹´è½?
        };
        
        // éªŒè¯ç”¨æˆ·
        ValidationResult result = Validator.Validate(user);
        
        Console.WriteLine(result.ToString());
        Console.WriteLine();
        
        // åˆ›å»ºæœ‰æ•ˆçš„ç”¨æˆ·å¯¹è±?
        var validUser = new User
        {
            Username = "john_doe",
            Email = "john.doe@example.com",
            Password = "P@ssw0rd123!",
            ConfirmPassword = "P@ssw0rd123!",
            FullName = "John Doe",
            Age = 25
        };
        
        // éªŒè¯æœ‰æ•ˆç”¨æˆ·
        ValidationResult validResult = Validator.Validate(validUser);
        
        Console.WriteLine(validResult.ToString());
        
        // æ¼”ç¤ºéªŒè¯å¹¶æŠ›å‡ºå¼‚å¸?
        try
        {
            Validator.ValidateAndThrow(user);
        }
        catch (ValidationException ex)
        {
            Console.WriteLine($"Validation exception: {ex.Message}");
        }
    }
}
```

**è‡ªå®šä¹‰ç‰¹æ€§éªŒè¯æ¡†æ¶çš„ä¼˜ç¼ºç‚¹ï¼š**

**ä¼˜ç‚¹ï¼?*

1. **å£°æ˜å¼éªŒè¯?*ï¼šé€šè¿‡ç‰¹æ€§ç›´æ¥åœ¨æ¨¡å‹ä¸­å®šä¹‰éªŒè¯è§„åˆ™ï¼Œä»£ç æ¸…æ™°
2. **é›†ä¸­å¼é€»è¾‘**ï¼šéªŒè¯é€»è¾‘é›†ä¸­åœ¨ç‰¹æ€§ç±»ä¸­ï¼Œä¾¿äºç»´æŠ¤
3. **å¯æ‰©å±•æ€?*ï¼šå®¹æ˜“æ·»åŠ æ–°çš„éªŒè¯è§„åˆ?
4. **è‡ªæè¿?*ï¼šæ¨¡å‹ç±»æœ¬èº«å°±åŒ…å«éªŒè¯è§„åˆ™ï¼Œå¢å¼ºäº†è‡ªæ–‡æ¡£æ€?
5. **æ¡†æ¶é›†æˆ**ï¼šå¯ä»¥ä¸å…¶ä»–æ¡†æ¶ï¼ˆå¦‚ASP.NET MVCï¼‰é›†æˆ?
6. **å¯æµ‹è¯•æ€?*ï¼šéªŒè¯é€»è¾‘å¯ä»¥å•ç‹¬æµ‹è¯•

**ç¼ºç‚¹ï¼?*

1. **æ€§èƒ½å¼€é”€**ï¼šä½¿ç”¨åå°„è·å–ç‰¹æ€§ä¼šå¸¦æ¥æ€§èƒ½å¼€é”€
2. **çµæ´»æ€§æœ‰é™?*ï¼šå¤æ‚çš„éªŒè¯è§„åˆ™å¯èƒ½éš¾ä»¥é€šè¿‡ç‰¹æ€§è¡¨è¾?
3. **è°ƒè¯•éš¾åº¦**ï¼šéªŒè¯å¤±è´¥çš„åŸå› å¯èƒ½ä¸å¤Ÿç›´è§‚
4. **å¾ªç¯ä¾èµ–é£é™©**ï¼šç‰¹æ€§ä¹‹é—´å¯èƒ½å­˜åœ¨ä¾èµ–å…³ç³?
5. **å¯è§æ€§é—®é¢?*ï¼šéªŒè¯è§„åˆ™åˆ†æ•£åœ¨å¤šä¸ªå±æ€§ä¸Šï¼Œå¯èƒ½ä¸æ˜“æŸ¥çœ‹å…¨å±€è§„åˆ™

**å®é™…åº”ç”¨å»ºè®®ï¼?*

1. **æœ‰é€‰æ‹©åœ°ä½¿ç”¨ç‰¹æ€?*ï¼šç®€å•éªŒè¯ä½¿ç”¨ç‰¹æ€§ï¼Œå¤æ‚éªŒè¯è€ƒè™‘å…¶ä»–æ–¹æ³•
2. **ç¼“å­˜åå°„ç»“æœ**ï¼šå‡å°‘æ€§èƒ½å¼€é”€
3. **ç»“åˆå¤šç§éªŒè¯æ–¹å¼**ï¼šç‰¹æ€§éªŒè¯ä¸ä¸šåŠ¡è§„åˆ™éªŒè¯ç›¸ç»“å?
4. **æä¾›æ¸…æ™°çš„é”™è¯¯æ¶ˆæ?*ï¼šå¸®åŠ©ç”¨æˆ·ç†è§£éªŒè¯å¤±è´¥çš„åŸå› 
5. **è€ƒè™‘å›½é™…åŒ?*ï¼šé”™è¯¯æ¶ˆæ¯æ”¯æŒå¤šè¯­è¨€

### æŠ€æœ¯é¢˜9ï¼šåŠ¨æ€ä»£ç ç”Ÿæˆ?

**é—®é¢˜ï¼?* ä½¿ç”¨System.Reflection.Emitå‘½åç©ºé—´å®ç°åŠ¨æ€ä»£ç ç”Ÿæˆï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„ç±»å‹å¹¶åœ¨è¿è¡Œæ—¶ä½¿ç”¨å®ƒã€‚æ¯”è¾ƒåŠ¨æ€ä»£ç ç”Ÿæˆä¸ä¼ ç»Ÿåå°„çš„æ€§èƒ½å·®å¼‚ï¼Œå¹¶è®¨è®ºä½¿ç”¨åœºæ™¯ã€?

**ç­”æ¡ˆï¼?*

**åŠ¨æ€ä»£ç ç”Ÿæˆç®€ä»‹ï¼š**

åŠ¨æ€ä»£ç ç”Ÿæˆæ˜¯ä¸€ç§åœ¨è¿è¡Œæ—¶åˆ›å»ºå’Œç¼–è¯‘æ–°ç±»å‹çš„æŠ€æœ¯ã€‚åœ¨.NETä¸­ï¼Œä¸»è¦é€šè¿‡`System.Reflection.Emit`å‘½åç©ºé—´æä¾›çš„APIæ¥å®ç°ï¼Œå®ƒå…è®¸å¼€å‘è€…åœ¨è¿è¡Œæ—¶ç”ŸæˆMSILä»£ç ï¼Œåˆ›å»ºæ–°çš„ç±»å‹ã€æ–¹æ³•ã€å±æ€§ç­‰ï¼Œå¹¶ç«‹å³ä½¿ç”¨å®ƒä»¬ã€?

**Reflection.Emitä¸»è¦ç»„ä»¶ï¼?*

1. **AssemblyBuilder**ï¼šç”¨äºåˆ›å»ºåŠ¨æ€ç¨‹åºé›†
2. **ModuleBuilder**ï¼šåœ¨ç¨‹åºé›†ä¸­åˆ›å»ºæ¨¡å—
3. **TypeBuilder**ï¼šå®šä¹‰æ–°çš„ç±»å‹ï¼ˆç±»ã€æ¥å£ç­‰ï¼?
4. **MethodBuilder**ï¼šå®šä¹‰ç±»å‹çš„æ–¹æ³•
5. **PropertyBuilder**ï¼šå®šä¹‰ç±»å‹çš„å±æ€?
6. **FieldBuilder**ï¼šå®šä¹‰ç±»å‹çš„å­—æ®µ
7. **ILGenerator**ï¼šç”ŸæˆMSILæŒ‡ä»¤

**ä½¿ç”¨Reflection.Emitåˆ›å»ºåŠ¨æ€ç±»å‹çš„ç¤ºä¾‹ï¼?*

```csharp
using System;
using System.Reflection;
using System.Reflection.Emit;

class DynamicTypeGenerator
{
    // åˆ›å»ºä¸€ä¸ªå…·æœ‰å±æ€§å’Œæ–¹æ³•çš„åŠ¨æ€ç±»å?
    public static Type CreatePersonType()
    {
        // åˆ›å»ºç¨‹åºé›†åç§?
        AssemblyName assemblyName = new AssemblyName("DynamicAssembly");
        
        // åˆ›å»ºåŠ¨æ€ç¨‹åºé›†ï¼ˆåªåœ¨å†…å­˜ä¸­ï¼?
        AssemblyBuilder assemblyBuilder = AssemblyBuilder.DefineDynamicAssembly(
            assemblyName, AssemblyBuilderAccess.Run);
            
        // åˆ›å»ºæ¨¡å—
        ModuleBuilder moduleBuilder = assemblyBuilder.DefineDynamicModule("DynamicModule");
        
        // åˆ›å»ºç±»å‹ï¼ˆç±»ï¼?
        TypeBuilder typeBuilder = moduleBuilder.DefineType(
            "Person", TypeAttributes.Public | TypeAttributes.Class);
            
        // å®šä¹‰å­—æ®µ
        FieldBuilder nameField = typeBuilder.DefineField(
            "_name", typeof(string), FieldAttributes.Private);
            
        FieldBuilder ageField = typeBuilder.DefineField(
            "_age", typeof(int), FieldAttributes.Private);
        
        // å®šä¹‰Nameå±æ€?
        PropertyBuilder nameProperty = typeBuilder.DefineProperty(
            "Name", PropertyAttributes.None, typeof(string), null);
            
        // åˆ›å»ºNameå±æ€§çš„getæ–¹æ³•
        MethodBuilder getNameMethod = typeBuilder.DefineMethod(
            "get_Name",
            MethodAttributes.Public | MethodAttributes.SpecialName | MethodAttributes.HideBySig,
            typeof(string),
            Type.EmptyTypes);
            
        // ç”Ÿæˆget_Nameæ–¹æ³•çš„ILä»£ç 
        ILGenerator getNameIL = getNameMethod.GetILGenerator();
        getNameIL.Emit(OpCodes.Ldarg_0); // åŠ è½½this
        getNameIL.Emit(OpCodes.Ldfld, nameField); // åŠ è½½_nameå­—æ®µ
        getNameIL.Emit(OpCodes.Ret); // è¿”å›
        
        // åˆ›å»ºNameå±æ€§çš„setæ–¹æ³•
        MethodBuilder setNameMethod = typeBuilder.DefineMethod(
            "set_Name",
            MethodAttributes.Public | MethodAttributes.SpecialName | MethodAttributes.HideBySig,
            null,
            new[] { typeof(string) });
            
        // ç”Ÿæˆset_Nameæ–¹æ³•çš„ILä»£ç 
        ILGenerator setNameIL = setNameMethod.GetILGenerator();
        setNameIL.Emit(OpCodes.Ldarg_0); // åŠ è½½this
        setNameIL.Emit(OpCodes.Ldarg_1); // åŠ è½½å‚æ•°å€?
        setNameIL.Emit(OpCodes.Stfld, nameField); // å­˜å‚¨åˆ°_nameå­—æ®µ
        setNameIL.Emit(OpCodes.Ret); // è¿”å›
        
        // å°†getå’Œsetæ–¹æ³•å…³è”åˆ°Nameå±æ€?
        nameProperty.SetGetMethod(getNameMethod);
        nameProperty.SetSetMethod(setNameMethod);
        
        // å®šä¹‰Ageå±æ€?
        PropertyBuilder ageProperty = typeBuilder.DefineProperty(
            "Age", PropertyAttributes.None, typeof(int), null);
            
        // åˆ›å»ºAgeå±æ€§çš„getæ–¹æ³•
        MethodBuilder getAgeMethod = typeBuilder.DefineMethod(
            "get_Age",
            MethodAttributes.Public | MethodAttributes.SpecialName | MethodAttributes.HideBySig,
            typeof(int),
            Type.EmptyTypes);
            
        // ç”Ÿæˆget_Ageæ–¹æ³•çš„ILä»£ç 
        ILGenerator getAgeIL = getAgeMethod.GetILGenerator();
        getAgeIL.Emit(OpCodes.Ldarg_0); // åŠ è½½this
        getAgeIL.Emit(OpCodes.Ldfld, ageField); // åŠ è½½_ageå­—æ®µ
        getAgeIL.Emit(OpCodes.Ret); // è¿”å›
        
        // åˆ›å»ºAgeå±æ€§çš„setæ–¹æ³•
        MethodBuilder setAgeMethod = typeBuilder.DefineMethod(
            "set_Age",
            MethodAttributes.Public | MethodAttributes.SpecialName | MethodAttributes.HideBySig,
            null,
            new[] { typeof(int) });
            
        // ç”Ÿæˆset_Ageæ–¹æ³•çš„ILä»£ç 
        ILGenerator setAgeIL = setAgeMethod.GetILGenerator();
        
        // æ·»åŠ éªŒè¯ï¼šå¹´é¾„å¿…é¡»å¤§äº?
        Label validAge = setAgeIL.DefineLabel();
        
        setAgeIL.Emit(OpCodes.Ldarg_1); // åŠ è½½å‚æ•°å€?
        setAgeIL.Emit(OpCodes.Ldc_I4_0); // åŠ è½½0
        setAgeIL.Emit(OpCodes.Bgt, validAge); // å¦‚æœå‚æ•° > 0ï¼Œè·³è½¬åˆ°validAgeæ ‡ç­¾
        
        // å¦‚æœå¹´é¾„ <= 0ï¼ŒæŠ›å‡ºå¼‚å¸?
        setAgeIL.Emit(OpCodes.Ldstr, "Age must be greater than 0");
        setAgeIL.Emit(OpCodes.Newobj, typeof(ArgumentException).GetConstructor(new[] { typeof(string) }));
        setAgeIL.Emit(OpCodes.Throw);
        
        // å¦‚æœå¹´é¾„æœ‰æ•ˆï¼Œè®¾ç½®å­—æ®µå€?
        setAgeIL.MarkLabel(validAge);
        setAgeIL.Emit(OpCodes.Ldarg_0); // åŠ è½½this
        setAgeIL.Emit(OpCodes.Ldarg_1); // åŠ è½½å‚æ•°å€?
        setAgeIL.Emit(OpCodes.Stfld, ageField); // å­˜å‚¨åˆ°_ageå­—æ®µ
        setAgeIL.Emit(OpCodes.Ret); // è¿”å›
        
        // å°†getå’Œsetæ–¹æ³•å…³è”åˆ°Ageå±æ€?
        ageProperty.SetGetMethod(getAgeMethod);
        ageProperty.SetSetMethod(setAgeMethod);
        
        // åˆ›å»ºæ„é€ å‡½æ•?
        ConstructorBuilder constructor = typeBuilder.DefineConstructor(
            MethodAttributes.Public,
            CallingConventions.Standard,
            new[] { typeof(string), typeof(int) });
            
        // ç”Ÿæˆæ„é€ å‡½æ•°çš„ILä»£ç 
        ILGenerator constructorIL = constructor.GetILGenerator();
        
        // è°ƒç”¨åŸºç±»(System.Object)æ„é€ å‡½æ•?
        constructorIL.Emit(OpCodes.Ldarg_0);
        constructorIL.Emit(OpCodes.Call, typeof(object).GetConstructor(Type.EmptyTypes));
        
        // è®¾ç½®Nameå±æ€?
        constructorIL.Emit(OpCodes.Ldarg_0);
        constructorIL.Emit(OpCodes.Ldarg_1);
        constructorIL.Emit(OpCodes.Call, setNameMethod);
        
        // è®¾ç½®Ageå±æ€?
        constructorIL.Emit(OpCodes.Ldarg_0);
        constructorIL.Emit(OpCodes.Ldarg_2);
        constructorIL.Emit(OpCodes.Call, setAgeMethod);
        
        constructorIL.Emit(OpCodes.Ret);
        
        // åˆ›å»ºGetDescriptionæ–¹æ³•
        MethodBuilder getDescriptionMethod = typeBuilder.DefineMethod(
            "GetDescription",
            MethodAttributes.Public,
            typeof(string),
            Type.EmptyTypes);
            
        // ç”ŸæˆGetDescriptionæ–¹æ³•çš„ILä»£ç 
        ILGenerator getDescIL = getDescriptionMethod.GetILGenerator();
        
        // åˆ›å»ºå­—ç¬¦ä¸²ï¼š$"Person: {Name}, {Age} years old"
        getDescIL.DeclareLocal(typeof(string)); // å£°æ˜æœ¬åœ°å˜é‡å­˜å‚¨ç»“æœ
        
        getDescIL.Emit(OpCodes.Ldstr, "Person: {0}, {1} years old");
        getDescIL.Emit(OpCodes.Ldarg_0);
        getDescIL.Emit(OpCodes.Call, getNameMethod);
        getDescIL.Emit(OpCodes.Ldarg_0);
        getDescIL.Emit(OpCodes.Call, getAgeMethod);
        getDescIL.Emit(OpCodes.Box, typeof(int)); // è£…ç®±intä¸ºobject
        getDescIL.Emit(OpCodes.Call, typeof(string).GetMethod(
            "Format", new[] { typeof(string), typeof(object), typeof(object) }));
        getDescIL.Emit(OpCodes.Ret);
        
        // åˆ›å»ºç±»å‹
        Type personType = typeBuilder.CreateType();
        
        return personType;
    }
}

// ä½¿ç”¨åŠ¨æ€ç”Ÿæˆçš„ç±»å‹
class Program
{
    static void Main()
    {
        // åˆ›å»ºåŠ¨æ€ç±»å?
        Type personType = DynamicTypeGenerator.CreatePersonType();
        
        Console.WriteLine($"åˆ›å»ºçš„ç±»å‹åç§? {personType.FullName}");
        Console.WriteLine("å±æ€?");
        foreach (var prop in personType.GetProperties())
        {
            Console.WriteLine($"- {prop.PropertyType.Name} {prop.Name}");
        }
        
        Console.WriteLine("æ–¹æ³•:");
        foreach (var method in personType.GetMethods())
        {
            // åªæ˜¾ç¤ºè‡ªå®šä¹‰æ–¹æ³•ï¼Œä¸æ˜¾ç¤ºç»§æ‰¿çš„æ–¹æ³?
            if (method.DeclaringType == personType && !method.IsSpecialName)
            {
                Console.WriteLine($"- {method.ReturnType.Name} {method.Name}()");
            }
        }
        
        // åˆ›å»ºPersonå®ä¾‹
        object person = Activator.CreateInstance(personType, "John Doe", 30);
        
        // è·å–å±æ€§å€?
        string name = (string)personType.GetProperty("Name").GetValue(person);
        int age = (int)personType.GetProperty("Age").GetValue(person);
        
        Console.WriteLine($"\né€šè¿‡åå°„è·å–å±æ€§å€? Name = {name}, Age = {age}");
        
        // è°ƒç”¨GetDescriptionæ–¹æ³•
        string description = (string)personType.GetMethod("GetDescription").Invoke(person, null);
        Console.WriteLine($"GetDescriptionæ–¹æ³•ç»“æœ: {description}");
        
        // å°è¯•è®¾ç½®æ— æ•ˆçš„å¹´é¾?
        try
        {
            personType.GetProperty("Age").SetValue(person, -5);
        }
        catch (TargetInvocationException ex)
        {
            Console.WriteLine($"æ•è·åˆ°å¼‚å¸? {ex.InnerException.Message}");
        }
        
        // åŠ¨æ€åˆ›å»ºæ›´å¤šPersonå®ä¾‹å¹¶ä½¿ç”?
        for (int i = 1; i <= 3; i++)
        {
            object newPerson = Activator.CreateInstance(personType, $"Person {i}", 20 + i);
            string desc = (string)personType.GetMethod("GetDescription").Invoke(newPerson, null);
            Console.WriteLine(desc);
        }
    }
}
```

**æ€§èƒ½æ¯”è¾ƒï¼šåŠ¨æ€ä»£ç ç”Ÿæˆ?vs ä¼ ç»Ÿåå°„**

ä¸‹é¢çš„ç¤ºä¾‹æ¯”è¾ƒäº†ä¸åŒæ–¹æ³•åˆ›å»ºå’Œä½¿ç”¨å¯¹è±¡çš„æ€§èƒ½å·®å¼‚ï¼?

```csharp
using System;
using System.Diagnostics;
using System.Reflection;
using System.Reflection.Emit;
using System.Linq.Expressions;

class PerformanceComparison
{
    // å®šä¹‰å¸¸è§„ç±»ä½œä¸ºåŸºå‡?
    public class StaticPerson
    {
        private string _name;
        private int _age;
        
        public string Name
        {
            get { return _name; }
            set { _name = value; }
        }
        
        public int Age
        {
            get { return _age; }
            set
            {
                if (value <= 0)
                    throw new ArgumentException("Age must be greater than 0");
                _age = value;
            }
        }
        
        public StaticPerson(string name, int age)
        {
            Name = name;
            Age = age;
        }
        
        public string GetDescription()
        {
            return $"Person: {Name}, {Age} years old";
        }
    }
    
    // åˆ›å»ºåŠ¨æ€ç±»å?
    private static Type CreateDynamicPersonType()
    {
        // [ä½¿ç”¨å‰é¢çš„CreatePersonTypeæ–¹æ³•çš„ä»£ç ]
        return DynamicTypeGenerator.CreatePersonType();
    }
    
    // æµ‹è¯•ç›´æ¥å®ä¾‹åŒ–å’Œæ–¹æ³•è°ƒç”¨ï¼ˆåŸºå‡†ï¼‰
    public static void TestDirect(int iterations)
    {
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < iterations; i++)
        {
            var person = new StaticPerson("John", 30);
            string name = person.Name;
            int age = person.Age;
            string description = person.GetDescription();
        }
        
        sw.Stop();
        Console.WriteLine($"ç›´æ¥è°ƒç”¨: {sw.ElapsedMilliseconds}ms");
    }
    
    // æµ‹è¯•ä¼ ç»Ÿåå°„
    public static void TestReflection(int iterations)
    {
        Type type = typeof(StaticPerson);
        ConstructorInfo ctor = type.GetConstructor(new[] { typeof(string), typeof(int) });
        PropertyInfo nameProperty = type.GetProperty("Name");
        PropertyInfo ageProperty = type.GetProperty("Age");
        MethodInfo getDescMethod = type.GetMethod("GetDescription");
        
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < iterations; i++)
        {
            object person = ctor.Invoke(new object[] { "John", 30 });
            string name = (string)nameProperty.GetValue(person);
            int age = (int)ageProperty.GetValue(person);
            string description = (string)getDescMethod.Invoke(person, null);
        }
        
        sw.Stop();
        Console.WriteLine($"ä¼ ç»Ÿåå°„: {sw.ElapsedMilliseconds}ms");
    }
    
    // æµ‹è¯•ç¼“å­˜åå°„å§”æ‰˜
    public static void TestCachedReflection(int iterations)
    {
        Type type = typeof(StaticPerson);
        ConstructorInfo ctor = type.GetConstructor(new[] { typeof(string), typeof(int) });
        
        // åˆ›å»ºå§”æ‰˜
        var createDelegate = new Func<string, int, StaticPerson>((name, age) => 
            (StaticPerson)ctor.Invoke(new object[] { name, age }));
            
        var nameGetDelegate = (Func<StaticPerson, string>)Delegate.CreateDelegate(
            typeof(Func<StaticPerson, string>),
            null,
            type.GetProperty("Name").GetGetMethod());
            
        var ageGetDelegate = (Func<StaticPerson, int>)Delegate.CreateDelegate(
            typeof(Func<StaticPerson, int>),
            null,
            type.GetProperty("Age").GetGetMethod());
            
        var getDescDelegate = (Func<StaticPerson, string>)Delegate.CreateDelegate(
            typeof(Func<StaticPerson, string>),
            null,
            type.GetMethod("GetDescription"));
        
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < iterations; i++)
        {
            StaticPerson person = createDelegate("John", 30);
            string name = nameGetDelegate(person);
            int age = ageGetDelegate(person);
            string description = getDescDelegate(person);
        }
        
        sw.Stop();
        Console.WriteLine($"ç¼“å­˜åå°„å§”æ‰˜: {sw.ElapsedMilliseconds}ms");
    }
    
    // æµ‹è¯•è¡¨è¾¾å¼æ ‘
    public static void TestExpressionTrees(int iterations)
    {
        Type type = typeof(StaticPerson);
        
        // æ„å»ºè¡¨è¾¾å¼æ ‘åˆ›å»ºå®ä¾‹
        ConstructorInfo ctor = type.GetConstructor(new[] { typeof(string), typeof(int) });
        var nameParam = Expression.Parameter(typeof(string), "name");
        var ageParam = Expression.Parameter(typeof(int), "age");
        
        NewExpression newExp = Expression.New(ctor, nameParam, ageParam);
        var createLambda = Expression.Lambda<Func<string, int, StaticPerson>>(
            newExp, nameParam, ageParam);
        var createDelegate = createLambda.Compile();
        
        // å±æ€§å’Œæ–¹æ³•å§”æ‰˜
        var personParam = Expression.Parameter(typeof(StaticPerson), "person");
        
        var getNameExp = Expression.Property(personParam, "Name");
        var getNameLambda = Expression.Lambda<Func<StaticPerson, string>>(
            getNameExp, personParam);
        var getNameDelegate = getNameLambda.Compile();
        
        var getAgeExp = Expression.Property(personParam, "Age");
        var getAgeLambda = Expression.Lambda<Func<StaticPerson, int>>(
            getAgeExp, personParam);
        var getAgeDelegate = getAgeLambda.Compile();
        
        var getDescExp = Expression.Call(personParam, type.GetMethod("GetDescription"));
        var getDescLambda = Expression.Lambda<Func<StaticPerson, string>>(
            getDescExp, personParam);
        var getDescDelegate = getDescLambda.Compile();
        
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < iterations; i++)
        {
            StaticPerson person = createDelegate("John", 30);
            string name = getNameDelegate(person);
            int age = getAgeDelegate(person);
            string description = getDescDelegate(person);
        }
        
        sw.Stop();
        Console.WriteLine($"è¡¨è¾¾å¼æ ‘: {sw.ElapsedMilliseconds}ms");
    }
    
    // æµ‹è¯•åŠ¨æ€ç”Ÿæˆç±»å?
    public static void TestDynamicTypeCreation()
    {
        Stopwatch sw = Stopwatch.StartNew();
        Type dynamicType = CreateDynamicPersonType();
        sw.Stop();
        Console.WriteLine($"åŠ¨æ€ç±»å‹ç”Ÿæˆæ—¶é—? {sw.ElapsedMilliseconds}ms");
    }
    
    // æµ‹è¯•åŠ¨æ€ç±»å‹å®ä¾‹ä½¿ç”?
    public static void TestDynamicTypeUsage(int iterations)
    {
        Type dynamicType = CreateDynamicPersonType();
        
        ConstructorInfo ctor = dynamicType.GetConstructor(new[] { typeof(string), typeof(int) });
        PropertyInfo nameProperty = dynamicType.GetProperty("Name");
        PropertyInfo ageProperty = dynamicType.GetProperty("Age");
        MethodInfo getDescMethod = dynamicType.GetMethod("GetDescription");
        
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < iterations; i++)
        {
            object person = ctor.Invoke(new object[] { "John", 30 });
            string name = (string)nameProperty.GetValue(person);
            int age = (int)ageProperty.GetValue(person);
            string description = (string)getDescMethod.Invoke(person, null);
        }
        
        sw.Stop();
        Console.WriteLine($"åŠ¨æ€ç±»å‹ä½¿ç”?åå°„): {sw.ElapsedMilliseconds}ms");
    }
    
    // æµ‹è¯•åŠ¨æ€ç±»å?+ ç¼“å­˜å§”æ‰˜
    public static void TestDynamicTypeWithDelegate(int iterations)
    {
        Type dynamicType = CreateDynamicPersonType();
        
        // åˆ›å»ºæ„é€ å‡½æ•°å§”æ‰?
        ConstructorInfo ctor = dynamicType.GetConstructor(new[] { typeof(string), typeof(int) });
        var dynamicCtor = new Func<string, int, object>((name, age) => 
            ctor.Invoke(new object[] { name, age }));
        
        // åˆ›å»ºå±æ€§å’Œæ–¹æ³•å§”æ‰˜
        var nameGetMethod = dynamicType.GetProperty("Name").GetGetMethod();
        var ageGetMethod = dynamicType.GetProperty("Age").GetGetMethod();
        var getDescMethod = dynamicType.GetMethod("GetDescription");
        
        var nameGetDelegate = (Func<object, string>)Delegate.CreateDelegate(
            typeof(Func<object, string>),
            null,
            nameGetMethod);
            
        var ageGetDelegate = (Func<object, int>)Delegate.CreateDelegate(
            typeof(Func<object, int>),
            null,
            ageGetMethod);
            
        var getDescDelegate = (Func<object, string>)Delegate.CreateDelegate(
            typeof(Func<object, string>),
            null,
            getDescMethod);
        
        Stopwatch sw = Stopwatch.StartNew();
        
        for (int i = 0; i < iterations; i++)
        {
            object person = dynamicCtor("John", 30);
            string name = nameGetDelegate(person);
            int age = ageGetDelegate(person);
            string description = getDescDelegate(person);
        }
        
        sw.Stop();
        Console.WriteLine($"åŠ¨æ€ç±»å?+ å§”æ‰˜: {sw.ElapsedMilliseconds}ms");
    }
    
    // è¿è¡Œæ‰€æœ‰æµ‹è¯?
    public static void RunAllTests()
    {
        int iterations = 1_000_000;
        Console.WriteLine($"æ‰§è¡Œæ¯ç§æ–¹æ³• {iterations:N0} æ¬?\n");
        
        TestDynamicTypeCreation();
        Console.WriteLine();
        
        TestDirect(iterations);
        TestReflection(iterations);
        TestCachedReflection(iterations);
        TestExpressionTrees(iterations);
        TestDynamicTypeUsage(iterations);
        TestDynamicTypeWithDelegate(iterations);
    }
}
```

**æ€§èƒ½æ¯”è¾ƒç»“æœï¼ˆç¤ºä¾‹ï¼‰ï¼?*

åŠ¨æ€ç±»å‹ç”Ÿæˆæ—¶é—? çº?0-150msï¼ˆä¸€æ¬¡æ€§æˆæœ¬ï¼‰

å¯¹äº1,000,000æ¬¡æ“ä½œï¼š
- ç›´æ¥è°ƒç”¨: çº?0-20ms
- ä¼ ç»Ÿåå°„: çº?00-1200ms
- ç¼“å­˜åå°„å§”æ‰˜: çº?0-50ms
- è¡¨è¾¾å¼æ ‘: çº?0-60ms
- åŠ¨æ€ç±»å‹ä½¿ç”?åå°„): çº?00-1200ms
- åŠ¨æ€ç±»å?+ å§”æ‰˜: çº?0-50ms

**åŠ¨æ€ä»£ç ç”Ÿæˆä¸ä¼ ç»Ÿåå°„çš„æ¯”è¾ƒï¼š**

|                | åŠ¨æ€ä»£ç ç”Ÿæˆ?                | ä¼ ç»Ÿåå°„                 |
| -------------- | ---------------------------- | ------------------------ |
| **åˆå§‹åŒ–æˆæœ?* | é«˜ï¼ˆéœ€è¦ç”ŸæˆILä»£ç ï¼?        | ä½ï¼ˆç›´æ¥ä½¿ç”¨ç°æœ‰ç±»å‹ï¼?  |
| **è¿è¡Œæ—¶æ€§èƒ½** | ä¸ç›´æ¥è°ƒç”¨æ¥è¿‘ï¼ˆä½¿ç”¨å§”æ‰˜ï¼?  | è¾ƒæ…¢ï¼ˆæ¯æ¬¡æ“ä½œéƒ½æœ‰å¼€é”€ï¼?|
| **çµæ´»æ€?*     | å¯ä»¥åˆ›å»ºå…¨æ–°ç±»å‹             | åªèƒ½ä½¿ç”¨å·²æœ‰ç±»å‹         |
| **å¤æ‚åº?*     | é«˜ï¼ˆéœ€è¦äº†è§£ILï¼?            | ä½ï¼ˆAPIè¾ƒç®€å•ï¼‰          |
| **è°ƒè¯•éš¾åº¦**   | é«˜ï¼ˆåŠ¨æ€ç”Ÿæˆçš„ä»£ç éš¾ä»¥è°ƒè¯•ï¼?| ä¸­ç­‰                     |
| **åœºæ™¯**       | æ€§èƒ½å…³é”®å‹åº”ç”¨ã€ä»£ç ç”Ÿæˆ?    | ç®€å•åŠ¨æ€è¡Œä¸ºã€é…ç½®é©±åŠ?  |

**åŠ¨æ€ä»£ç ç”Ÿæˆçš„åº”ç”¨åœºæ™¯ï¼?*

1. **é«˜æ€§èƒ½åŠ¨æ€ä»£ç?*ï¼šåˆ›å»ºè½»é‡çº§çš„AOPä»£ç†
2. **ORMæ¡†æ¶**ï¼šç”Ÿæˆé«˜æ•ˆçš„æ•°æ®è®¿é—®ä»£ç 
3. **ä»£ç ç”Ÿæˆå·¥å…·**ï¼šæ ¹æ®æ¨¡æ¿ç”Ÿæˆä»£ç ?
4. **åŠ¨æ€ç±»å‹ç³»ç»?*ï¼šåˆ›å»ºè¿è¡Œæ—¶å®šä¹‰çš„ç±»å?
5. **å³æ—¶ç¼–è¯‘(JIT)ä¼˜åŒ–**ï¼šè‡ªå®šä¹‰JITç¼–è¯‘å™?
6. **é¢†åŸŸç‰¹å®šè¯­è¨€(DSL)**ï¼šä¸ºDSLåˆ›å»ºè‡ªå®šä¹‰æ‰§è¡Œå¼•æ“?
7. **æ’ä»¶æ¶æ„**ï¼šåˆ›å»ºé«˜æ€§èƒ½æ’ä»¶ç³»ç»Ÿ

**ä¼ ç»Ÿåå°„çš„åº”ç”¨åœºæ™¯ï¼š**

1. **é…ç½®é©±åŠ¨çš„åº”ç”¨ç¨‹åº?*ï¼šæ ¹æ®é…ç½®åŠ¨æ€è°ƒç”¨æ–¹æ³?
2. **ä¾èµ–æ³¨å…¥å®¹å™¨**ï¼šè§£æå’Œåˆ›å»ºä¾èµ–å…³ç³»
3. **åºåˆ—åŒ?ååºåˆ—åŒ–**ï¼šè¯»å–å’Œå†™å…¥å¯¹è±¡æ•°æ®
4. **å•å…ƒæµ‹è¯•**ï¼šè®¿é—®ç§æœ‰æˆå‘˜è¿›è¡Œæµ‹è¯?
5. **ç®€å•çš„æ’ä»¶ç³»ç»Ÿ**ï¼šåŠ è½½å’Œè°ƒç”¨æ’ä»¶
6. **æ•°æ®ç»‘å®š**ï¼šå°†æ•°æ®ç»‘å®šåˆ°UIå…ƒç´ 

**æœ€ä½³å®è·µä¸å»ºè®®ï¼?*

1. **é€‰æ‹©åˆé€‚çš„å·¥å…·**ï¼?
   - å•æ¬¡æˆ–ä½é¢‘æ“ä½œï¼šä½¿ç”¨ä¼ ç»Ÿåå°„
   - é«˜é¢‘æ“ä½œï¼šä½¿ç”¨ç¼“å­˜çš„åå°„å§”æ‰˜æˆ–è¡¨è¾¾å¼æ ?
   - éœ€è¦åˆ›å»ºæ–°ç±»å‹ï¼šä½¿ç”¨åŠ¨æ€ä»£ç ç”Ÿæˆ?

2. **åŠ¨æ€ä»£ç ç”Ÿæˆæ³¨æ„äº‹é¡?*ï¼?
   - è°¨æ…å¤„ç†ILç”Ÿæˆï¼Œé”™è¯¯çš„ILå¯èƒ½å¯¼è‡´è¿è¡Œæ—¶å´©æº?
   - è€ƒè™‘ä¸€æ¬¡ç”Ÿæˆã€å¤šæ¬¡ä½¿ç”¨çš„æ¨¡å¼
   - ä¸ºå¤æ‚æ“ä½œåˆ›å»ºè¾…åŠ©æ–¹æ³?
   - å®ç°é€‚å½“çš„é”™è¯¯å¤„ç?

3. **æ€§èƒ½ä¼˜åŒ–**ï¼?
   - ç¼“å­˜ç”Ÿæˆçš„ç±»å‹å’Œå§”æ‰˜
   - å‡å°‘åŠ¨æ€ç”Ÿæˆçš„é¢‘ç‡
   - ä½¿ç”¨å·¥å…·å’Œåº“ï¼ˆå¦‚Expressionã€Castle DynamicProxyï¼?

4. **å¯ç»´æŠ¤æ€?*ï¼?
   - éš”ç¦»åŠ¨æ€ä»£ç ç”Ÿæˆé€»è¾‘
   - æä¾›è¶³å¤Ÿçš„æ–‡æ¡£å’Œæ³¨é‡Š
   - è€ƒè™‘ä½¿ç”¨æ›´é«˜çº§çš„æŠ½è±¡ï¼Œå¦‚è¡¨è¾¾å¼æ ‘

**ä¼˜ç‚¹åˆ†æï¼?*
- åŠ¨æ€ä»£ç ç”Ÿæˆå…è®¸åœ¨è¿è¡Œæ—¶åˆ›å»ºé«˜æ•ˆçš„ä»£ç 
- ç”Ÿæˆåçš„ä»£ç æ¥è¿‘åŸç”Ÿæ€§èƒ½
- æä¾›ä¼ ç»Ÿåå°„æ— æ³•å®ç°çš„çµæ´»æ€?
- æ”¯æŒé«˜çº§åœºæ™¯ï¼Œå¦‚æ–¹æ³•æ‹¦æˆªå’Œä»£ç?

**ç¼ºç‚¹åˆ†æï¼?*
- å­¦ä¹ æ›²çº¿é™¡å³­ï¼Œéœ€è¦äº†è§£IL
- è°ƒè¯•å›°éš¾ï¼Œé”™è¯¯éš¾ä»¥å®šä½?
- åˆå§‹åŒ–æˆæœ¬é«˜
- ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§é™ä½?
- å¯èƒ½å¼•å…¥å®‰å…¨é£é™©

## å››ã€ç»¼åˆåº”ç”¨æ¡ˆä¾?

### æŠ€æœ¯é¢˜10ï¼šè‡ªå®šä¹‰ä¾èµ–æ³¨å…¥å®¹å™¨

**é—®é¢˜ï¼?* ä½¿ç”¨åå°„å’Œå…ƒæ•°æ®è®¾è®¡å¹¶å®ç°ä¸€ä¸ªç®€å•çš„ä¾èµ–æ³¨å…¥(DI)å®¹å™¨ï¼Œæ”¯æŒæ„é€ å‡½æ•°æ³¨å…¥ã€å±æ€§æ³¨å…¥ï¼Œä»¥åŠç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆå•ä¾‹ã€ç¬æ€ï¼‰ã€‚æä¾›ä½¿ç”¨ç¤ºä¾‹å¹¶åˆ†æå…¶å·¥ä½œåŸç†å’Œé™åˆ¶ã€?

**ç­”æ¡ˆï¼?*

**ä¾èµ–æ³¨å…¥å®¹å™¨çš„è®¾è®¡ä¸å®ç°ï¼?*

ä¸‹é¢æˆ‘ä»¬å°†å®ç°ä¸€ä¸ªç®€å•ä½†åŠŸèƒ½å®Œæ•´çš„ä¾èµ–æ³¨å…¥å®¹å™¨ï¼Œå®ƒæ”¯æŒï¼š
- ç±»å‹æ³¨å†Œä¸è§£æ?
- æ„é€ å‡½æ•°æ³¨å…?
- å±æ€§æ³¨å…?
- ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆå•ä¾‹ã€ç¬æ€ï¼‰
- åŸºäºæ¥å£çš„æœåŠ¡æ³¨å†?

```csharp
using System;
using System.Collections.Concurrent;
using System.Collections.Generic;
using System.Linq;
using System.Reflection;

// è‡ªå®šä¹‰ç‰¹æ€§ï¼Œç”¨äºæ ‡è®°éœ€è¦æ³¨å…¥çš„å±æ€?
[AttributeUsage(AttributeTargets.Property, AllowMultiple = false)]
public class InjectAttribute : Attribute
{
}

// ä¾èµ–æ³¨å…¥å®¹å™¨
public class DIContainer
{
    // æœåŠ¡ç”Ÿå‘½å‘¨æœŸæšä¸¾
    public enum Lifestyle
    {
        Singleton, // å•ä¾‹
        Transient  // ç¬æ€?
    }
    
    // æœåŠ¡æ³¨å†Œä¿¡æ¯ç±?
    private class ServiceRegistration
    {
        public Type ServiceType { get; set; }
        public Type ImplementationType { get; set; }
        public Lifestyle Lifestyle { get; set; }
        public object Instance { get; set; }
        public Func<DIContainer, object> Factory { get; set; }
    }
    
    // æœåŠ¡æ³¨å†Œè¡?
    private readonly Dictionary<Type, ServiceRegistration> _registrations = new Dictionary<Type, ServiceRegistration>();
    
    // ç”¨äºå¹¶å‘è§£æçš„é”å¯¹è±¡
    private readonly ConcurrentDictionary<Type, object> _resolutionLocks = new ConcurrentDictionary<Type, object>();
    
    // å½“å‰æ­£åœ¨è§£æçš„ç±»å‹å †æ ˆï¼ˆç”¨äºæ£€æµ‹å¾ªç¯ä¾èµ–ï¼‰
    private readonly ThreadLocal<Stack<Type>> _resolutionStack = new ThreadLocal<Stack<Type>>(() => new Stack<Type>());
    
    #region æœåŠ¡æ³¨å†Œæ–¹æ³•
    
    // æ³¨å†Œç¬æ€æœåŠ?
    public DIContainer RegisterTransient<TService, TImplementation>()
        where TImplementation : TService
    {
        return Register<TService, TImplementation>(Lifestyle.Transient);
    }
    
    // ç›´æ¥æ³¨å†Œç¬æ€å®ç°ç±»å?
    public DIContainer RegisterTransient<TService>()
    {
        return Register<TService, TService>(Lifestyle.Transient);
    }
    
    // æ³¨å†Œå•ä¾‹æœåŠ¡
    public DIContainer RegisterSingleton<TService, TImplementation>()
        where TImplementation : TService
    {
        return Register<TService, TImplementation>(Lifestyle.Singleton);
    }
    
    // ç›´æ¥æ³¨å†Œå•ä¾‹å®ç°ç±»å‹
    public DIContainer RegisterSingleton<TService>()
    {
        return Register<TService, TService>(Lifestyle.Singleton);
    }
    
    // æ³¨å†Œç°æœ‰å®ä¾‹ä½œä¸ºå•ä¾‹
    public DIContainer RegisterInstance<TService>(TService instance)
    {
        if (instance == null)
            throw new ArgumentNullException(nameof(instance));
            
        Type serviceType = typeof(TService);
        
        _registrations[serviceType] = new ServiceRegistration
        {
            ServiceType = serviceType,
            ImplementationType = instance.GetType(),
            Lifestyle = Lifestyle.Singleton,
            Instance = instance
        };
        
        return this;
    }
    
    // æ³¨å†Œå·¥å‚æ–¹æ³•
    public DIContainer RegisterFactory<TService>(Func<DIContainer, TService> factory, Lifestyle lifestyle = Lifestyle.Transient)
    {
        if (factory == null)
            throw new ArgumentNullException(nameof(factory));
            
        Type serviceType = typeof(TService);
        
        _registrations[serviceType] = new ServiceRegistration
        {
            ServiceType = serviceType,
            ImplementationType = null,
            Lifestyle = lifestyle,
            Factory = c => factory(c)
        };
        
        return this;
    }
    
    // åŸºæœ¬æ³¨å†Œæ–¹æ³•
    private DIContainer Register<TService, TImplementation>(Lifestyle lifestyle)
    {
        Type serviceType = typeof(TService);
        Type implementationType = typeof(TImplementation);
        
        if (!serviceType.IsAssignableFrom(implementationType))
            throw new ArgumentException($"{implementationType} ä¸å®ç?{serviceType}");
            
        _registrations[serviceType] = new ServiceRegistration
        {
            ServiceType = serviceType,
            ImplementationType = implementationType,
            Lifestyle = lifestyle,
            Instance = null
        };
        
        return this;
    }
    
    #endregion
    
    #region æœåŠ¡è§£ææ–¹æ³•
    
    // è§£ææœåŠ¡
    public TService Resolve<TService>()
    {
        return (TService)Resolve(typeof(TService));
    }
    
    // è§£ææœåŠ¡ï¼ˆéæ³›å‹ç‰ˆæœ¬ï¼?
    public object Resolve(Type serviceType)
    {
        if (serviceType == null)
            throw new ArgumentNullException(nameof(serviceType));
            
        // æ£€æŸ¥å¾ªç¯ä¾èµ?
        if (_resolutionStack.Value.Contains(serviceType))
        {
            string dependencyChain = string.Join(" -> ", _resolutionStack.Value.Reverse()) + " -> " + serviceType.Name;
            throw new InvalidOperationException($"æ£€æµ‹åˆ°å¾ªç¯ä¾èµ–: {dependencyChain}");
        }
        
        // æŸ¥æ‰¾æ³¨å†Œä¿¡æ¯
        if (!_registrations.TryGetValue(serviceType, out ServiceRegistration registration))
        {
            // å¦‚æœæœåŠ¡æ²¡æœ‰æ³¨å†Œä½†æ˜¯å…·ä½“ç±»å‹ï¼ˆéæ¥å£æˆ–æŠ½è±¡ç±»ï¼‰ï¼Œå°è¯•ç›´æ¥åˆ›å»ºå®?
            if (!serviceType.IsInterface && !serviceType.IsAbstract)
            {
                return CreateInstance(serviceType);
            }
            
            throw new InvalidOperationException($"æœªæ³¨å†ŒæœåŠ? {serviceType.Name}");
        }
        
        _resolutionStack.Value.Push(serviceType);
        
        try
        {
            return ResolveRegistration(registration);
        }
        finally
        {
            _resolutionStack.Value.Pop();
        }
    }
    
    // è§£ææ³¨å†Œä¿¡æ¯
    private object ResolveRegistration(ServiceRegistration registration)
    {
        // å¦‚æœå·²æœ‰å®ä¾‹ä¸”æ˜¯å•ä¾‹ï¼Œç›´æ¥è¿”å›?
        if (registration.Instance != null)
            return registration.Instance;
            
        // å¦‚æœæœ‰å·¥å‚æ–¹æ³•ï¼Œä½¿ç”¨å·¥å‚åˆ›å»ºå®ä¾‹
        if (registration.Factory != null)
        {
            object instance = registration.Factory(this);
            
            // å¦‚æœæ˜¯å•ä¾‹ï¼Œä¿å­˜å®ä¾‹
            if (registration.Lifestyle == Lifestyle.Singleton)
                registration.Instance = instance;
                
            return instance;
        }
        
        // åˆ›å»ºå®ä¾‹
        if (registration.Lifestyle == Lifestyle.Singleton)
        {
            // ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šæ¨¡å¼ç¡®ä¿çº¿ç¨‹å®‰å…?
            if (registration.Instance == null)
            {
                // ä¸ºæ¯ä¸ªç±»å‹è·å–å¯¹åº”çš„é”å¯¹è±?
                object lockObj = _resolutionLocks.GetOrAdd(registration.ServiceType, _ => new object());
                
                lock (lockObj)
                {
                    if (registration.Instance == null)
                    {
                        registration.Instance = CreateInstance(registration.ImplementationType);
                    }
                }
            }
            
            return registration.Instance;
        }
        else // Transient
        {
            return CreateInstance(registration.ImplementationType);
        }
    }
    
    // åˆ›å»ºå®ä¾‹
    private object CreateInstance(Type type)
    {
        // è·å–æ‰€æœ‰æ„é€ å‡½æ•?
        ConstructorInfo[] constructors = type.GetConstructors();
        
        if (constructors.Length == 0)
        {
            // å¦‚æœæ²¡æœ‰å…¬å…±æ„é€ å‡½æ•°ï¼Œå°è¯•ä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•?
            return Activator.CreateInstance(type);
        }
        
        // é€‰æ‹©æœ€åˆé€‚çš„æ„é€ å‡½æ•°ï¼ˆä¼˜å…ˆé€‰æ‹©æœ‰å‚æ•°ä½†å¯ä»¥è§£ææ‰€æœ‰å‚æ•°çš„æ„é€ å‡½æ•°ï¼‰
        ConstructorInfo constructor = GetBestConstructor(constructors);
        
        if (constructor == null)
        {
            throw new InvalidOperationException($"æ— æ³•æ‰¾åˆ°åˆé€‚çš„æ„é€ å‡½æ•? {type.Name}");
        }
        
        // è§£ææ„é€ å‡½æ•°å‚æ•?
        ParameterInfo[] parameters = constructor.GetParameters();
        object[] parameterValues = new object[parameters.Length];
        
        for (int i = 0; i < parameters.Length; i++)
        {
            Type parameterType = parameters[i].ParameterType;
            
            try
            {
                parameterValues[i] = Resolve(parameterType);
            }
            catch (InvalidOperationException ex)
            {
                throw new InvalidOperationException($"æ— æ³•è§£æç±»å‹ {type.Name} çš„æ„é€ å‡½æ•°å‚æ•?{parameters[i].Name}: {ex.Message}", ex);
            }
        }
        
        // åˆ›å»ºå®ä¾‹
        object instance = constructor.Invoke(parameterValues);
        
        // æ‰§è¡Œå±æ€§æ³¨å…?
        InjectProperties(instance);
        
        return instance;
    }
    
    // é€‰æ‹©æœ€ä½³æ„é€ å‡½æ•?
    private ConstructorInfo GetBestConstructor(ConstructorInfo[] constructors)
    {
        // æŒ‰å‚æ•°æ•°é‡é™åºæ’åº?
        Array.Sort(constructors, (c1, c2) => c2.GetParameters().Length.CompareTo(c1.GetParameters().Length));
        
        foreach (var constructor in constructors)
        {
            ParameterInfo[] parameters = constructor.GetParameters();
            bool canResolveAll = true;
            
            foreach (var parameter in parameters)
            {
                Type parameterType = parameter.ParameterType;
                
                // æ£€æŸ¥æ˜¯å¦å·²æ³¨å†Œæˆ–æ˜¯å¯ä»¥ç›´æ¥åˆ›å»ºçš„ç±»å?
                if (!_registrations.ContainsKey(parameterType) && 
                    (parameterType.IsInterface || parameterType.IsAbstract))
                {
                    canResolveAll = false;
                    break;
                }
            }
            
            if (canResolveAll)
                return constructor;
        }
        
        // å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ„é€ å‡½æ•°ï¼Œè¿”å›æ— å‚æ„é€ å‡½æ•?
        return constructors.FirstOrDefault(c => c.GetParameters().Length == 0);
    }
    
    // å±æ€§æ³¨å…?
    private void InjectProperties(object instance)
    {
        Type type = instance.GetType();
        
        // è·å–æ‰€æœ‰å¸¦æœ‰Injectç‰¹æ€§çš„å±æ€?
        var properties = type.GetProperties()
            .Where(p => p.CanWrite && p.GetCustomAttribute<InjectAttribute>() != null);
            
        foreach (var property in properties)
        {
            Type propertyType = property.PropertyType;
            
            try
            {
                // è§£æå±æ€§å€?
                object value = Resolve(propertyType);
                
                // è®¾ç½®å±æ€?
                property.SetValue(instance, value);
            }
            catch (InvalidOperationException ex)
            {
                // è®°å½•è­¦å‘Šä½†ä¸é˜»æ­¢åˆ›å»º
                Console.WriteLine($"è­¦å‘Š: æ— æ³•æ³¨å…¥å±æ€?{property.Name} åˆ?{type.Name}: {ex.Message}");
            }
        }
    }
    
    #endregion
    
    // æ£€æŸ¥æœåŠ¡æ˜¯å¦å·²æ³¨å†Œ
    public bool IsRegistered<TService>()
    {
        return IsRegistered(typeof(TService));
    }
    
    // æ£€æŸ¥æœåŠ¡æ˜¯å¦å·²æ³¨å†Œï¼ˆéæ³›å‹ç‰ˆæœ¬ï¼?
    public bool IsRegistered(Type serviceType)
    {
        return _registrations.ContainsKey(serviceType);
    }
}

// ç¤ºä¾‹æ¥å£å’Œç±»
public interface ILogger
{
    void Log(string message);
}

public class ConsoleLogger : ILogger
{
    public void Log(string message)
    {
        Console.WriteLine($"[LOG] {message}");
    }
}

public interface IUserRepository
{
    User GetById(int id);
}

public class SqlUserRepository : IUserRepository
{
    private readonly ILogger _logger;
    
    public SqlUserRepository(ILogger logger)
    {
        _logger = logger;
    }
    
    public User GetById(int id)
    {
        _logger.Log($"Getting user with ID: {id}");
        return new User { Id = id, Name = "User " + id };
    }
}

public interface IUserService
{
    User GetUser(int id);
}

public class UserService : IUserService
{
    private readonly IUserRepository _repository;
    
    [Inject]
    public ILogger Logger { get; set; }
    
    public UserService(IUserRepository repository)
    {
        _repository = repository;
    }
    
    public User GetUser(int id)
    {
        Logger?.Log($"UserService.GetUser({id}) called");
        return _repository.GetById(id);
    }
}

public class User
{
    public int Id { get; set; }
    public string Name { get; set; }
}

// å¾ªç¯ä¾èµ–ç¤ºä¾‹
public interface IServiceA
{
    void DoSomething();
}

public interface IServiceB
{
    void DoSomething();
}

public class ServiceA : IServiceA
{
    private readonly IServiceB _serviceB;
    
    public ServiceA(IServiceB serviceB)
    {
        _serviceB = serviceB;
    }
    
    public void DoSomething()
    {
        Console.WriteLine("ServiceA doing something");
    }
}

public class ServiceB : IServiceB
{
    private readonly IServiceA _serviceA;
    
    public ServiceB(IServiceA serviceA)
    {
        _serviceA = serviceA;
    }
    
    public void DoSomething()
    {
        Console.WriteLine("ServiceB doing something");
    }
}

// ä½¿ç”¨ä¾èµ–æ³¨å…¥å®¹å™¨
class Program
{
    static void Main()
    {
        // åˆ›å»ºå®¹å™¨
        var container = new DIContainer();
        
        // æ³¨å†ŒæœåŠ¡
        container.RegisterSingleton<ILogger, ConsoleLogger>();
        container.RegisterTransient<IUserRepository, SqlUserRepository>();
        container.RegisterTransient<IUserService, UserService>();
        
        // è§£ææœåŠ¡
        IUserService userService = container.Resolve<IUserService>();
        
        // ä½¿ç”¨æœåŠ¡
        User user = userService.GetUser(1);
        Console.WriteLine($"Found user: {user.Name}");
        
        // æ¼”ç¤ºå•ä¾‹è¡Œä¸º
        ILogger logger1 = container.Resolve<ILogger>();
        ILogger logger2 = container.Resolve<ILogger>();
        
        Console.WriteLine($"Singleton test: Same instance? {ReferenceEquals(logger1, logger2)}");
        
        // æ¼”ç¤ºç¬æ€è¡Œä¸?
        IUserRepository repo1 = container.Resolve<IUserRepository>();
        IUserRepository repo2 = container.Resolve<IUserRepository>();
        
        Console.WriteLine($"Transient test: Same instance? {ReferenceEquals(repo1, repo2)}");
        
        // æ¼”ç¤ºå·¥å‚æ³¨å†Œ
        container.RegisterFactory<string>(c => "Factory created string", DIContainer.Lifestyle.Singleton);
        string value = container.Resolve<string>();
        Console.WriteLine($"Factory test: {value}");
        
        // æ¼”ç¤ºå®ä¾‹æ³¨å†Œ
        var customLogger = new ConsoleLogger();
        container.RegisterInstance<ILogger>(customLogger);
        ILogger resolvedLogger = container.Resolve<ILogger>();
        
        Console.WriteLine($"Instance registration test: Same instance? {ReferenceEquals(customLogger, resolvedLogger)}");
        
        // æ¼”ç¤ºæœªæ³¨å†ŒæœåŠ¡çš„è§£æ
        try
        {
            var notRegistered = container.Resolve<IDisposable>();
        }
        catch (InvalidOperationException ex)
        {
            Console.WriteLine($"Expected error: {ex.Message}");
        }
        
        // æ¼”ç¤ºå¾ªç¯ä¾èµ–æ£€æµ?
        var circularContainer = new DIContainer();
        circularContainer.RegisterTransient<IServiceA, ServiceA>();
        circularContainer.RegisterTransient<IServiceB, ServiceB>();
        
        try
        {
            var serviceA = circularContainer.Resolve<IServiceA>();
        }
        catch (InvalidOperationException ex)
        {
            Console.WriteLine($"å¾ªç¯ä¾èµ–æ£€æµ? {ex.Message}");
        }
    }
}
```

**ä¾èµ–æ³¨å…¥å®¹å™¨å·¥ä½œåŸç†åˆ†æï¼?*

**1. æœåŠ¡æ³¨å†Œï¼?*

   å½“è°ƒç”¨`RegisterTransient<T>()`æˆ–`RegisterSingleton<T>()`ç­‰æ–¹æ³•æ—¶ï¼Œå®¹å™¨ä¼šå°†æœåŠ¡ç±»å‹å’Œå®ç°ç±»å‹çš„æ˜ å°„å­˜å‚¨åœ¨å†…éƒ¨å­—å…¸ä¸­ï¼ŒåŒæ—¶è®°å½•ç”Ÿå‘½å‘¨æœŸ(å•ä¾‹/ç¬æ€?ä¿¡æ¯ã€?

**2. æœåŠ¡è§£æè¿‡ç¨‹ï¼?*

   a. ä»æ³¨å†Œè¡¨ä¸­æŸ¥æ‰¾æœåŠ¡ç±»å‹å¯¹åº”çš„æ³¨å†Œä¿¡æ¯
   b. å¯¹äºå•ä¾‹æœåŠ¡ï¼Œæ£€æŸ¥æ˜¯å¦å·²æœ‰å®ä¾‹ï¼Œå¦‚æœ‰åˆ™è¿”å›?
   c. å¯¹äºç¬æ€æœåŠ¡æˆ–é¦–æ¬¡è®¿é—®çš„å•ä¾‹ï¼Œåˆ›å»ºæ–°å®ä¾?
   d. åˆ›å»ºå®ä¾‹æ—¶ï¼Œä½¿ç”¨åå°„é€‰æ‹©æœ€åˆé€‚çš„æ„é€ å‡½æ•?
   e. é€’å½’è§£ææ„é€ å‡½æ•°çš„æ‰€æœ‰å‚æ•?
   f. å®ä¾‹åŒ–å¯¹è±¡åï¼ŒæŸ¥æ‰¾æœ‰`[Inject]`ç‰¹æ€§æ ‡è®°çš„å±æ€§å¹¶æ³¨å…¥
   g. å¯¹äºå•ä¾‹æœåŠ¡ï¼Œç¼“å­˜å®ä¾‹ä¾›åç»­ä½¿ç”¨

**3. æ„é€ å‡½æ•°é€‰æ‹©é€»è¾‘ï¼?*

   å®¹å™¨ä¼˜å…ˆé€‰æ‹©å¯æ»¡è¶³çš„æœ€å¤§å‚æ•°æ•°é‡çš„æ„é€ å‡½æ•°ã€?å¯æ»¡è¶?æ„å‘³ç€æ„é€ å‡½æ•°æ‰€æœ‰å‚æ•°ç±»å‹éƒ½å·²æ³¨å†Œæˆ–å¯ç›´æ¥åˆ›å»ºã€?

**4. å¾ªç¯ä¾èµ–æ£€æµ‹ï¼š**

   å®¹å™¨åœ¨è§£æè¿‡ç¨‹ä¸­ç»´æŠ¤ä¸€ä¸ªå½“å‰è§£æè·¯å¾„çš„å †æ ˆã€‚å¦‚æœå‘ç°æ­£åœ¨è§£æçš„ç±»å‹å·²ç»åœ¨å †æ ˆä¸­ï¼ˆå³å½¢æˆå¾ªç¯ï¼‰ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€?

**5. çº¿ç¨‹å®‰å…¨ï¼?*

   å•ä¾‹åˆ›å»ºè¿‡ç¨‹ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šæ¨¡å¼ç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­æ¯ä¸ªå•ä¾‹åªåˆ›å»ºä¸€æ¬¡ã€?

**ä¾èµ–æ³¨å…¥å®¹å™¨çš„ä¼˜ç¼ºç‚¹ï¼?*

**ä¼˜ç‚¹ï¼?*

1. **è§£è€?*ï¼šæœåŠ¡ä½¿ç”¨è€…ä¸éœ€è¦äº†è§£ä¾èµ–çš„å…·ä½“å®ç°
2. **å¯æµ‹è¯•æ€?*ï¼šä¾èµ–å¯ä»¥è½»æ¾æ›¿æ¢ä¸ºæ¨¡æ‹Ÿå¯¹è±¡
3. **çµæ´»é…ç½®**ï¼šå¯ä»¥åœ¨è¿è¡Œæ—¶æ›´æ”¹æœåŠ¡å®ç?
4. **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šè‡ªåŠ¨ç®¡ç†å¯¹è±¡åˆ›å»ºå’Œå…±äº«
5. **å…³æ³¨ç‚¹åˆ†ç¦?*ï¼šæœåŠ¡ä¸éœ€è¦å…³å¿ƒä¾èµ–çš„åˆ›å»ºè¿‡ç¨‹

**ç¼ºç‚¹ï¼?*

1. **æ€§èƒ½å¼€é”€**ï¼šä½¿ç”¨åå°„åˆ›å»ºå¯¹è±¡å’Œæ³¨å…¥ä¾èµ–æ¯”ç›´æ¥åˆ›å»ºæ…¢
2. **å¯è¯»æ€§é™ä½?*ï¼šä¾èµ–å…³ç³»å¯èƒ½ä¸é‚£ä¹ˆç›´è§‚
3. **è¿‡åº¦ä½¿ç”¨é£é™©**ï¼šå¯èƒ½å¯¼è‡´ä¸å¿…è¦çš„å¤æ‚æ€?
4. **æ½œåœ¨è¿è¡Œæ—¶é”™è¯?*ï¼šä¾èµ–è§£æå¯èƒ½åœ¨è¿è¡Œæ—¶å¤±è´?
5. **å¯åŠ¨æ—¶é—´å»¶é•¿**ï¼šéœ€è¦è§£æå’Œåˆ›å»ºå¯¹è±¡å›?

**æˆ‘ä»¬å®ç°çš„DIå®¹å™¨çš„é™åˆ¶ï¼š**

1. **æœ‰é™çš„ç”Ÿå‘½å‘¨æœ?*ï¼šåªæ”¯æŒå•ä¾‹å’Œç¬æ€ï¼Œæ²¡æœ‰ä½œç”¨åŸ?Scoped)æ”¯æŒ
2. **æ— æ‹¦æˆªå™¨**ï¼šä¸æ”¯æŒAOPé£æ ¼çš„æ–¹æ³•æ‹¦æˆ?
3. **ç®€å•çš„å¾ªç¯ä¾èµ–å¤„ç†**ï¼šåªèƒ½æ£€æµ‹ä½†ä¸èƒ½è§£å†³å¾ªç¯ä¾èµ–
4. **æœ‰é™çš„åŸºäºç‰¹æ€§çš„é…ç½®**ï¼šåªæ”¯æŒåŸºæœ¬çš„`[Inject]`ç‰¹æ€?
5. **æ²¡æœ‰æƒ°æ€§åˆå§‹åŒ–é€‰é¡¹**ï¼šä¸èƒ½å»¶è¿Ÿåˆ›å»ºæœåŠ?
6. **ç¼ºå°‘é‡Šæ”¾æœºåˆ¶**ï¼šæ²¡æœ‰å®ç°IDisposableçš„å¯¹è±¡å¤„ç?
7. **æœ‰é™çš„æ³¨å†ŒAPI**ï¼šç¼ºä¹æŒ‰ç¨‹åºé›†æ‰«æç­‰é«˜çº§åŠŸèƒ½

**ä¸å•†ä¸šDIå®¹å™¨çš„æ¯”è¾ƒï¼š**

ä¸æˆç†Ÿçš„ä¾èµ–æ³¨å…¥å®¹å™¨ï¼ˆå¦‚Microsoft.Extensions.DependencyInjectionã€Autofacæˆ–Unityï¼‰ç›¸æ¯”ï¼Œæˆ‘ä»¬çš„å®ç°æ›´ç®€å•ï¼ŒåŠŸèƒ½æ›´æœ‰é™ã€‚å•†ä¸šå®¹å™¨é€šå¸¸æä¾›ï¼?

- æ›´å¤šçš„ç”Ÿå‘½å‘¨æœŸé€‰é¡¹ï¼ˆå¦‚ä½œç”¨åŸŸã€æ¯è¯·æ±‚ï¼?
- æ›´ä¸°å¯Œçš„æ³¨å†ŒAPIï¼ˆå¦‚æŒ‰çº¦å®šæ³¨å†Œã€æŒ‰ç¨‹åºé›†æ‰«æï¼‰
- æ‹¦æˆªå™¨å’Œä»£ç†æ”¯æŒ
- é«˜çº§è§£æåŠŸèƒ½ï¼ˆå¦‚å»¶è¿Ÿè§£æã€é›†åˆè§£æï¼‰
- æ€§èƒ½ä¼˜åŒ–ï¼ˆå¦‚è¡¨è¾¾å¼æ ‘ç¼–è¯‘ï¼?
- é€‚å½“çš„èµ„æºé‡Šæ”¾ï¼ˆIDisposableæ”¯æŒï¼?

**å®é™…åº”ç”¨å»ºè®®ï¼?*

1. **ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æˆç†Ÿå®¹å™¨**ï¼šå¦‚Microsoft.Extensions.DependencyInjectionæˆ–Autofac
2. **äº†è§£æ³¨å†Œæ–¹å¼çš„å½±å“?*ï¼šåˆç†é€‰æ‹©ç¬æ€å’Œå•ä¾‹ç­‰ç”Ÿå‘½å‘¨æœ?
3. **é¿å…ä¸å¿…è¦çš„æœåŠ¡å®šä½å™¨æ¨¡å¼?*ï¼šä¼˜å…ˆä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…?
4. **ä¿æŒä¾èµ–ç®€å?*ï¼šé¿å…å¤æ‚çš„ä¾èµ–å›¾å’Œå¾ªç¯ä¾èµ–
5. **é€‚åº¦ä½¿ç”¨å±æ€§æ³¨å…?*ï¼šä»…å¯¹å¯é€‰ä¾èµ–ä½¿ç”¨å±æ€§æ³¨å…?
6. **æ˜ç¡®æœåŠ¡èŒè´£**ï¼šéµå¾ªå•ä¸€èŒè´£åŸåˆ™ï¼Œé¿å…æœåŠ¡æˆä¸?ä¸Šå¸å¯¹è±¡"

**æ‰©å±•æ€è·¯ï¼?*

è‡ªå®šä¹‰ä¾èµ–æ³¨å…¥å®¹å™¨å¯ä»¥æ‰©å±•ä»¥æ”¯æŒï¼?

1. **ä½œç”¨åŸŸç”Ÿå‘½å‘¨æœ?*ï¼šæ·»åŠ ç±»ä¼¼è¯·æ±‚ä½œç”¨åŸŸçš„æ¦‚å¿?
2. **æ‹¦æˆªå™¨æ”¯æŒ?*ï¼šä½¿ç”¨ä»£ç†å®ç°AOPåŠŸèƒ½
3. **æ¡ä»¶æ³¨å†Œ**ï¼šåŸºäºæ¡ä»¶é€‰æ‹©ä¸åŒå®ç°
4. **é›†åˆæ”¯æŒ**ï¼šæ³¨å†Œå’Œè§£æåŒä¸€æ¥å£çš„å¤šä¸ªå®ç?
5. **å‚æ•°æ³¨å…¥**ï¼šæ”¯æŒå‘æœåŠ¡ä¼ é€’è‡ªå®šä¹‰å‚æ•°
6. **æƒ°æ€§åˆå§‹åŒ–**ï¼šä½¿ç”¨ä»£ç†å»¶è¿Ÿåˆ›å»ºå®é™…æœåŠ?
7. **æ›´å¥½çš„æ€§èƒ½**ï¼šä½¿ç”¨è¡¨è¾¾å¼æ ‘ç¼–è¯‘æˆ–ILç”Ÿæˆ